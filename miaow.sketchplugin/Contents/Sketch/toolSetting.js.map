{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/common.js","webpack://exports/./src/flag.js","webpack://exports/./src/link.js","webpack://exports/./src/toolSetting.js"],"names":["kPluginDomain","iconQueryUrl","loginKey","_","context","i18nKey","lang","NSUserDefaults","standardUserDefaults","objectForKey","undefined","macOSVersion","NSDictionary","dictionaryWithContentsOfFile","objectAtIndex","split","slice","join","indexOf","setObject_forKey","encodeURIComponent","toString","length","get_","json","manifestPath","plugin","url","URLByAppendingPathComponent","path","jsonData","NSData","dataWithContentsOfFile","NSString","alloc","initWithData_encoding","NSUTF8StringEncoding","JSON","parse","i18Content","dialog","iconImage","NSImage","initByReferencingFile","urlForResourceNamed","alert","COSAlertWindow","new","setIcon","errorDialog","content","addButtonWithTitle","checkForUpdate","m9","setMessageText","m10","setInformativeText","runModal","initDefaults","pluginDomain","initialValues","defaults","defaultValues","dVal","key","nil","uploadContext","contextNow","document","NSDocumentController","sharedDocumentController","currentDocument","selection","selectedLayers","layers","paste","text","pasteBoard","NSPasteboard","generalPasteboard","declareTypes_owner","NSArray","arrayWithObject","NSPasteboardTypeString","setString_forType","rgb","a","sColor","toLowerCase","sColorNew","i","concat","sColorChange","push","parseInt","saveDefaults","newValues","request","args","aara","task","NSTask","init","setLaunchPath","setArguments","outputPipe","NSPipe","pipe","setStandardOutput","launch","responseData","fileHandleForReading","readDataToEndOfFile","networkRequest","zip","encodeData","result","o","get","sig","returnData","status","msg","post","getConfig","NSJSONSerialization","JSONObjectWithData_options_error","NSJSONReadingMutableContainers","openUrlInBrowser","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","createRadioButtons","options","selectedItem","ui","NSRadioButton","type","NSRadioModeMatrix","rows","Math","ceil","columns","selectedRow","floor","selectedColumn","buttonCell","NSButtonCell","setButtonType","buttonMatrix","NSMatrix","initWithFrame_mode_prototype_numberOfRows_numberOfColumns","NSMakeRect","setCellSize","NSMakeSize","cells","setTitle","setTag","setTransparent","setEnabled","selectCellAtRow_column","createRadioButtons2","createArtboard","obj","doc","artboard","MSArtboardGroup","setName","name","frame","setX","x","setY","y","setWidth","width","setHeight","height","currentPage","addLayer","hexToRgb","hex","exec","r","g","b","unique","res","len","item","j","jLen","MochaJSDelegate","selectorHandlerDict","uniqueClassName","NSUUID","UUID","UUIDString","delegateClassDesc","MOClassDescription","allocateDescriptionForClassWithName_superclass_","NSObject","registerClass","handlers","setHandlerForSelector","selectorString","func","handlerHasBeenSet","selector","NSSelectorFromString","dynamicHandler","functionToCall","apply","arguments","regex","match","dynamicFunction","eval","addInstanceMethodWithSelector_function_","removeHandlerForSelector","getHandlerForSelector","getAllHandlers","getClass","NSClassFromString","getClassInstance","SMPanel","coscript","setShouldKeepAround","self","encodeURI","titleBgColor","NSColor","colorWithRed_green_blue_alpha","contentBgColor","identifier","threadDictionary","NSThread","mainThread","Panel","NSPanel","setTitleVisibility","NSWindowTitleHidden","setTitlebarAppearsTransparent","standardWindowButton","NSWindowCloseButton","setHidden","hiddenClose","NSWindowMiniaturizeButton","NSWindowZoomButton","setFrame_display","setBackgroundColor","contentView","webView","WebView","initWithFrame","showX","showY","windowObject","windowScriptObject","delegate","webFrame","SMAction","DOMReady","stringify","data","evaluateWebScript","mainFrameURL","fragment","decodeURI","valueForKey","callback","floatWindow","orderOut","NSApp","stopModal","close","removeObjectForKey","closeflag","panel","NSOpenPanel","openPanel","setCanChooseDirectories","setCanCreateDirectories","setAllowedFileTypes","setAllowsOtherFileTypes","setExtensionHidden","clicked","NSFileHandlingPanelOKButton","firstURL","URLs","unformattedURL","stringWithFormat","file_path","stringByRemovingPercentEncoding","loginCallback","pushdataCallback","setWantsLayer","layer","setFrame","setCornerRadius","setMasksToBounds","setFrameLoadDelegate_","setMainFrameURL_","addSubview","closeButton","setCOSJSTargetFunction","sender","closeCallback","wantsStop","setAction","titlebarView","superview","titlebarViewController","view","titlebarContainerView","setFrameOrigin","NSMakePoint","setFrameSize","becomeKeyWindow","setLevel","NSFloatingWindowLevel","center","makeKeyAndOrderFront","runModalForWindow","getFlag","refrush","i18","flag","kPluginDomainFlag","lineColorKey","textCount","scale","isDeleteNum","scaleOptionsMatrix","getConnectionsGroupInPage","page","connectionsLayerPredicate","NSPredicate","predicateWithFormat","children","filteredArrayUsingPredicate","firstObject","colorLine","colorLineR","colorLineG","colorLineB","deleteDialog","settingsWindow","m1","m2","m3","ButtonList","m4","m5","addAccessoryView","getLeftFlagNum","num","Reg","RegExp","countL","replace","test","k","getRightFlagNum","dom","objectID","children2","drawLeftArrow","isNew","parentArtboard","rect","size","count","linexl","absoluteRect","liney","NSBezierPath","bezierPath","moveToPoint","curveToPoint_controlPoint1_controlPoint2","closePath","MSPath","pathWithBezierPath","MSShapeGroup","shapeWithBezierPath","style","addStylePartOfType","setColor","MSImmutableColor","textLayer","MSTextLayer","fixedBehaviour","setTextBehaviour","setStringValue","setTextColor","setFontSize","addLayers","connectionLayers","MSLayerArray","arrayWithLayers","connectionsGroup","MSLayerGroup","groupFromLayers","drawRightArrow","linexr","isMaxNum","drawFunction","nowDom","linkLayersPredicate","linkLayers","loop","objectEnumerator","returnLine","isDrawNow","linkLayer","nextObject","lastState","lastDom","command","setValue_forKey_onLayer_forPluginIdentifier","selectedCell","tag","flags","m6","removeFromParent","setIsLocked","select_byExpandingSelection","ga","Analytics","sendEvent","onRun","getLink","refursh","link","lineColorKeyLink","lineThicknessLinkKey","selectionDom","selectionDom1","selectionDom2","LineToArtJL","lineCollections","sanitizeArtboard","valueForKey_onLayer_forPluginIdentifier","segmentsIntr0","c","d","area_abc","area_abd","area_cda","area_cdb","segmentsIntr","cc","dd","t","dx","dy","findAway","line","endPoisiton","art","artboards","pca","pcb","lastEndPosition","ax","bx","ay","by","isReturnFlag","className","drawTwoLine","axPoint","ayPoint","tmpLinePoint","startPointX","startPointY","endPointX","endPointY","segments","splice","findAway2","endPoisitonArrow","fx","zaLength","qda","nx","ny","linePath","iFlag","getLinePath","startPosition","nextFx","pzysx","pzysy","isPZ","thisEndPosition","PZLine","startArtPosition","endObject","drawPPP","domA","domB","tempPointX","tempPointY","plus","drawLine","log","getLineDirection","pointeOne","pointTwo","getLinePosition","point","direction","isCoincidenis","min","linepoint","isLess","colorLineLink","lineThicknessLink","colorLineLinkR","colorLineLinkG","colorLineLinkB","linePaths","lineCount","offset","coincideOffset","position","comparedLineCollectionCount","abs","lineToPoint","lineSh","hitAreaBorder","colorWithIntegerRed_green_blue_alpha","newMutableCounterpart","setThickness","setPosition","drawRound","linkRect","NSInsetRect","bezierPathWithOvalInRect","hitAreaLayer","drawArrow","z","arrowDirection","arrowOffset","arrowPath","arrow","arrowStyle","startRound","endArrow","drawConnections","connection","draw","connectionLayersDom","redrawConnections","selectionLayer","connections","destinationArtboardID","destinationArtboard","isCondition","Message","destArtboard","child","lastObject","manifest","commands","Selection","linkLayersPredicate2","showMessage","artboardID","flagColorKey","lineThicknessKey","drawIcon","image","imageWithSize","lockFocus","colorWithCalibratedRed_green_blue_alpha","set","stroke","unlockFocus","addButton","index","button","NSButton","bezelStyle","bordered","allowsMixedState","state","imageState","cell","imageScaling","manifestPathZh","manifestZh","manifestPathEn","manifestEn","i18t","toolSetting","items","m7","isChecked","w","h","NSView","buttons","title","NSSwitchButton","origin","addTextLabelWithValue","flowIndicatorColorWell","NSColorWell","flowIndicatorColorHex","flowIndicatorColorAlpha","flowIndicatorMSColor","colorWithSVGString","setAlpha","flowIndicatorColor","NSColorWithColorSpace","NSColorSpace","deviceRGBColorSpace","flowIndicatorOptionsView","flowIndicatorThicknessWell","NSTextField","flowIndicatorThicknessNum","flowIndicatorColorWell2","flowIndicatorOptionsView2","response","MSColor","colorWithNSColor","color","immutableModelObject","svgRepresentation","flowIndicatorMSColor2","flowIndicatorColor2","flowIndicatorThickness","stringValue","CommonAction","i18nList","i18n","allManifestPath","manifestLangData","dataWithJSONObject_options_error","NSJSONWritingPrettyPrinted","writeToFile_atomically_encoding_error","nowContext","AppController","sharedInstance","pluginManager","reloadPlugins"],"mappings":"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","file":"toolSetting.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/toolSetting.js\");\n","var kPluginDomain;\nvar iconQueryUrl = 'http://123.207.94.56:3000';\nvar loginKey = \"com.sketchplugins.wechat.iconLogin\";\n\nexport function _(context) {\n    var i18nKey = \"com.sketchplugins.wechat.i18n\";\n    var lang = NSUserDefaults.standardUserDefaults().objectForKey(i18nKey);\n    if (lang == undefined) {\n        var macOSVersion = NSDictionary.dictionaryWithContentsOfFile(\"/System/Library/CoreServices/SystemVersion.plist\").objectForKey(\"ProductVersion\") + \"\";\n        lang = NSUserDefaults.standardUserDefaults().objectForKey(\"AppleLanguages\").objectAtIndex(0);\n        lang = (macOSVersion >= \"10.12\") ? lang.split(\"-\").slice(0, -1).join(\"-\") : lang;\n        if (lang.indexOf('zh') > -1) {\n            lang = 'zhCN';\n        } else {\n            lang = 'enUS';\n        }\n        NSUserDefaults.standardUserDefaults().setObject_forKey(lang, i18nKey);\n    }\n    if (encodeURIComponent(lang.toString()).length != 4) {\n        lang = 'enUS';\n        NSUserDefaults.standardUserDefaults().setObject_forKey(lang, i18nKey);\n    }\n\n    function get_(json, context) {\n        var manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"i18n\").URLByAppendingPathComponent(json + \".json\").path();\n        var jsonData = NSData.dataWithContentsOfFile(manifestPath);\n        jsonData = NSString.alloc().initWithData_encoding(jsonData,NSUTF8StringEncoding);\n        return JSON.parse(jsonData);\n    }\n    var i18Content = {};\n    i18Content = get_(lang, context);\n\n    return i18Content;\n};\n\nexport function dialog(context) {\n    var iconImage = NSImage.alloc().initByReferencingFile(context.plugin.urlForResourceNamed(\"icon.png\").path());\n    var alert = COSAlertWindow.new();\n    if (iconImage) {\n        alert.setIcon(iconImage);\n    }\n    return alert;\n}\n\nexport function errorDialog(context,content) {\n    var iconImage = NSImage.alloc().initByReferencingFile(context.plugin.urlForResourceNamed(\"icon.png\").path());\n    var alert = COSAlertWindow.new();\n    if (iconImage) {\n        alert.setIcon(iconImage);\n    }\n    alert.addButtonWithTitle(_(context).checkForUpdate.m9);\n\n    alert.setMessageText(_(context).checkForUpdate.m10);\n    alert.setInformativeText(content);\n    return alert.runModal();\n}\n\nexport function initDefaults(pluginDomain, initialValues) {\n    kPluginDomain = pluginDomain;\n\n    var defaults = NSUserDefaults.standardUserDefaults().objectForKey(kPluginDomain);\n    var defaultValues = {};\n    var dVal;\n\n    for (var key in defaults) {\n        defaultValues[key] = defaults[key]\n    }\n\n    for (var key in initialValues) {\n        dVal = defaultValues[key]\n        if (dVal == nil) defaultValues[key] = initialValues[key]\n    }\n    return defaultValues;\n}\n\nexport function uploadContext(context) {\n    var contextNow = context;\n    contextNow.document = NSDocumentController.sharedDocumentController().currentDocument();\n    contextNow.selection = context.document.selectedLayers().layers();\n    return contextNow;\n}\n\nexport function paste(text) {\n    var pasteBoard = NSPasteboard.generalPasteboard();\n    pasteBoard.declareTypes_owner(NSArray.arrayWithObject(NSPasteboardTypeString),nil);\n    pasteBoard.setString_forType(text,NSPasteboardTypeString);\n}\n\nexport function rgb(a) {\n    var sColor = a.toLowerCase();\n    if (sColor.length === 4) {\n        var sColorNew = \"#\";\n        for (var i = 1; i < 4; i += 1) {\n            sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));\n        }\n        sColor = sColorNew;\n    }\n    //处理六位的颜色值\n    var sColorChange = [];\n    for (var i = 1; i < 7; i += 2) {\n        sColorChange.push(parseInt(\"0x\" + sColor.slice(i, i + 2)));\n    }\n    return sColorChange;\n}\n\nexport function saveDefaults(newValues) {\n    \n}\n\nexport function request(args) {\n    var aara = [args];\n    var task = NSTask.alloc().init();\n    task.setLaunchPath(\"/usr/bin/curl\");\n    task.setArguments(aara);\n    var outputPipe = NSPipe.pipe();\n    task.setStandardOutput(outputPipe);\n    task.launch();\n    var responseData = outputPipe.fileHandleForReading().readDataToEndOfFile();\n    return responseData;\n}\n\nexport function networkRequest(args) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath(\"/usr/bin/curl\");\n    task.setArguments(args);\n    var outputPipe = NSPipe.pipe();\n    task.setStandardOutput(outputPipe);\n    task.launch();\n    var responseData = outputPipe.fileHandleForReading().readDataToEndOfFile();\n    return responseData;\n}\n\n// zip(['-q','-r','-m','-o','-j','/Users/liuxinyu/Desktop/123.zip','/Users/liuxinyu/Desktop/123'])\nexport function zip(args) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath(\"/usr/bin/zip\");\n    task.setArguments(args);\n    var outputPipe = NSPipe.pipe();\n    task.setStandardOutput(outputPipe);\n    task.launch();\n}\n\nexport function encodeData(jsonData) {\n    var result = {};\n    for (var o in jsonData) {\n        result[o] = typeof jsonData != 'object' ? encodeURIComponent(jsonData[o]) : encodeData(jsonData[o]);\n    }\n    return result;\n}\n\nexport function get(args) {\n    var sig = NSUserDefaults.standardUserDefaults().objectForKey(loginKey);\n    var returnData = networkRequest([iconQueryUrl + args[0] + '?sig=' + sig + '&' + args[1]]);\n    var jsonData = NSString.alloc().initWithData_encoding(returnData,NSUTF8StringEncoding);\n    jsonData = JSON.parse(jsonData);\n    if (jsonData.status == 200) {\n        return jsonData;\n    } else {\n        errorDialog(context,jsonData.msg);\n        return jsonData;\n    }\n}\n\nexport function post(args) {\n    var sig = NSUserDefaults.standardUserDefaults().objectForKey(loginKey);\n    var returnData = networkRequest(['-d', 'sig=' + sig + '&' + args[1], iconQueryUrl + args[0]]);\n    var jsonData = NSString.alloc().initWithData_encoding(returnData,NSUTF8StringEncoding);\n    jsonData = JSON.parse(jsonData);\n    if (jsonData.status == 200) {\n        return jsonData;\n    } else {\n        errorDialog(context,jsonData.msg);\n        return jsonData;\n    }\n}\n\nexport function getConfig(json, context) {\n    var manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(json + \".json\").path();\n    return NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n}\n\nexport function openUrlInBrowser(url) {\n    NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(url));\n}\n\nexport function createRadioButtons(options, selectedItem) {\n    var ui = NSRadioButton;\n    var type = NSRadioModeMatrix;\n\n    var rows = Math.ceil(options.length / 2);\n    var columns = ((options.length < 2) ? 1 : 2);\n\n    var selectedRow = Math.floor(selectedItem / 2);\n    var selectedColumn = selectedItem - (selectedRow * 2);\n\n    var buttonCell = NSButtonCell.alloc().init();\n    buttonCell.setButtonType(ui);\n\n\n    var buttonMatrix = NSMatrix.alloc().initWithFrame_mode_prototype_numberOfRows_numberOfColumns(NSMakeRect(20.0, 20.0, 300.0, rows * 25),type,buttonCell,rows,columns);\n    buttonMatrix.setCellSize(NSMakeSize(140, 20));\n\n    for (i = 0; i < options.length; i++) {\n        buttonMatrix.cells().objectAtIndex(i).setTitle(options[i]);\n        buttonMatrix.cells().objectAtIndex(i).setTag(i);\n    }\n\n    if (rows * columns > options.length) {\n        buttonMatrix.cells().objectAtIndex(options.length).setTransparent(true);\n        buttonMatrix.cells().objectAtIndex(options.length).setEnabled(false);\n    }\n    buttonMatrix.selectCellAtRow_column(selectedRow,selectedColumn);\n    return buttonMatrix;\n}\n\nexport function createRadioButtons2(options, selectedItem) {\n    var ui = NSRadioButton;\n    var type = NSRadioModeMatrix;\n\n    var rows = Math.ceil(options.length / 3);\n    var columns = 3;\n\n    var selectedRow = Math.floor(selectedItem / 3);\n    var selectedColumn = selectedItem - (selectedRow * 3);\n\n    var buttonCell = NSButtonCell.alloc().init();\n    buttonCell.setButtonType(ui);\n\n    var buttonMatrix = NSMatrix.alloc().initWithFrame_mode_prototype_numberOfRows_numberOfColumns(NSMakeRect(20.0, 20.0, 300.0, rows * 25),type,buttonCell,rows,columns);\n    buttonMatrix.setCellSize(NSMakeSize(90, 20));\n\n    for (i = 0; i < options.length; i++) {\n        buttonMatrix.cells().objectAtIndex(i).setTitle(options[i]);\n        buttonMatrix.cells().objectAtIndex(i).setTag(i);\n    }\n\n    if (rows * columns > options.length) {\n        buttonMatrix.cells().objectAtIndex(options.length).setTransparent(true);\n        buttonMatrix.cells().objectAtIndex(options.length).setEnabled(false);\n    }\n    buttonMatrix.selectCellAtRow_column(selectedRow,selectedColumn);\n    return buttonMatrix;\n}\n\nexport function createArtboard(context, obj) {\n    var doc = context.document;\n\n    var artboard = new MSArtboardGroup();\n\n    artboard.setName(obj.name);\n\n    var frame = artboard.frame();\n\n    frame.setX(obj.x);\n    frame.setY(obj.y);\n    frame.setWidth(obj.width);\n    frame.setHeight(obj.height);\n    doc.currentPage().addLayer(artboard);\n\n    return artboard;\n}\n\nexport function hexToRgb(hex) {\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (result) {\n        result = {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16),\n        };\n    } else {\n        result = null;\n    }\n    return result;\n}\n\nexport function unique(a) {\n    var res = [];\n\n    for (var i = 0, len = a.length; i < len; i++) {\n        var item = a[i];\n\n        for (var j = 0, jLen = res.length; j < jLen; j++) {\n            if (res[j] === item)\n                break;\n        }\n\n        if (j === jLen)\n            res.push(item);\n    }\n\n    return res;\n}\n\n\nfunction MochaJSDelegate(selectorHandlerDict) {\n    var uniqueClassName = \"MochaJSDelegate_DynamicClass_\" + NSUUID.UUID().UUIDString();\n\n    var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(uniqueClassName, NSObject);\n\n    delegateClassDesc.registerClass();\n\n    //  Handler storage\n\n    var handlers = {};\n\n    //  Define interface\n\n    this.setHandlerForSelector = function (selectorString, func) {\n        var handlerHasBeenSet = (selectorString in handlers);\n        var selector = NSSelectorFromString(selectorString);\n\n        handlers[selectorString] = func;\n\n        if (!handlerHasBeenSet) {\n            /*\n                For some reason, Mocha acts weird about arguments:\n                https://github.com/logancollins/Mocha/issues/28\n\n                We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n            */\n\n            var dynamicHandler = function () {\n                var functionToCall = handlers[selectorString];\n\n                if (!functionToCall) return;\n\n                return functionToCall.apply(delegateClassDesc, arguments);\n            };\n\n            var args = [],\n                regex = /:/g;\n            while (match = regex.exec(selectorString)) args.push(\"arg\" + args.length);\n\n            dynamicFunction = eval(\"(function(\" + args.join(\",\") + \"){ return dynamicHandler.apply(this, arguments); })\");\n\n            delegateClassDesc.addInstanceMethodWithSelector_function_(selector, dynamicFunction);\n        }\n    };\n\n    this.removeHandlerForSelector = function (selectorString) {\n        delete handlers[selectorString];\n    };\n\n    this.getHandlerForSelector = function (selectorString) {\n        return handlers[selectorString];\n    };\n\n    this.getAllHandlers = function () {\n        return handlers;\n    };\n\n    this.getClass = function () {\n        return NSClassFromString(uniqueClassName);\n    };\n\n    this.getClassInstance = function () {\n        return NSClassFromString(uniqueClassName).new();\n    };\n\n    //  Conveience\n\n    if (typeof selectorHandlerDict == \"object\") {\n        for (var selectorString in selectorHandlerDict) {\n            this.setHandlerForSelector(selectorString, selectorHandlerDict[selectorString]);\n        }\n    }\n};\n\n\n//  sketch-measure\n//  common.js\n//  github https://github.com/utom/sketch-measure\n//  Created by utom\n\nexport function SMPanel(options) {\n    coscript.setShouldKeepAround(true);\n    var self = this,\n        result = false;\n    options.url = encodeURI(\"file://\" + options.url);\n    var frame = NSMakeRect(0, 0, options.width, (options.height + 32)),\n        titleBgColor = NSColor.colorWithRed_green_blue_alpha(0.945, 0.945, 0.945, 1),\n        contentBgColor = NSColor.colorWithRed_green_blue_alpha(0.945, 0.945, 0.945, 1);\n\n    if (options.identifier) {\n        var threadDictionary = NSThread.mainThread().threadDictionary();\n        if (threadDictionary[options.identifier]) {\n            return false;\n        }\n    }\n\n    var Panel = NSPanel.alloc().init();\n    Panel.setTitleVisibility(NSWindowTitleHidden);\n    Panel.setTitlebarAppearsTransparent(true);\n    Panel.standardWindowButton(NSWindowCloseButton).setHidden(options.hiddenClose);\n    Panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true);\n    Panel.standardWindowButton(NSWindowZoomButton).setHidden(true);\n    Panel.setFrame_display(frame, false);\n    Panel.setBackgroundColor(contentBgColor);\n\n    var contentView = Panel.contentView();\n    var webView = WebView.alloc().initWithFrame(NSMakeRect(options.showX ? options.showX : 0, options.showY ? options.showY : 0, options.width, options.height));\n    var windowObject = webView.windowScriptObject(),\n        delegate = new MochaJSDelegate({\n            \"webView:didFinishLoadForFrame:\": (function (webView, webFrame) {\n                var SMAction = [\n                        \"function SMAction(hash, data){\",\n                        \"if(data){\",\n                        \"window.SMData = encodeURI(JSON.stringify(data));\",\n                        \"}\",\n                        \"window.location.hash = hash;\",\n                        \"}\"\n                    ].join(\"\"),\n                    DOMReady = [\n                        \"$(\",\n                        \"function(){\",\n                        \"init(\" + JSON.stringify(options.data) + \")\",\n                        \"}\",\n                        \");\"\n                    ].join(\"\");\n\n                windowObject.evaluateWebScript(SMAction);\n                windowObject.evaluateWebScript(DOMReady);\n            }),\n            \"webView:didChangeLocationWithinPageForFrame:\": (function (webView, webFrame) {\n                var request = NSURL.URLWithString(webView.mainFrameURL()).fragment();\n\n                if (request == \"submit\") {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    options.callback(data);\n                    result = true;\n                } else if (request == \"close\") {\n                    if (!options.floatWindow) {\n                        Panel.orderOut(nil);\n                        NSApp.stopModal();\n                    } else {\n                        Panel.close();\n                    }\n                    threadDictionary.removeObjectForKey(options.identifier);\n                } else if (request == 'submitandclose') {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    var closeflag = options.callback(data);\n                    result = true;\n                    if (closeflag) {\n                        if (!options.floatWindow) {\n                            Panel.orderOut(nil);\n                            NSApp.stopModal();\n                        } else {\n                            Panel.close();\n                        }\n                        threadDictionary.removeObjectForKey(options.identifier);\n                    }\n                } else if (request == 'file') {\n                    var panel = NSOpenPanel.openPanel();\n                    panel.setCanChooseDirectories(false);\n                    panel.setCanCreateDirectories(false);\n                    panel.setAllowedFileTypes([\"sketch\", \"json\"]);\n                    panel.setAllowsOtherFileTypes(false);\n                    panel.setExtensionHidden(false);\n                    var clicked = panel.runModal();\n                    if (clicked != NSFileHandlingPanelOKButton) {\n                        windowObject.evaluateWebScript(\"inputFile('\" + '' + \"')\");\n                        return;\n                    }\n                    var firstURL = panel.URLs().objectAtIndex(0);\n                    var unformattedURL = NSString.stringWithFormat(firstURL);\n                    var file_path = unformattedURL.stringByRemovingPercentEncoding();\n                    windowObject.evaluateWebScript(\"inputFile('\" + file_path + \"')\");\n                    windowObject.evaluateWebScript(\"window.location.hash = '';\");\n                } else if (request == 'login') {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    options.loginCallback(data, windowObject);\n                } else if (request == 'pushdata') {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    options.pushdataCallback(data, windowObject);\n                }\n                // windowObject.evaluateWebScript(\"window.location.hash = '';\");\n            })\n        });\n\n    contentView.setWantsLayer(true);\n    contentView.layer().setFrame(contentView.frame());\n    contentView.layer().setCornerRadius(6);\n    contentView.layer().setMasksToBounds(true);\n\n    webView.setBackgroundColor(contentBgColor);\n    webView.setFrameLoadDelegate_(delegate.getClassInstance());\n    webView.setMainFrameURL_(options.url);\n\n    contentView.addSubview(webView);\n\n    var closeButton = Panel.standardWindowButton(NSWindowCloseButton);\n    closeButton.setCOSJSTargetFunction(function (sender) {\n        var request = NSURL.URLWithString(webView.mainFrameURL()).fragment();\n\n        if (options.closeCallback) {\n            options.closeCallback();\n        }\n\n        if (options.identifier) {\n            threadDictionary.removeObjectForKey(options.identifier);\n        }\n\n        self.wantsStop = true;\n        if (options.floatWindow) {\n            Panel.close();\n        } else {\n            Panel.orderOut(nil);\n            NSApp.stopModal();\n        }\n\n    });\n    closeButton.setAction(\"callAction:\");\n\n    var titlebarView = contentView.superview().titlebarViewController().view(),\n        titlebarContainerView = titlebarView.superview();\n    closeButton.setFrameOrigin(NSMakePoint(8, 8));\n    titlebarContainerView.setFrame(NSMakeRect(0, options.height, options.width, 32));\n    titlebarView.setFrameSize(NSMakeSize(options.width, 32));\n    titlebarView.setTransparent(true);\n    titlebarView.setBackgroundColor(titleBgColor);\n    titlebarContainerView.superview().setBackgroundColor(titleBgColor);\n\n    if (options.floatWindow) {\n        Panel.becomeKeyWindow();\n        Panel.setLevel(NSFloatingWindowLevel);\n        if (!options.showX || !options.showY) {\n            Panel.center();\n        }\n        Panel.makeKeyAndOrderFront(nil);\n        if (options.identifier) {\n            threadDictionary[options.identifier] = Panel;\n        }\n        return webView;\n    } else {\n        if (options.identifier) {\n            threadDictionary[options.identifier] = Panel;\n        }\n        NSApp.runModalForWindow(Panel);\n    }\n\n    return windowObject;\n}","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\n\nexport function getFlag(context, refrush) {\n\tvar i18 = _(context).flag;\n\n\tvar kPluginDomainFlag = \"com.sketchplugins.wechat.flag\";\n\tvar lineColorKey = \"com.sketchplugins.wechat.flagcolor\";\n\tvar textCount = 1;\n\tvar scale = 2;\n\tvar isDeleteNum = 0;\n\tvar scaleOptionsMatrix = 0;\n\tvar getConnectionsGroupInPage = function (page) {\n\t\tvar connectionsLayerPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).isflagContainer == true\", kPluginDomainFlag);\n\t\treturn page.children().filteredArrayUsingPredicate(connectionsLayerPredicate).firstObject();\n\t}\n\tvar colorLine = NSUserDefaults.standardUserDefaults().objectForKey(lineColorKey) || \"#1AAD19\";\n\tvar colorLineR = rgb(colorLine)[0]/255;\n\tvar colorLineG = rgb(colorLine)[1]/255;\n\tvar colorLineB = rgb(colorLine)[2]/255;\n\n\tfunction deleteDialog(context) {\n\t\tvar settingsWindow = dialog(context);\n\t\tsettingsWindow.addButtonWithTitle(i18.m1);\n\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\n\t\tsettingsWindow.setMessageText(i18.m3);\n\n\t\tvar ButtonList = [i18.m4, i18.m5];\n\n\t\tscaleOptionsMatrix = createRadioButtons(ButtonList, ButtonList[0]);\n\t\tsettingsWindow.addAccessoryView(scaleOptionsMatrix);\n\t\treturn settingsWindow.runModal();\n\t}\n\n\tvar getLeftFlagNum = function () {\n\t\tvar children = getConnectionsGroupInPage(doc.currentPage());\n\t\tif (children) {\n\t\t\tchildren = children.children();\n\t\t} else {\n\t\t\treturn 1;\n\t\t}\n\t\tvar num = [];\n\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\tvar Reg = new RegExp(\"^\\\\d{1,2}$\");\n\t\t\tvar countL = children[i].name().replace('___p', '').replace('___t', '').replace('___', '');\n\t\t\tif (Reg.test(countL)) {\n\t\t\t\tcountL = parseInt(countL) - 1;\n\t\t\t\tnum[countL] = true;\n\t\t\t}\n\t\t}\n\t\tfor (var k = 0; k < num.length + 1; k++) {\n\t\t\tif (!num[k]) {\n\t\t\t\treturn (k + 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar getRightFlagNum = function (dom) {\n\t\tvar children = getConnectionsGroupInPage(doc.currentPage());\n\t\tif (children) {\n\t\t\tchildren = children.children();\n\t\t} else {\n\t\t\treturn 1;\n\t\t}\n\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\tif (children[i].name() == dom.objectID()) {\n\t\t\t\tvar children2 = children[i].children();\n\t\t\t\tfor (var k = 0; k < children2.length; k++) {\n\t\t\t\t\tvar Reg = new RegExp(\"^\\\\d{1,2}$\");\n\t\t\t\t\tvar countL = children2[k].name().replace('___p', '').replace('___t', '').replace('___', '');\n\t\t\t\t\tif (Reg.test(countL)) {\n\t\t\t\t\t\tcountL = parseInt(countL);\n\t\t\t\t\t\treturn countL;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn 1;\n\t}\n\n\tvar drawLeftArrow = function (doc, dom, isNew) {\n\t\tvar parentArtboard = dom.parentArtboard();\n\t\tif(parentArtboard != undefined && parentArtboard.rect().size.width < 500){\n\t\t    scale = 1;\n\t\t}else{\n\t\t    scale = 2;\n\t\t}\n\t\tvar count;\n\t\tif (isNew) {\n\t\t\tcount = getLeftFlagNum();\n\t\t} else {\n\t\t\tcount = getRightFlagNum(dom);\n\t\t\tif (isDeleteNum != 0 && count > isDeleteNum) {\n\t\t\t\tcount = count - 1;\n\t\t\t}\n\t\t}\n\t\tvar linexl = dom.absoluteRect().x() + dom.rect().size.width;\n\t\tvar liney = dom.absoluteRect().y() + dom.rect().size.height / 2 - (24 * scale / 2);\n\n\t\tvar path = NSBezierPath.bezierPath();\n\t\tpath.moveToPoint(NSMakePoint(22 * scale, 60 * scale))\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(34 * scale, 48 * scale), NSMakePoint(28.625 * scale, 60 * scale), NSMakePoint(34 * scale, 54.625 * scale));\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(22 * scale, 36 * scale), NSMakePoint(34 * scale, 41.375 * scale), NSMakePoint(28.625 * scale, 36 * scale));\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(0, 48 * scale), NSMakePoint(15.375 * scale, 36 * scale), NSMakePoint(0, 48 * scale));\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(22 * scale, 60 * scale), NSMakePoint(0, 48 * scale), NSMakePoint(15.375 * scale, 60 * scale));\n\t\tpath.closePath();\n\t\tpath = MSPath.pathWithBezierPath(path);\n\t\tvar flag = MSShapeGroup.shapeWithBezierPath(path);\n\t\tflag.style().addStylePartOfType(0).setColor(MSImmutableColor.colorWithRed_green_blue_alpha(colorLineR, colorLineG, colorLineB, 0.3));\n\t\tflag.style().addStylePartOfType(1).setColor(MSImmutableColor.colorWithRed_green_blue_alpha(colorLineR, colorLineG, colorLineB, 1));\n\t\tflag.absoluteRect().setX(linexl);\n\t\tflag.absoluteRect().setY(liney);\n\t\tflag.setName('___' + count + '___p');\n\n\t\tvar textLayer = MSTextLayer.alloc().init();\n\n\t\tif (count.toString().length == 1) {\n\t\t\ttextLayer.absoluteRect().setX(linexl + (12 + 26) * scale / 2);\n\t\t} else {\n\t\t\ttextLayer.absoluteRect().setX(linexl + (12 + 18) * scale / 2);\n\t\t}\n\n\t\ttextLayer.absoluteRect().setY(liney + 8 * scale / 2);\n\t\ttextLayer.setName('___' + count + '___t');\n\t\tvar fixedBehaviour = 1;\n\t\ttextLayer.setTextBehaviour(fixedBehaviour);\n\t\ttextLayer.setStringValue(count.toString());\n\t\ttextLayer.setTextColor(MSImmutableColor.colorWithRed_green_blue_alpha(colorLineR, colorLineG, colorLineB, 1));\n\t\ttextLayer.setFontSize(13 * scale);\n\n\t\tdoc.currentPage().addLayers([flag, textLayer]);\n\t\tvar connectionLayers = MSLayerArray.arrayWithLayers([flag, textLayer]);\n\t\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayers);\n\t\tconnectionsGroup.setName(dom.objectID());\n\t\treturn connectionsGroup;\n\t}\n\tvar drawRightArrow = function (doc, dom) {\n\t\tvar parentArtboard = dom.parentArtboard();\n\t\tif(parentArtboard != undefined && parentArtboard.rect().size.width < 500){\n\t\t    scale = 1;\n\t\t}else{\n\t\t    scale = 2;\n\t\t}\n\t\tvar count = getRightFlagNum(dom);\n\t\tif (isDeleteNum != 0 && count > isDeleteNum) {\n\t\t\tcount = count - 1;\n\t\t}\n\t\tvar linexr = dom.absoluteRect().x() - 34 * scale;\n\t\tvar liney = dom.absoluteRect().y() + dom.rect().size.height / 2 - (24 * scale / 2);\n\n\t\tvar path = NSBezierPath.bezierPath();\n\t\tpath.moveToPoint(NSMakePoint(12 * scale, 24 * scale))\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(0 * scale, 12 * scale), NSMakePoint(5.375 * scale, 24 * scale), NSMakePoint(0 * scale, 18.625 * scale));\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(12 * scale, 0 * scale), NSMakePoint(0 * scale, 5.375 * scale), NSMakePoint(5.375 * scale, 0 * scale));\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(34 * scale, 12 * scale), NSMakePoint(18.625 * scale, 0 * scale), NSMakePoint(34 * scale, 12 * scale));\n\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(12 * scale, 24 * scale), NSMakePoint(34 * scale, 12 * scale), NSMakePoint(18.625 * scale, 24 * scale));\n\t\tpath.closePath();\n\t\tpath = MSPath.pathWithBezierPath(path);\n\t\tvar flag = MSShapeGroup.shapeWithBezierPath(path);\n\t\tflag.style().addStylePartOfType(0).setColor(MSImmutableColor.colorWithRed_green_blue_alpha(colorLineR, colorLineG, colorLineB, 0.3));\n\t\tflag.style().addStylePartOfType(1).setColor(MSImmutableColor.colorWithRed_green_blue_alpha(colorLineR, colorLineG, colorLineB, 1));\n\t\tflag.absoluteRect().setX(linexr);\n\t\tflag.absoluteRect().setY(liney);\n\t\tflag.setName('___' + count + '___p');\n\n\t\tvar textLayer = MSTextLayer.alloc().init();\n\n\t\tif (count.toString().length == 1) {\n\t\t\ttextLayer.absoluteRect().setX(linexr + (14) * scale / 2);\n\t\t} else {\n\t\t\ttextLayer.absoluteRect().setX(linexr + (10) * scale / 2);\n\t\t}\n\n\t\ttextLayer.absoluteRect().setY(liney + 8 * scale / 2);\n\t\ttextLayer.setName('___' + count + '___t');\n\t\tvar fixedBehaviour = 1;\n\t\ttextLayer.setTextBehaviour(fixedBehaviour);\n\t\ttextLayer.setStringValue(count.toString());\n\t\ttextLayer.setTextColor(MSImmutableColor.colorWithRed_green_blue_alpha(colorLineR, colorLineG, colorLineB, 1));\n\t\ttextLayer.setFontSize(13 * scale);\n\n\t\tdoc.currentPage().addLayers([flag, textLayer]);\n\t\tvar connectionLayers = MSLayerArray.arrayWithLayers([flag, textLayer]);\n\t\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayers);\n\t\tconnectionsGroup.setName(dom.objectID());\n\t\treturn connectionsGroup;\n\t}\n\n\tfunction isMaxNum(dom) {\n\t\tvar num = getRightFlagNum(dom);\n\t\tvar children = getConnectionsGroupInPage(doc.currentPage());\n\t\tif (children) {\n\t\t\tchildren = children.children();\n\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\tvar Reg = new RegExp(\"^\\\\d{1,2}$\");\n\t\t\t\tvar countL = children[i].name().replace('___p', '').replace('___t', '').replace('___', '');\n\t\t\t\tif (Reg.test(countL)) {\n\t\t\t\t\tif (countL > num) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn true;\n\t}\n\n\tvar drawFunction = function (doc, nowDom) {\n\t\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).FlagID != nil\", kPluginDomainFlag);\n\t\tvar linkLayers = doc.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\t\tvar loop = linkLayers.objectEnumerator();\n\t\tvar returnLine = [];\n\t\tvar isDrawNow = false;\n\t\twhile (linkLayer = loop.nextObject()) {\n\t\t\tvar lastState = 'e';\n\t\t\tvar lastDom = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).FlagID == '\" + linkLayer.objectID() + \"_l'\", kPluginDomainFlag);\n\t\t\tlastDom = doc.currentPage().children().filteredArrayUsingPredicate(lastDom).firstObject();\n\t\t\tif (lastDom) {\n\t\t\t\tlastState = 'l';\n\t\t\t\tif (nowDom && lastDom.objectID() == nowDom.objectID()) {\n\t\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nowDom.objectID() + '_r', \"FlagID\", nowDom, kPluginDomainFlag);\n\t\t\t\t\tlastState = 'r';\n\t\t\t\t\tisDrawNow = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlastDom = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).FlagID == '\" + linkLayer.objectID() + \"_r'\", kPluginDomainFlag);\n\t\t\t\tlastDom = doc.currentPage().children().filteredArrayUsingPredicate(lastDom).firstObject();\n\n\t\t\t\tif (lastDom) {\n\t\t\t\t\tlastState = 'r';\n\t\t\t\t\tif (nowDom && lastDom.objectID() == nowDom.objectID()) {\n\t\t\t\t\t\tif (isMaxNum(nowDom)) {\n\t\t\t\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"FlagID\", nowDom, kPluginDomainFlag);\n\t\t\t\t\t\t\tlastState = 'e';\n\t\t\t\t\t\t\tisDrawNow = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (deleteDialog(context) == 1000) {\n\t\t\t\t\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"FlagID\", nowDom, kPluginDomainFlag);\n\t\t\t\t\t\t\t\tlastState = 'e';\n\t\t\t\t\t\t\t\tisDrawNow = true;\n\t\t\t\t\t\t\t\tif (scaleOptionsMatrix.selectedCell().tag() == 1) {\n\t\t\t\t\t\t\t\t\tisDeleteNum = getRightFlagNum(nowDom);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlastState = 'e';\n\t\t\t\t\t\t\t\tisDrawNow = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlinkLayers = doc.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\t\tloop = linkLayers.objectEnumerator();\n\n\t\twhile (linkLayer = loop.nextObject()) {\n\t\t\tvar lastState = 'e';\n\t\t\tvar lastDom = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).FlagID == '\" + linkLayer.objectID() + \"_l'\", kPluginDomainFlag);\n\t\t\tlastDom = doc.currentPage().children().filteredArrayUsingPredicate(lastDom).firstObject();\n\t\t\tif (lastDom) {\n\t\t\t\tlastState = 'l';\n\t\t\t} else {\n\t\t\t\tlastDom = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).FlagID == '\" + linkLayer.objectID() + \"_r'\", kPluginDomainFlag);\n\t\t\t\tlastDom = doc.currentPage().children().filteredArrayUsingPredicate(lastDom).firstObject();\n\t\t\t\tif (lastDom) {\n\t\t\t\t\tlastState = 'r';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lastState == 'l') {\n\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(linkLayer.objectID() + '_l', \"FlagID\", linkLayer, kPluginDomainFlag);\n\t\t\t\treturnLine = returnLine.concat(drawLeftArrow(doc, linkLayer, false));\n\t\t\t} else if (lastState == 'r') {\n\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(linkLayer.objectID() + '_r', \"FlagID\", linkLayer, kPluginDomainFlag);\n\t\t\t\treturnLine = returnLine.concat(drawRightArrow(doc, linkLayer));\n\t\t\t}\n\t\t}\n\n\t\tif (!isDrawNow && nowDom) {\n\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nowDom.objectID() + '_l', \"FlagID\", nowDom, kPluginDomainFlag);\n\t\t\treturnLine = returnLine.concat(drawLeftArrow(doc, nowDom, true));\n\t\t}\n\n\t\treturn returnLine;\n\t}\n\n\tvar doc = context.document;\n\tvar flags = [];\n\tvar selectedLayers = context.selection;\n\n\tif (context.selection.count() != 1 || refrush) {\n\t\tflags = drawFunction(doc, null);\n\t\tif (!refrush) {\n\t\t\terrorDialog(context,i18.m6);\n\t\t}\n\t} else {\n\t\tflags = drawFunction(doc, context.selection[0]);\n\t}\n\n\n\tvar connectionsGroup = getConnectionsGroupInPage(doc.currentPage());\n\n\tif (connectionsGroup) {\n\t\tconnectionsGroup.removeFromParent();\n\t}\n\n\tvar connectionLayers = MSLayerArray.arrayWithLayers(flags);\n\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayers);\n\tconnectionsGroup.setName(\"___flags\");\n\tconnectionsGroup.setIsLocked(1);\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(true, \"isflagContainer\", connectionsGroup, kPluginDomainFlag);\n\n\tfor (var i = 0; i < context.selection.length; i++) {\n\t\tcontext.selection[i].select_byExpandingSelection(false, false);\n\t}\n\n\tselectedLayers[0].select_byExpandingSelection(true, true);\n\tvar ga = new Analytics(context);\n\tif (ga) ga.sendEvent('flag', 'flag');\n}\n\nvar onRun = function (context) {\n\tgetFlag(context);\n}\n","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\n\n\nexport function getLink(context, refursh) {\n\tvar i18 = _(context).link;\n\n\tvar kPluginDomain = \"com.sketchplugins.wechat.link\";\n\tvar lineColorKeyLink = \"com.sketchplugins.wechat.linecolor\";\n\tvar lineThicknessLinkKey = \"com.sketchplugins.wechat.lineThicknessLink\";\n\tvar selectionDom = \"com.sketchplugins.wechat.selectionDom\";\n\tvar selectionDom1 = \"com.sketchplugins.wechat.selectionDom1\";\n\tvar selectionDom2 = \"com.sketchplugins.wechat.selectionDom2\";\n\tvar LineToArtJL = 200;\n\tvar lineCollections = []; // 所有线的集合 [{ x: 1; y: 2; direction: ‘l’; position: 3 },...]\n\n\n\tvar sanitizeArtboard = function (artboard, context) {\n\t\tif (context.command.valueForKey_onLayer_forPluginIdentifier(\"artboardID\", artboard, kPluginDomain) == nil) {\n\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(artboard.objectID(), \"artboardID\", artboard, kPluginDomain);\n\t\t}\n\t}\n\n\tvar getConnectionsGroupInPage = function (page) {\n\t\tvar connectionsLayerPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).isConnectionsContainer == true\", kPluginDomain);\n\t\treturn page.children().filteredArrayUsingPredicate(connectionsLayerPredicate).firstObject();\n\t}\n\n\tfunction segmentsIntr0(a, b, c, d) {\n\t\t// 三角形abc 面积的2倍\n\t\tvar area_abc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\n\t\t// 三角形abd 面积的2倍\n\t\tvar area_abd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\n\t\t// 面积符号相同则两点在线段同侧,不相交 (对点在线段上的情况,本例当作不相交处理);\n\t\tif (area_abc * area_abd >= 0) {\n\t\t\treturn false;\n\t\t}\n\t\t// 三角形cda 面积的2倍\n\t\tvar area_cda = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\n\t\t// 三角形cdb 面积的2倍\n\t\t// 注意: 这里有一个小优化.不需要再用公式计算面积,而是通过已知的三个面积加减得出.\n\t\tvar area_cdb = area_cda + area_abc - area_abd;\n\t\tif (area_cda * area_cdb >= 0) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction segmentsIntr(a, b, c, d) {\n\t\ta = {\n\t\t\tx: parseInt(a.x),\n\t\t\ty: parseInt(a.y)\n\t\t};\n\t\tb = {\n\t\t\tx: parseInt(b.x),\n\t\t\ty: parseInt(b.y)\n\t\t};\n\t\tvar cc = {\n\t\t\tx: parseInt(c.x),\n\t\t\ty: parseInt(c.y)\n\t\t};\n\t\tvar dd = {\n\t\t\tx: parseInt(d.x),\n\t\t\ty: parseInt(d.y)\n\t\t};\n\n\t\tvar flag = 0;\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\tif (i == 0) {\n\t\t\t\tc = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t} else if (i == 1) {\n\t\t\t\tc = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t} else if (i == 2) {\n\t\t\t\tc = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t} else if (i == 3) {\n\t\t\t\tc = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t}\n\t\t\t// 三角形abc 面积的2倍\n\t\t\tvar area_abc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\n\t\t\t// 三角形abd 面积的2倍\n\t\t\tvar area_abd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\n\t\t\t// 面积符号相同则两点在线段同侧,不相交 (对点在线段上的情况,本例当作不相交处理);\n\t\t\tif (area_abc * area_abd >= 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// 三角形cda 面积的2倍\n\t\t\tvar area_cda = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\n\t\t\t// 三角形cdb 面积的2倍\n\t\t\t// 注意: 这里有一个小优化.不需要再用公式计算面积,而是通过已知的三个面积加减得出.\n\t\t\tvar area_cdb = area_cda + area_abc - area_abd;\n\t\t\tif (area_cda * area_cdb >= 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar t = area_cda / (area_abd - area_abc);\n\t\t\tvar dx = t * (b.x - a.x),\n\t\t\t\tdy = t * (b.y - a.y);\n\t\t\treturn {\n\t\t\t\tx: a.x + dx,\n\t\t\t\ty: a.y + dy,\n\t\t\t\tflag: true\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tflag: false\n\t\t};\n\t}\n\n\tvar findAway = function (line, a, b, doc, endPoisiton) {\n\t\tvar art = doc.artboards();\n\t\tvar pca = a;\n\t\tvar pcb = b;\n\t\tvar lastEndPosition = endPoisiton;\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\t\tvar returnLine = [];\n\t\tvar ax = 0,\n\t\t\tbx = 0,\n\t\t\tay = 0,\n\t\t\tby = 0;\n\t\tvar isReturnFlag = false;\n\t\tif (a.className() != \"MSArtboardGroup\" && a.className() != \"MSSymbolMaster\") {\n\t\t\tif (pca.parentArtboard()) {\n\t\t\t\tpca = pca.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (b.className() != \"MSArtboardGroup\" && b.className() != \"MSSymbolMaster\") {\n\t\t\tif (pcb.parentArtboard()) {\n\t\t\t\tpcb = pcb.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (lastEndPosition == 'l') {\n\t\t\tax = a.x() + a.size().width / 2;\n\t\t\tay = a.y() + a.size().height;\n\t\t\tby = ay + LineToArtJL;\n\t\t} else if (lastEndPosition == 'r') {\n\t\t\tax = a.x() + a.size().width / 2;\n\t\t\tay = a.y();\n\t\t\tby = ay - LineToArtJL;\n\t\t} else if (lastEndPosition == 't') {\n\t\t\tax = a.x() + a.size().width;\n\t\t\tbx = ax + LineToArtJL;\n\t\t\tay = a.y() + a.size().height / 2;\n\t\t} else if (lastEndPosition == 'b') {\n\t\t\tax = a.x();\n\t\t\tbx = ax - LineToArtJL;\n\t\t\tay = a.y() + a.size().height / 2;\n\t\t}\n\n\n\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segmentsIntr0({\n\t\t\t\t\tx: line.ax,\n\t\t\t\t\ty: line.ay\n\t\t\t\t}, {\n\t\t\t\t\tx: line.bx,\n\t\t\t\t\ty: line.by\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t})) {\n\t\t\t\tisReturnFlag = true;\n\t\t\t\tif (endPoisiton == 't') {\n\t\t\t\t\tif (ax <= art[i].absoluteRect().x() + art[i].absoluteRect().size().width) {\n\t\t\t\t\t\tif (bx < art[i].absoluteRect().x() + art[i].absoluteRect().size().width) {\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() + art[i].absoluteRect().size().width + LineToArtJL;\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() + art[i].absoluteRect().size().height / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (endPoisiton == 'b') {\n\t\t\t\t\tif (ax >= art[i].absoluteRect().x()) {\n\t\t\t\t\t\tif (bx > art[i].absoluteRect().x()) {\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() - LineToArtJL;\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() + art[i].absoluteRect().size().height / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (endPoisiton == 'l') {\n\t\t\t\t\tif (ay <= art[i].absoluteRect().y() + art[i].absoluteRect().size().height) {\n\t\t\t\t\t\tif (by < art[i].absoluteRect().y() + art[i].absoluteRect().size().height) {\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() + art[i].absoluteRect().size().height + LineToArtJL;\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() + art[i].absoluteRect().size().width / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (endPoisiton == 'r') {\n\t\t\t\t\tif (ay >= art[i].absoluteRect().y()) {\n\t\t\t\t\t\tif (by > art[i].absoluteRect().y()) {\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() - LineToArtJL;\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() + art[i].absoluteRect().size().width / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturnLine.push({\n\t\t\tx: ax,\n\t\t\ty: ay\n\t\t});\n\t\tif (lastEndPosition == 'l') {\n\t\t\tif (by < b.y() + b.size().height) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.size().width + b.x(),\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'l';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: b.y() + b.size().height\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'b';\n\t\t\t}\n\t\t} else if (lastEndPosition == 'r') {\n\t\t\tif (by > b.y()) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x(),\n\t\t\t\t\ty: by\n\t\t\t\t});\n\n\t\t\t\tendPoisiton = 'r';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: b.y()\n\t\t\t\t});\n\t\t\t\tendPoisiton = 't';\n\t\t\t}\n\t\t} else if (lastEndPosition == 't') {\n\t\t\tif (bx < b.x() + b.size().width) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y()\n\t\t\t\t});\n\t\t\t\tendPoisiton = 't';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width,\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'l';\n\t\t\t}\n\t\t} else if (lastEndPosition == 'b') {\n\t\t\tif (bx > b.x()) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y() + b.size().height\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'b';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x(),\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'r';\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tline: returnLine,\n\t\t\tflag: isReturnFlag,\n\t\t\tendPoisiton: endPoisiton\n\t\t}\n\n\t}\n\n\tvar drawTwoLine = function (a, b, doc) {\n\t\tvar art = doc.artboards();\n\t\tvar pca = a;\n\t\tvar pcb = b;\n\t\tvar endPoisiton;\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\t\tif (a.className() != \"MSArtboardGroup\" && a.className() != \"MSSymbolMaster\") {\n\t\t\tif (pca.parentArtboard()) {\n\t\t\t\tpca = pca.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (b.className() != \"MSArtboardGroup\" && b.className() != \"MSSymbolMaster\") {\n\t\t\tif (pcb.parentArtboard()) {\n\t\t\t\tpcb = pcb.parentArtboard();\n\t\t\t}\n\t\t}\n\t\t//先左右后上下\n\t\tvar axPoint = a.x() + a.size().width / 2;\n\t\tvar ayPoint = a.y() + a.size().height / 2;\n\t\tvar tmpLinePoint = [];\n\t\tvar isReturnFlag = true;\n\t\tif (b.x() > a.x() + a.size().width / 2) {\n\t\t\tstartPointX = a.x() + a.size().width;\n\t\t\tstartPointY = ayPoint;\n\t\t\tendPointX = b.x() + b.size().width / 2;\n\t\t\tendPointY = ayPoint;\n\t\t} else if (b.x() + b.size().width / 2 < a.x()) {\n\t\t\tstartPointX = a.x();\n\t\t\tstartPointY = ayPoint;\n\t\t\tendPointX = b.x() + b.size().width / 2;\n\t\t\tendPointY = ayPoint;\n\t\t}\n\t\ttmpLinePoint = [{\n\t\t\tx: startPointX,\n\t\t\ty: startPointY\n\t\t}, {\n\t\t\tx: endPointX,\n\t\t\ty: endPointY\n\t\t}];\n\n\t\tif (b.y() + b.size().height / 2 > ayPoint) {\n\t\t\tendPointY = b.y();\n\t\t\tendPoisiton = 't';\n\t\t} else {\n\t\t\tendPointY = b.y() + b.size().height;\n\t\t\tendPoisiton = 'b';\n\t\t}\n\t\ttmpLinePoint.push({\n\t\t\tx: endPointX,\n\t\t\ty: endPointY\n\t\t});\n\t\tfor (var k = 0; k < tmpLinePoint.length - 1; k++) {\n\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\tx: tmpLinePoint[k].x,\n\t\t\t\t\ty: tmpLinePoint[k].y\n\t\t\t\t}, {\n\t\t\t\t\tx: tmpLinePoint[k + 1].x + 5,\n\t\t\t\t\ty: tmpLinePoint[k + 1].y + 5\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t});\n\t\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segments.flag == true) {\n\t\t\t\t\tisReturnFlag = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//先上下后左右\n\t\tif (!isReturnFlag) {\n\t\t\ttmpLinePoint.splice(0, tmpLinePoint.length);\n\t\t\tisReturnFlag = true;\n\t\t\tif (b.y() + b.size().height / 2 > ayPoint) {\n\t\t\t\tstartPointY = a.y() + a.size().height;\n\t\t\t} else {\n\t\t\t\tstartPointY = a.y();\n\t\t\t}\n\t\t\tstartPointX = a.x() + a.size().width / 2;\n\t\t\tendPointX = startPointX;\n\t\t\tendPointY = b.y() + b.size().height / 2;\n\t\t\ttmpLinePoint = [{\n\t\t\t\tx: startPointX,\n\t\t\t\ty: startPointY\n\t\t\t}, {\n\t\t\t\tx: endPointX,\n\t\t\t\ty: endPointY\n\t\t\t}];\n\t\t\tif (b.x() > a.x() + a.size().width / 2) {\n\t\t\t\tendPointX = b.x();\n\t\t\t\tendPoisiton = 'r';\n\t\t\t} else {\n\t\t\t\tendPointX = b.x() + b.size().width;\n\t\t\t\tendPoisiton = 'l';\n\t\t\t}\n\t\t\ttmpLinePoint.push({\n\t\t\t\tx: endPointX,\n\t\t\t\ty: endPointY\n\t\t\t});\n\t\t\tfor (var k = 0; k < tmpLinePoint.length - 1; k++) {\n\t\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\t\tx: tmpLinePoint[k].x,\n\t\t\t\t\t\ty: tmpLinePoint[k].y\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: tmpLinePoint[k + 1].x + 5,\n\t\t\t\t\t\ty: tmpLinePoint[k + 1].y + 5\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t\t});\n\t\t\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segments.flag == true) {\n\t\t\t\t\t\tisReturnFlag = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tline: tmpLinePoint,\n\t\t\tflag: isReturnFlag,\n\t\t\tendPoisiton: endPoisiton\n\t\t}\n\t}\n\n\tvar findAway2 = function (a, b, doc) {\n\t\tvar endPoisitonArrow = 'b';\n\t\tvar art = doc.artboards();\n\t\tvar returnLine = [];\n\t\tvar isReturnFlag = false;\n\t\tvar pca = a,\n\t\t\tpcb = b;\n\t\tvar fx;\n\t\tvar zaLength = 0;\n\t\tif (a.className() != \"MSArtboardGroup\" && a.className() != \"MSSymbolMaster\") {\n\t\t\tif (a.parentArtboard()) {\n\t\t\t\tpca = pca.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (b.className() != \"MSArtboardGroup\" && b.className() != \"MSSymbolMaster\") {\n\t\t\tif (pcb.parentArtboard()) {\n\t\t\t\tpcb = pcb.parentArtboard();\n\t\t\t}\n\t\t}\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\n\t\t//确认位置关系 并确定起始点\n\t\tvar qda = [];\n\t\tvar ax, bx, ay, by, nx, ny;\n\t\tvar linePath = [];\n\t\tvar iFlag = 0;\n\n\t\t//左右\n\t\tif (b.x() > a.x()) {\n\t\t\tax = a.size().width + a.x();\n\t\t\tay = a.size().height / 2 + a.y();\n\t\t\tbx = b.x() + 5;\n\t\t\tby = b.size().height / 2 + b.y();\n\t\t\tfx = 'r';\n\t\t\treturnLine.push({\n\t\t\t\tx: parseInt(ax),\n\t\t\t\ty: parseInt(ay)\n\t\t\t});\n\t\t\tif (b.y() > a.y()) {\n\t\t\t\t// 目标在右下角 右下右\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 'b');\n\t\t\t} else {\n\t\t\t\t// 目标在右上角 右上右\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 't');\n\t\t\t}\n\t\t} else {\n\t\t\tax = a.x() - 5;\n\t\t\tay = a.size().height / 2 + a.y();\n\t\t\tbx = b.size().width + b.x();\n\t\t\tby = b.size().height / 2 + b.y();\n\t\t\tfx = 'l';\n\t\t\treturnLine.push({\n\t\t\t\tx: parseInt(ax),\n\t\t\t\ty: parseInt(ay)\n\t\t\t});\n\t\t\tif (b.y() > a.y()) {\n\t\t\t\t// 目标在左下角 左下左\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 'b');\n\t\t\t} else {\n\t\t\t\t// 目标在左上角 左上左\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 't');\n\t\t\t}\n\t\t}\n\n\t\tfunction getLinePath(startPosition, endPoisiton, fx, nextFx) {\n\t\t\tiFlag = iFlag + 1;\n\t\t\tif (iFlag == 15) {\n\t\t\t\treturn iFlag++;\n\t\t\t}\n\t\t\t//找到路径中最近的产生碰撞的元素\n\t\t\tvar pzysx = 0;\n\t\t\tvar pzysy = 0;\n\t\t\tvar isPZ = false;\n\t\t\tvar thisEndPosition = {\n\t\t\t\tx: parseInt(startPosition.x),\n\t\t\t\ty: parseInt(startPosition.y)\n\t\t\t};\n\t\t\tvar PZLine = {\n\t\t\t\tx: parseInt(endPoisiton.x),\n\t\t\t\ty: parseInt(endPoisiton.y)\n\t\t\t};\n\n\t\t\tif (fx == 'l' || fx == 'r') {\n\t\t\t\tPZLine.y = startPosition.y;\n\t\t\t\tif (fx == 'l') {\n\t\t\t\t\tPZLine.x = PZLine.x - pcb.absoluteRect().size().width / 2;\n\t\t\t\t} else {\n\t\t\t\t\tPZLine.x = PZLine.x + pcb.absoluteRect().size().width / 2;\n\t\t\t\t}\n\t\t\t} else if (fx == 't' || fx == 'b') {\n\t\t\t\tPZLine.x = startPosition.x;\n\t\t\t\tif (fx == 't') {\n\t\t\t\t\tPZLine.y = PZLine.y - pcb.absoluteRect().size().height / 2;\n\t\t\t\t} else {\n\t\t\t\t\tPZLine.y = PZLine.y + pcb.absoluteRect().size().height / 2;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar startArtPosition = pca.absoluteRect();\n\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\t\tx: startPosition.x,\n\t\t\t\t\t\ty: startPosition.y\n\t\t\t\t\t},\n\t\t\t\t\tPZLine, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segments.flag == true) {\n\n\t\t\t\t\t//需要一个绕过的情况\n\n\t\t\t\t\tisReturnFlag = true;\n\t\t\t\t\tif ((pzysx < art[i].absoluteRect().x() + art[i].absoluteRect().size().width || !isPZ) && fx == 'l') {\n\t\t\t\t\t\tpzysx = parseInt(art[i].absoluteRect().x() + art[i].absoluteRect().size().width);\n\t\t\t\t\t\tthisEndPosition.x = parseInt(startArtPosition.x() - (startArtPosition.x() - (art[i].absoluteRect().x() + art[i].absoluteRect().size().width)) / 2);\n\t\t\t\t\t\tif (thisEndPosition.x == startPosition.x && thisEndPosition.y == startPosition.y) {\n\t\t\t\t\t\t\tif (nextFx == 'b') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() - LineToArtJL;\n\t\t\t\t\t\t\t} else if (nextFx == 't') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() + art[i].absoluteRect().size().height + LineToArtJL;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturnLine.push({\n\t\t\t\t\t\t\t\tx: parseInt(thisEndPosition.x),\n\t\t\t\t\t\t\t\ty: parseInt(thisEndPosition.y)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgetLinePath(thisEndPosition, endPoisiton, fx, nextFx);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ((pzysx > art[i].absoluteRect().x() || !isPZ) && fx == 'r') {\n\t\t\t\t\t\tpzysx = art[i].absoluteRect().x();\n\t\t\t\t\t\tthisEndPosition.x = parseInt(startArtPosition.x() + startArtPosition.size().width + (art[i].absoluteRect().x() - startArtPosition.x() - startArtPosition.size().width) / 2);\n\t\t\t\t\t\tif (thisEndPosition.x == startPosition.x && thisEndPosition.y == startPosition.y) {\n\t\t\t\t\t\t\tif (nextFx == 'b') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() - LineToArtJL;\n\t\t\t\t\t\t\t} else if (nextFx == 't') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() + art[i].absoluteRect().size().height + LineToArtJL;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturnLine.push({\n\t\t\t\t\t\t\t\tx: parseInt(thisEndPosition.x),\n\t\t\t\t\t\t\t\ty: parseInt(thisEndPosition.y)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgetLinePath(thisEndPosition, endPoisiton, fx, nextFx);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ((pzysy > art[i].absoluteRect().y() + art[i].absoluteRect().size().height || !isPZ) && fx == 't') {\n\t\t\t\t\t\tpzysy = art[i].absoluteRect().y() + art[i].absoluteRect().size().height;\n\t\t\t\t\t\tthisEndPosition.y = parseInt(startPosition.y - (startPosition.y - (art[i].absoluteRect().y() + art[i].absoluteRect().size().height)) / 2);\n\n\t\t\t\t\t} else if ((pzysy > art[i].absoluteRect().y() || !isPZ) && fx == 'b') {\n\t\t\t\t\t\tpzysy = art[i].absoluteRect().y();\n\t\t\t\t\t\tthisEndPosition.y = parseInt(startPosition.y + (art[i].absoluteRect().y() - startPosition.y) / 2);\n\t\t\t\t\t}\n\t\t\t\t\tisPZ = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar endObject = {};\n\n\t\t\tif (isPZ) {\n\t\t\t\tif (fx == 'l' || fx == 'r') {\n\t\t\t\t\tzaLength++;\n\t\t\t\t} else {\n\t\t\t\t\tzaLength--;\n\t\t\t\t}\n\t\t\t\tif (zaLength > 0) {\n\t\t\t\t\tif (b.x() > a.x()) {\n\t\t\t\t\t\tendPoisiton.x = b.x() + 10;\n\t\t\t\t\t\tendPoisiton.y = b.size().height / 2 + b.y();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendPoisiton.x = b.size().width + b.x() - 10;\n\t\t\t\t\t\tendPoisiton.y = b.size().height / 2 + b.y();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (b.y() < a.y()) {\n\t\t\t\t\t\tendPoisiton.x = b.x() + b.size().width / 2;\n\t\t\t\t\t\tendPoisiton.y = b.y() + b.size().height - 10;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendPoisiton.x = b.x() + b.size().width / 2;\n\t\t\t\t\t\tendPoisiton.y = b.y() + 10;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tendObject = {\n\t\t\t\t\tx: parseInt(thisEndPosition.x),\n\t\t\t\t\ty: parseInt(thisEndPosition.y)\n\t\t\t\t};\n\t\t\t\tpzysx = 0;\n\t\t\t\tpzysy = 0;\n\t\t\t} else {\n\t\t\t\tif (fx == 'l' || fx == 'r') {\n\t\t\t\t\tendObject = {\n\t\t\t\t\t\tx: parseInt(endPoisiton.x),\n\t\t\t\t\t\ty: parseInt(startPosition.y)\n\t\t\t\t\t};\n\t\t\t\t} else if (fx == 't' || fx == 'b') {\n\t\t\t\t\tendObject = {\n\t\t\t\t\t\tx: parseInt(startPosition.x),\n\t\t\t\t\t\ty: parseInt(endPoisiton.y)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tif (returnLine[returnLine.length - 1].x != endObject.x || returnLine[returnLine.length - 1].y != endObject.y) {\n\t\t\t\treturnLine.push(endObject);\n\t\t\t\t//判断是不是撞到目标了\n\t\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\t\t\tx: startPosition.x,\n\t\t\t\t\t\t\ty: startPosition.y\n\t\t\t\t\t\t},\n\t\t\t\t\t\tendObject, {\n\t\t\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tif (pcb.objectID() == art[i].objectID() && segments.flag == true) {\n\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\treturnLine.push({\n\t\t\t\t\t\t\tx: parseInt(segments.x),\n\t\t\t\t\t\t\ty: parseInt(segments.y)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (fx == 'b') {\n\t\t\t\t\t\t\tendPoisitonArrow = 't';\n\t\t\t\t\t\t} else if (fx == 't') {\n\t\t\t\t\t\t\tendPoisitonArrow = 'b';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tendPoisitonArrow = fx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t}\n\n\t\t\tif (parseInt(endObject.x) != parseInt(endPoisiton.x) || parseInt(endObject.y) != parseInt(endPoisiton.y)) {\n\t\t\t\tgetLinePath(endObject, endPoisiton, nextFx, fx);\n\t\t\t} else {\n\t\t\t\tendPoisitonArrow = fx;\n\t\t\t\tif (fx == 'b') {\n\t\t\t\t\tendPoisitonArrow = 't';\n\t\t\t\t} else if (fx == 't') {\n\t\t\t\t\tendPoisitonArrow = 'b';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (iFlag == 16) {\n\t\t\terrorDialog(context,pca.name() + i18.m1 + pcb.name() + i18.m2);\n\t\t}\n\n\t\treturn {\n\t\t\tline: returnLine,\n\t\t\tflag: isReturnFlag,\n\t\t\tendPoisiton: endPoisitonArrow\n\t\t}\n\t}\n\n\tvar drawPPP = function (a, b, doc) {\n\t\tvar domA = a;\n\t\tvar domB = b;\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\t\tvar startPointX;\n\t\tvar startPointY;\n\t\tvar endPointX;\n\t\tvar endPointY;\n\t\tvar endPoisiton = 'l';\n\t\tvar tempPointX;\n\t\tvar tempPointY;\n\n\t\t//先确定是否可以走直线\n\t\tvar axPoint = a.x() + a.size().width / 2;\n\t\tvar ayPoint = a.y() + a.size().height / 2;\n\n\t\t//是否是上下关系\n\t\tif (b.x() < axPoint && axPoint < b.x() + b.size().width) {\n\t\t\tstartPointX = axPoint;\n\t\t\tendPointX = axPoint;\n\t\t\tvar plus = true;\n\t\t\t//在上边\n\t\t\tif (a.y() > b.y()) {\n\t\t\t\tstartPointY = a.y();\n\t\t\t\tendPointY = b.y() + b.size().height;\n\t\t\t\tendPoisiton = 'b';\n\t\t\t} else {\n\t\t\t\t//在下边\n\t\t\t\tstartPointY = a.y() + a.size().height;\n\t\t\t\tendPointY = b.y();\n\t\t\t\tendPoisiton = 't';\n\t\t\t\tplus = false;\n\t\t\t}\n\t\t\tvar line;\n\t\t\tvar returnLine = findAway({\n\t\t\t\tax: startPointX,\n\t\t\t\tay: startPointY,\n\t\t\t\tbx: endPointX,\n\t\t\t\tby: endPointY\n\t\t\t}, domA, domB, doc, endPoisiton);\n\t\t\t//三根线算法\n\t\t\tif (returnLine.flag) {\n\t\t\t\tstartPointX = returnLine.line[0].x;\n\t\t\t\tstartPointY = returnLine.line[0].y;\n\t\t\t\tendPointX = returnLine.line[returnLine.line.length - 1].x;\n\t\t\t\tendPointY = returnLine.line[returnLine.line.length - 1].y;\n\t\t\t\tline = drawLine(returnLine.line, endPoisiton, true);\n\t\t\t\tendPoisiton = returnLine.endPoisiton;\n\t\t\t} else {\n\t\t\t\tline = drawLine([{\n\t\t\t\t\tx: startPointX,\n\t\t\t\t\ty: startPointY\n\t\t\t\t}, {\n\t\t\t\t\tx: endPointX,\n\t\t\t\t\ty: endPointY\n\t\t\t\t}], endPoisiton);\n\t\t\t}\n\t\t}\n\t\t//是否是左右关系\n\t\telse if (b.y() < ayPoint && ayPoint < b.y() + b.size().height) {\n\t\t\tstartPointY = ayPoint;\n\t\t\tendPointY = ayPoint;\n\t\t\tvar plus = true;\n\t\t\tif (a.x() > b.x()) {\n\t\t\t\t//在右边\n\t\t\t\tstartPointX = a.x();\n\t\t\t\tendPointX = b.x() + b.size().width;\n\t\t\t\tendPoisiton = 'l';\n\t\t\t} else {\n\t\t\t\t//在左边\n\t\t\t\tstartPointX = a.x() + a.size().width;\n\t\t\t\tendPointX = b.x();\n\t\t\t\tendPoisiton = 'r';\n\t\t\t\tplus = false;\n\t\t\t}\n\t\t\tvar line;\n\t\t\tvar returnLine = findAway({\n\t\t\t\tax: startPointX,\n\t\t\t\tay: startPointY,\n\t\t\t\tbx: endPointX,\n\t\t\t\tby: endPointY\n\t\t\t}, domA, domB, doc, endPoisiton);\n\t\t\t//三根线算法\n\t\t\tif (returnLine.flag) {\n\t\t\t\tline = drawLine(returnLine.line, returnLine.endPoisiton, true);\n\t\t\t} else {\n\t\t\t\tline = drawLine([{\n\t\t\t\t\tx: startPointX,\n\t\t\t\t\ty: startPointY\n\t\t\t\t}, {\n\t\t\t\t\tx: endPointX,\n\t\t\t\t\ty: endPointY\n\t\t\t\t}], endPoisiton);\n\t\t\t}\n\t\t}\n\t\t// 都不是，要用两根线了\n\t\telse if (b.y() + b.size().height / 2 < ayPoint || b.y() + b.size().height / 2 > ayPoint) {\n\t\t\tvar returnLine = drawTwoLine(domA, domB, doc);\n\t\t\tif (returnLine.flag == false) {\n\t\t\t\treturnLine = findAway2(domA, domB, doc);\n\t\t\t}\n\t\t\tlog(returnLine);\n\t\t\tline = drawLine(returnLine.line, returnLine.endPoisiton, true);\n\n\n\t\t}\n\t\treturn line;\n\t}\n\n\t/*\n\t * 获取两个点（有顺序的点）连成线的方向\n\t */\n\tvar getLineDirection = function (pointeOne, pointTwo) {\n\t\tif (pointeOne.x === pointTwo.x) { // 两个点的 x 相同\n\t\t\tif (pointeOne.y > pointTwo.y) { // 上\n\t\t\t\treturn 't';\n\t\t\t} else { // 下\n\t\t\t\treturn 'b';\n\t\t\t}\n\t\t} else { // 两个点的 y 相同\n\t\t\tif (pointeOne.x > pointTwo.x) { // 左\n\t\t\t\treturn 'l';\n\t\t\t} else { // 右\n\t\t\t\treturn 'r';\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * 获取两个点（有顺序的点）连成线的位置\n\t */\n\tvar getLinePosition = function (point) {\n\t\tif (point.direction == 't' || point.direction == 'b') {\n\t\t\treturn point.x;\n\t\t} else {\n\t\t\treturn point.y;\n\t\t}\n\t}\n\n\tvar isCoincidenis = function (a,b) {\n\t\tvar c = {a:Math.min(a.a,a.b),b:Math.min(a.a,a.b)};\n\t\tvar d = {a:Math.min(b.a,b.b),b:Math.min(b.a,b.b)};\n\t\tlog(c);\n\t\tlog(d);\n\t\tif((c.a >= d.a && c.a <= d.b) || (c.b >= d.a && c.b <= d.b)){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tvar drawLine = function (linepoint, endPoisiton, isLess) {\n\t\tvar colorLineLink = NSUserDefaults.standardUserDefaults().objectForKey(lineColorKeyLink) || \"#1AAD19\";\n\t\tvar lineThicknessLink = NSUserDefaults.standardUserDefaults().objectForKey(lineThicknessLinkKey) || \"6\";\n\t\tvar colorLineLinkR = rgb(colorLineLink)[0];\n\t\tvar colorLineLinkG = rgb(colorLineLink)[1];\n\t\tvar colorLineLinkB = rgb(colorLineLink)[2];\n\t\tvar linePaths = [];\n\t\tvar linePath = NSBezierPath.bezierPath();\n\n\t\tvar lineCount = linepoint.length;\n\t\tvar offset = 20;\n\t\tvar coincideOffset = lineThicknessLink * 5;\n\n\t\tfor (var i = 0; i < lineCount - 1; i++) { // 给每个点添加接下来走向的方向和位置属性\n\t\t\tlinepoint[i].direction = getLineDirection(linepoint[i], linepoint[i + 1]);\n\t\t\tlinepoint[i].position = getLinePosition(linepoint[i]);\n\t\t\tlineCollections.push(linepoint[i]);\n\t\t}\n\n\tvar comparedLineCollectionCount = lineCollections.length - (lineCount - 1);\n\n\t// 解决线重合问题\n\tfor (var i = 0; i < lineCount; i++) {\n\t\tfor (var j = 0; j < comparedLineCollectionCount; j++) {\n\t\t\tif ((linepoint[i].direction == 't' || linepoint[i].direction == 'b') &&\n\t\t\t\t(Math.abs(linepoint[i].position - lineCollections[j].position) < 3) && isCoincidenis({a:linepoint[i].x,b:linepoint[i+1].x},{a:lineCollections[j].x,b:lineCollections[j+1].x})) {\n\t\t\t\t// 不是起始线重合，位于起始点左侧 || 起始线重合: 位于重合线下侧，减去 coincideOffset\n\t\t\t\tif ((i != 0 && linepoint[0].x < linepoint[i].x) ||\n\t\t\t\t\t(i == 0 && (linepoint[0].y < lineCollections[j].y))) {\n\t\t\t\t\tlinepoint[i].x -= coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].x -= coincideOffset;\n\t\t\t\t} else {\n\t\t\t\t\tlinepoint[i].x += coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].x += coincideOffset;\n\t\t\t\t}\n\t\t\t} else if ((linepoint[i].direction == 'l' || linepoint[i].direction == 'r') &&\n\t\t\t\t(Math.abs(linepoint[i].position - lineCollections[j].position) < 3) && isCoincidenis({a:linepoint[i].y,b:linepoint[i+1].y},{a:lineCollections[j].y,b:lineCollections[j+1].y})) {\n\t\t\t\t// 不是起始线重合，位于起始点上侧 || 起始线重合: 位于重合线左侧，减去 coincideOffset\n\t\t\t\tif ((i != 0 && linepoint[0].y < linepoint[i].y) ||\n\t\t\t\t\t(i == 0 && linepoint[0].x < lineCollections[j].x)) {\n\t\t\t\t\tlinepoint[i].y -= coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].y -= coincideOffset;\n\t\t\t\t} else {\n\t\t\t\t\tlinepoint[i].y += coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].y += coincideOffset;\n\t\t\t\t}\n\t\t\t} else {}\n\t\t}\n\t}\n\n\tfor (var i = 0; i < lineCount - 1; i++) {\n\t\tif (i === 0) { // 第一个点不做修改\n\t\t\tlinePath.moveToPoint(NSMakePoint(linepoint[i].x, linepoint[i].y));\n\t\t}\n\t\tif (i === lineCount - 2) { // 倒数第二个点绘制直线\n\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y));\n\t\t} else {\n\t\t\t// 先绘制到下一个点的直线，然后绘制到下下个点的曲线\n\t\t\t// 0.13 = 1 - cos(30)\n\t\t\t// 0.5 = 1- sin(30)\n\t\t\tif (linepoint[i].direction === 't') { // 上\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y + offset));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 'l') { // 下一条线的方向 左\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x - offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y + offset * 0.5), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y + offset * 0.13));\n\t\t\t\t} else { // 右\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x + offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y + offset * 0.5), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y + offset * 0.13));\n\t\t\t\t}\n\t\t\t} else if (linepoint[i].direction === 'b') { // 下\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y - offset));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 'l') { // 下一条线的方向 左\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x - offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y - offset * 0.5), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y - offset * 0.13));\n\t\t\t\t} else { // 右\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x + offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y - offset * 0.5), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y - offset * 0.13));\n\t\t\t\t}\n\t\t\t} else if (linepoint[i].direction === 'l') { // 左\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x + offset, linepoint[i + 1].y));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 't') { // 下一条线的方向 上\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y - offset), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y - offset * 0.13), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y - offset * 0.5));\n\t\t\t\t} else { // 下\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y + offset), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y + offset * 0.13), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y + offset * 0.5));\n\t\t\t\t}\n\t\t\t} else { // 右\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x - offset, linepoint[i + 1].y));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 't') { // 下一条线的方向 上\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y - offset), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y - offset * 0.13), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y - offset * 0.5));\n\t\t\t\t} else { // 下\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y + offset), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y + offset * 0.13), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y + offset * 0.5));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tlinePath = MSPath.pathWithBezierPath(linePath);\n\tvar lineSh = MSShapeGroup.shapeWithBezierPath(linePath);\n\tvar hitAreaBorder = lineSh.style().addStylePartOfType(1);\n\thitAreaBorder.setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 255).newMutableCounterpart());\n\thitAreaBorder.setThickness(lineThicknessLink);\n\thitAreaBorder.setPosition(0);\n\tlineSh.setName('Line');\n\n\t// 绘制起点圆圈\n\tvar drawRound = function (x, y) {\n\t\tvar linkRect = NSInsetRect(NSMakeRect(x, y, 0, 0), -5, -5);\n\t\tvar path = NSBezierPath.bezierPathWithOvalInRect(linkRect);\n\t\tpath = MSPath.pathWithBezierPath(path);\n\t\tvar hitAreaLayer = MSShapeGroup.shapeWithBezierPath(path);\n\t\thitAreaLayer.style().addStylePartOfType(0).setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 76.5).newMutableCounterpart());\n\t\thitAreaLayer.style().addStylePartOfType(1).setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 255).newMutableCounterpart());\n\t\thitAreaLayer.setName('Point');\n\t\treturn hitAreaLayer;\n\t}\n\n\t// 绘制终点箭头\n\tvar drawArrow = function (x, y, z) {\n\t\t// 绘制箭头\n\t\tvar arrowDirection = z; // 1. 箭头方向\n\t\tvar arrowOffset = 20 * (lineThicknessLink / 6); // 2. 箭头长度\n\t\tvar arrowPath = NSBezierPath.bezierPath();\n\n\t\tarrowPath.moveToPoint(NSMakePoint(x, y));\n\t\tif (arrowDirection == 't') {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y + arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y + arrowOffset));\n\t\t} else if (arrowDirection == 'b') {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y - arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y - arrowOffset));\n\t\t} else if (arrowDirection == 'l') {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y - arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y + arrowOffset));\n\t\t} else {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y - arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y + arrowOffset));\n\t\t}\n\t\tarrowPath = MSPath.pathWithBezierPath(arrowPath);\n\t\tvar arrow = MSShapeGroup.shapeWithBezierPath(arrowPath);\n\t\tvar arrowStyle = arrow.style().addStylePartOfType(1);\n\t\tarrowStyle.setThickness(lineThicknessLink);\n\t\tarrowStyle.setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 255).newMutableCounterpart());\n\t\tarrow.setName('Arrow');\n\t\treturn arrow;\n\t}\n\n\tvar startRound = drawRound(linepoint[0].x, linepoint[0].y);\n\n\tvar endArrow = drawArrow(linepoint[lineCount - 1].x, linepoint[lineCount - 1].y, linepoint[lineCount - 2].direction);\n\n\treturn [lineSh, startRound, endArrow];\n}\n\nvar drawConnections = function (connection, doc) {\n\tvar draw = drawPPP(connection.linkRect, connection.artboard, doc);\n\tdoc.addLayers(draw);\n\n\tvar connectionLayersDom = MSLayerArray.arrayWithLayers(draw);\n\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayersDom);\n\tconnectionsGroup.setName(connection.linkRect.objectID());\n\treturn connectionsGroup;\n}\n\nvar redrawConnections = function (context) {\n\tvar doc = context.document;\n\tvar selectionLayer = context.selection;\n\n\t//var selectedLayers = doc.findSelectedLayers();\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\tlinkLayers = doc.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\tloop = linkLayers.objectEnumerator(),\n\tconnections = [],\n\tlinkLayer, destinationArtboardID, destinationArtboard, isCondition, linkRect;\n\n\tvar connectionsGroup = getConnectionsGroupInPage(doc.currentPage());\n\tif (connectionsGroup) {\n\t\tconnectionsGroup.removeFromParent();\n\t}\n\n\twhile (linkLayer = loop.nextObject()) {\n\t\tdestinationArtboardID = context.command.valueForKey_onLayer_forPluginIdentifier(\"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\tvar Message = destinationArtboardID.split('____');\n\t\tdestinationArtboard = doc.currentPage().children().filteredArrayUsingPredicate(NSPredicate.predicateWithFormat(\"(objectID == %@) || (userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).artboardID == %@)\", Message[1], kPluginDomain, Message[1])).firstObject();\n\n\t\tif (destinationArtboard && Message[0] == linkLayer.objectID()) {\n\t\t\tsanitizeArtboard(destinationArtboard, context);\n\t\t\tconnections.push(drawConnections({\n\t\t\t\tlinkRect: linkLayer,\n\t\t\t\tartboard: destinationArtboard\n\t\t\t}, doc.currentPage()));\n\t\t}\n\t}\n\n\tvar connectionLayers = MSLayerArray.arrayWithLayers(connections);\n\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayers);\n\tconnectionsGroup.setName(\"Connections\");\n\tconnectionsGroup.setIsLocked(1);\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(true, \"isConnectionsContainer\", connectionsGroup, kPluginDomain);\n\n\tfor (var i = 0; i < context.selection.length; i++) {\n\t\tcontext.selection[i].select_byExpandingSelection(false, false);\n\t}\n\n\tfor (var i = 0; i < selectionLayer.count(); i++) {\n\t\tselectionLayer[i].select_byExpandingSelection(true, true);\n\t}\n\n\treturn connectionsGroup;\n}\n\nvar selection = context.selection;\nvar destArtboard, linkLayer;\n\n// 检查有没有被手动删掉的\nvar connectionsGroup = getConnectionsGroupInPage(context.document.currentPage());\nif (!connectionsGroup) {\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\tlinkLayers = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\tloop = linkLayers.objectEnumerator(),\n\tlinkLayer, destinationArtboardID;\n\twhile (linkLayer = loop.nextObject()) {\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"destinationArtboardID\", linkLayer, kPluginDomain);\n\t}\n}else{\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\tlinkLayers = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\tloop = linkLayers.objectEnumerator(),\n\tlinkLayer, destinationArtboardID;\n\tvar child = connectionsGroup.layers();\n\twhile (linkLayer = loop.nextObject()) {\n\t\tfor(var i = 0;i < child.length; i++){\n\t\t\tif(encodeURIComponent(child[i].name()) == encodeURIComponent(linkLayer.objectID())){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(i == child.length-1){\n\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\t\t}\n\t\t}\n\t}\t\t\n}\n\nif (selection.count() != 1 && selection.count() != 2) {\n\tredrawConnections(context);\n\tif (!refursh) {\n\t\treturn errorDialog(context,i18.m3);\n\t}\n}\n\nif (selection.count() == 1) {\n\tvar loop = context.selection.objectEnumerator(),\n\t\tlinkLayer, destinationArtboardID;\n\twhile (linkLayer = loop.nextObject()) {\n\t\tdestinationArtboardID = context.command.valueForKey_onLayer_forPluginIdentifier(\"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\tif (!destinationArtboardID) {\n\t\t\tcontinue;\n\t\t}\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"destinationArtboardID\", linkLayer, kPluginDomain);\n\t}\n\n} else if (selection.count() == 2) {\n\tif (selection.firstObject().className() == \"MSArtboardGroup\" || selection.firstObject().className() == \"MSSymbolMaster\") {\n\t\tif ((selection.firstObject().className() == \"MSArtboardGroup\" || selection.firstObject().className() == \"MSSymbolMaster\") && (selection.lastObject().className() == \"MSArtboardGroup\" || selection.lastObject().className() == \"MSSymbolMaster\")) {\n\t\t\tlinkLayer = selection[1];\n\t\t\tdestArtboard = selection[0];\n\t\t} else {\n\t\t\tdestArtboard = selection[0];\n\t\t\tlinkLayer = selection[1];\n\t\t}\n\t} else if (selection.lastObject().className() == \"MSArtboardGroup\" || selection.lastObject().className() == \"MSSymbolMaster\") {\n\t\tdestArtboard = selection.lastObject();\n\t\tlinkLayer = selection.firstObject();\n\t} else {\n\t\tvar manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"manifest.json\").path(),\n\t\t\tmanifest = NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n\n\t\tif (JSON.stringify(manifest.commands[0]).indexOf('SelectionChanged.finish') > -1) {\n\t\t\tvar Selection = NSUserDefaults.standardUserDefaults().objectForKey(selectionDom) || '';\n\t\t\tSelection = Selection.split(',');\n\t\t\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).selection1 == '\" + Selection[0] + \"'\", selectionDom1);\n\t\t\tlinkLayer = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate).firstObject();\n\t\t\tvar linkLayersPredicate2 = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).selection2 == '\" + Selection[1] + \"'\", selectionDom2);\n\t\t\tdestArtboard = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate2).firstObject();\n\t\t} else {\n\t\t\treturn context.document.showMessage(i18.m4);\n\t\t}\n\t}\n\tvar artboardID = destArtboard.objectID();\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(artboardID, \"artboardID\", destArtboard, kPluginDomain);\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(linkLayer.objectID() + '____' + artboardID, \"destinationArtboardID\", linkLayer, kPluginDomain);\n}\n\nredrawConnections(context);\nvar ga = new Analytics(context);\nif (ga) ga.sendEvent('link', 'link');\n}\n\nvar onRun = function (context) {\n\tgetLink(context);\n}","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\nimport {getLink} from \"./link\";\nimport {getFlag} from \"./flag\";\n\nvar lineColorKey = \"com.sketchplugins.wechat.linecolor\";\nvar flagColorKey = \"com.sketchplugins.wechat.flagcolor\";\nvar lineThicknessKey = \"com.sketchplugins.wechat.lineThicknessLink\";\n\nfunction drawIcon(sender) {\n\tvar size = sender.frame().size;\n\tvar image = NSImage.imageWithSize(size);\n\timage.lockFocus();\n\tNSColor.colorWithCalibratedRed_green_blue_alpha(0.157,0.78,0.4,1).set();\n\n\tvar path = NSBezierPath.bezierPath();\n\tpath.moveToPoint(NSMakePoint(10.1, 1));\n\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(11.81, 1.73), NSMakePoint(10.65, 1), NSMakePoint(11.42, 1.32));\n\tpath.lineToPoint(NSMakePoint(14, 4));\n\tpath.lineToPoint(NSMakePoint(22, 4));\n\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(25, 7), NSMakePoint(23.65, 4), NSMakePoint(25, 5.34));\n\tpath.lineToPoint(NSMakePoint(25, 16));\n\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(22, 19), NSMakePoint(25, 17.66), NSMakePoint(23.66, 19));\n\tpath.lineToPoint(NSMakePoint(4, 19));\n\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(1, 16), NSMakePoint(2.34, 19), NSMakePoint(1, 17.65));\n\tpath.lineToPoint(NSMakePoint(1, 4));\n\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(4, 1), NSMakePoint(1, 2.34), NSMakePoint(2.34, 1));\n\tpath.lineToPoint(NSMakePoint(10, 1));\n\n\tpath.stroke();\n\timage.unlockFocus();\n\treturn image;\n}\n\nfunction addButton(index, func) {\n\tvar button = NSButton.alloc().initWithFrame(NSMakeRect(250, 10, 26, 24));\n\tbutton.setButtonType(1);\n\tbutton.bezelStyle = 1;\n\tbutton.bordered = 0;\n\tbutton.tag = index;\n\tbutton.allowsMixedState = true; // 仅初始化状态为混合态时允许\n\tbutton.state = true;\n\tvar imageState = drawIcon(button);\n\tbutton.image = imageState;\n\tbutton.cell().imageScaling = 1;\n\tbutton.setCOSJSTargetFunction(function (sender) {\n\t\tfunc(sender);\n\t});\n\treturn button;\n}\n\nvar onRun = function (context) {\n\tvar manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"manifest.json\").path(),\n\t\tmanifest = NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n\n\tvar manifestPathZh = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"i18n\").URLByAppendingPathComponent(\"manifest.json\").path(),\n\t\tmanifestZh = NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n\n\tvar manifestPathEn = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"i18n\").URLByAppendingPathComponent(\"manifest.json\").path(),\n\t\tmanifestEn = NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n\n\tvar i18t = _(context).toolSetting;\n\tvar settingsWindow = dialog(context);\n\tsettingsWindow.addButtonWithTitle(i18t.m1);\n\tsettingsWindow.addButtonWithTitle(i18t.m2);\n\n\tvar items = [i18t.m7];\n\n\tvar isChecked = false;\n\tif (JSON.stringify(manifest.commands[0]).indexOf('SelectionChanged.finish') > -1) {\n\t\tisChecked = true;\n\t}\n\tvar w = 400,\n\t\th = items.length * 30;\n\tvar view = NSView.alloc().initWithFrame(NSMakeRect(20.0, 20.0, 400, h));\n\tvar frame = NSMakeRect(0, 0, w, 30);\n\tvar buttons = [];\n\tfor (var i = 0; i < items.length; i++) {\n\t\tvar title = items[i];\n\t\tvar button = NSButton.alloc().initWithFrame(frame);;\n\t\tbutton.setButtonType(NSSwitchButton);\n\t\tbutton.bezelStyle = 0;\n\n\t\tbutton.title = title;\n\t\tif (isChecked) {\n\t\t\tbutton.state = true;\n\t\t} else {\n\t\t\tbutton.state = false;\n\t\t}\n\t\tbuttons[i] = button;\n\t\tview.addSubview(button);\n\t\tframe.origin.y += frame.size.height;\n\t}\n\tsettingsWindow.addAccessoryView(view);\n\n\n\tsettingsWindow.setMessageText(i18t.m3);\n\tsettingsWindow.addTextLabelWithValue(i18t.m4);\n\n\tvar flowIndicatorColorWell = NSColorWell.alloc().initWithFrame(NSMakeRect(0, 0, 44, 23));\n\tvar flowIndicatorColorHex = NSUserDefaults.standardUserDefaults().objectForKey(lineColorKey) || \"#1AAD19\";\n\tvar flowIndicatorColorAlpha = 1;\n\tvar flowIndicatorMSColor = MSImmutableColor.colorWithSVGString(flowIndicatorColorHex);\n\tflowIndicatorMSColor.setAlpha(flowIndicatorColorAlpha);\n\tvar flowIndicatorColor = flowIndicatorMSColor.NSColorWithColorSpace(NSColorSpace.deviceRGBColorSpace())\n\tflowIndicatorColorWell.setColor(flowIndicatorColor);\n\tvar flowIndicatorOptionsView = NSView.alloc().initWithFrame(NSMakeRect(0, 0, 300, 23));\n\tflowIndicatorOptionsView.addSubview(flowIndicatorColorWell);\n\n\t// 添加箭头线粗细  \n\tvar flowIndicatorThicknessWell = NSTextField.alloc().initWithFrame(NSMakeRect(105, 0, 44, 23));\n\t// 读取系统默认的粗细\n\tvar flowIndicatorThicknessNum = NSUserDefaults.standardUserDefaults().objectForKey(lineThicknessKey) || \"6\";\n\t// // 默认值填入输入框\n\tflowIndicatorThicknessWell.setStringValue(flowIndicatorThicknessNum);\n\t// 将文本输入框放在 NSView 中\n\tflowIndicatorOptionsView.addSubview(flowIndicatorThicknessWell);\n\tsettingsWindow.addAccessoryView(flowIndicatorOptionsView);\n\n\tsettingsWindow.addTextLabelWithValue(i18t.m5);\n\tvar flowIndicatorColorWell2 = NSColorWell.alloc().initWithFrame(NSMakeRect(0, 0, 44, 23));\n\tflowIndicatorColorHex = NSUserDefaults.standardUserDefaults().objectForKey(flagColorKey) || \"#1AAD19\";\n\tvar flowIndicatorColorAlpha = 1;\n\tvar flowIndicatorMSColor = MSImmutableColor.colorWithSVGString(flowIndicatorColorHex);\n\tflowIndicatorMSColor.setAlpha(flowIndicatorColorAlpha);\n\tvar flowIndicatorColor = flowIndicatorMSColor.NSColorWithColorSpace(NSColorSpace.deviceRGBColorSpace())\n\tflowIndicatorColorWell2.setColor(flowIndicatorColor);\n\tvar flowIndicatorOptionsView2 = NSView.alloc().initWithFrame(NSMakeRect(0, 0, 300, 23));\n\tflowIndicatorOptionsView2.addSubview(flowIndicatorColorWell2);\n\tsettingsWindow.addAccessoryView(flowIndicatorOptionsView2);\n\n\n\tvar response = settingsWindow.runModal();\n\tif (response == \"1000\") {\n\t\tvar flowIndicatorMSColor = MSColor.colorWithNSColor(flowIndicatorColorWell.color()).immutableModelObject();\n\t\tvar flowIndicatorColor = flowIndicatorMSColor.svgRepresentation()\n\t\tvar flowIndicatorMSColor2 = MSColor.colorWithNSColor(flowIndicatorColorWell2.color()).immutableModelObject();\n\t\tvar flowIndicatorColor2 = flowIndicatorMSColor2.svgRepresentation()\n\t\tNSUserDefaults.standardUserDefaults().setObject_forKey(flowIndicatorColor, lineColorKey);\n\t\tNSUserDefaults.standardUserDefaults().setObject_forKey(flowIndicatorColor2, flagColorKey);\n\n\t\t// 获取 “箭头线粗细” 输入框的值，存入 系统key 中\n\t\tvar flowIndicatorThickness = flowIndicatorThicknessWell.stringValue();\n\t\tNSUserDefaults.standardUserDefaults().setObject_forKey(flowIndicatorThickness, lineThicknessKey);\n\n\t\tvar CommonAction = {};\n\t\tif (buttons[0].state() == true) {\n\t\t\tCommonAction = {\n\t\t\t\t\"handlers\": {\n\t\t\t\t\t\"actions\": {\n\t\t\t\t\t\t\"SelectionChanged.finish\": \"onSelectionChanged\",\n\t\t\t\t\t\t\"OpenDocument\": \"onOpenDocument\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"script\": \"onAction.js\"\n\t\t\t};\n\t\t} else {\n\t\t\tCommonAction = {\n\t\t\t\t\"handlers\": {\n\t\t\t\t\t\"actions\": {\n\t\t\t\t\t\t\"OpenDocument\": \"onOpenDocument\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"script\": \"onAction.js\"\n\t\t\t};\n\t\t}\n\n\t\tvar i18nList = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"config.json\").path();\n\n\t\ti18nList = NSData.dataWithContentsOfFile(i18nList);\n\t\ti18nList = NSString.alloc().initWithData_encoding(i18nList,NSUTF8StringEncoding);\n\t\ti18nList = JSON.parse(i18nList).i18n;\n\n\t\tfor (var i = 0; i < i18nList.length; i++) {\n\t\t\tvar allManifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"i18n\").URLByAppendingPathComponent(\"manifest-\" + i18nList[i].key + \".json\").path();\n\t\t\tmanifestLangData = NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(allManifestPath), NSJSONReadingMutableContainers, nil);\n\t\t\tmanifestLangData.commands[0] = CommonAction;\n\t\t\tNSString.alloc().initWithData_encoding(NSJSONSerialization.dataWithJSONObject_options_error(manifestLangData, NSJSONWritingPrettyPrinted, nil), NSUTF8StringEncoding).writeToFile_atomically_encoding_error(allManifestPath, true, NSUTF8StringEncoding, nil);\n\t\t}\n\n\n\t\tmanifest.commands[0] = CommonAction;\n\n\t\tNSString.alloc().initWithData_encoding(NSJSONSerialization.dataWithJSONObject_options_error(manifest, NSJSONWritingPrettyPrinted, nil), NSUTF8StringEncoding).writeToFile_atomically_encoding_error(manifestPath, true, NSUTF8StringEncoding, nil);\n\n\n\t\tcontext.document.showMessage(i18t.m6);\n\n\t\tvar nowContext = uploadContext(context);\n\t\tgetLink(nowContext, true);\n\t\tgetFlag(context, true);\n\t\tAppController.sharedInstance().pluginManager().reloadPlugins();\n\t\tvar ga = new Analytics(context);\n\t\tif (ga) ga.sendEvent('toolbarSetting', 'confirm');\n\t}\n}"],"sourceRoot":""}