{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./src/common.js","webpack://exports/./src/commonPreview.js","webpack://exports/./src/commonPreviewJson.js","webpack://exports/./src/link.js","webpack://exports/./src/webPreview.js"],"names":["kPluginDomain","iconQueryUrl","loginKey","_","context","i18nKey","lang","NSUserDefaults","standardUserDefaults","objectForKey","undefined","macOSVersion","NSDictionary","dictionaryWithContentsOfFile","objectAtIndex","split","slice","join","indexOf","setObject_forKey","encodeURIComponent","toString","length","get_","json","manifestPath","plugin","url","URLByAppendingPathComponent","path","jsonData","NSData","dataWithContentsOfFile","NSString","alloc","initWithData_encoding","NSUTF8StringEncoding","JSON","parse","i18Content","dialog","iconImage","NSImage","initByReferencingFile","urlForResourceNamed","alert","COSAlertWindow","new","setIcon","errorDialog","content","addButtonWithTitle","checkForUpdate","m9","setMessageText","m10","setInformativeText","runModal","initDefaults","pluginDomain","initialValues","defaults","defaultValues","dVal","key","nil","uploadContext","contextNow","document","NSDocumentController","sharedDocumentController","currentDocument","selection","selectedLayers","layers","paste","text","pasteBoard","NSPasteboard","generalPasteboard","declareTypes_owner","NSArray","arrayWithObject","NSPasteboardTypeString","setString_forType","rgb","a","sColor","toLowerCase","sColorNew","i","concat","sColorChange","push","parseInt","saveDefaults","newValues","request","args","aara","task","NSTask","init","setLaunchPath","setArguments","outputPipe","NSPipe","pipe","setStandardOutput","launch","responseData","fileHandleForReading","readDataToEndOfFile","networkRequest","zip","encodeData","result","o","get","sig","returnData","status","msg","post","getConfig","NSJSONSerialization","JSONObjectWithData_options_error","NSJSONReadingMutableContainers","openUrlInBrowser","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","createRadioButtons","options","selectedItem","ui","NSRadioButton","type","NSRadioModeMatrix","rows","Math","ceil","columns","selectedRow","floor","selectedColumn","buttonCell","NSButtonCell","setButtonType","buttonMatrix","NSMatrix","initWithFrame_mode_prototype_numberOfRows_numberOfColumns","NSMakeRect","setCellSize","NSMakeSize","cells","setTitle","setTag","setTransparent","setEnabled","selectCellAtRow_column","createRadioButtons2","createArtboard","obj","doc","artboard","MSArtboardGroup","setName","name","frame","setX","x","setY","y","setWidth","width","setHeight","height","currentPage","addLayer","hexToRgb","hex","exec","r","g","b","unique","res","len","item","j","jLen","MochaJSDelegate","selectorHandlerDict","uniqueClassName","NSUUID","UUID","UUIDString","delegateClassDesc","MOClassDescription","allocateDescriptionForClassWithName_superclass_","NSObject","registerClass","handlers","setHandlerForSelector","selectorString","func","handlerHasBeenSet","selector","NSSelectorFromString","dynamicHandler","functionToCall","apply","arguments","regex","match","dynamicFunction","eval","addInstanceMethodWithSelector_function_","removeHandlerForSelector","getHandlerForSelector","getAllHandlers","getClass","NSClassFromString","getClassInstance","SMPanel","coscript","setShouldKeepAround","self","encodeURI","titleBgColor","NSColor","colorWithRed_green_blue_alpha","contentBgColor","identifier","threadDictionary","NSThread","mainThread","Panel","NSPanel","setTitleVisibility","NSWindowTitleHidden","setTitlebarAppearsTransparent","standardWindowButton","NSWindowCloseButton","setHidden","hiddenClose","NSWindowMiniaturizeButton","NSWindowZoomButton","setFrame_display","setBackgroundColor","contentView","webView","WebView","initWithFrame","showX","showY","windowObject","windowScriptObject","delegate","webFrame","SMAction","DOMReady","stringify","data","evaluateWebScript","mainFrameURL","fragment","decodeURI","valueForKey","callback","floatWindow","orderOut","NSApp","stopModal","close","removeObjectForKey","closeflag","panel","NSOpenPanel","openPanel","setCanChooseDirectories","setCanCreateDirectories","setAllowedFileTypes","setAllowsOtherFileTypes","setExtensionHidden","clicked","NSFileHandlingPanelOKButton","firstURL","URLs","unformattedURL","stringWithFormat","file_path","stringByRemovingPercentEncoding","loginCallback","pushdataCallback","setWantsLayer","layer","setFrame","setCornerRadius","setMasksToBounds","setFrameLoadDelegate_","setMainFrameURL_","addSubview","closeButton","setCOSJSTargetFunction","sender","closeCallback","wantsStop","setAction","titlebarView","superview","titlebarViewController","view","titlebarContainerView","setFrameOrigin","NSMakePoint","setFrameSize","becomeKeyWindow","setLevel","NSFloatingWindowLevel","center","makeKeyAndOrderFront","runModalForWindow","previewKey","previewWrapKey","getConnectionsInPage","page","connectionsLayerPredicate","NSPredicate","predicateWithFormat","children","filteredArrayUsingPredicate","firstObject","getConnectionsLinkInPage","buildPreview","newPreviewObject","index","fixed","back","noBuild","buildLayers","linkLayersPredicate","fixedObject","direction","command","valueForKey_onLayer_forPluginIdentifier","absoluteRect","svg","stringWithString","dataUsingEncoding","svgImporter","MSSVGImporter","prepareToImportFromData","importedSVGLayer","importAsLayer","svgFrame","fixedKey","objectID","rect","size","main","decodeURIComponent","vs","backObject","backKey","noBuildObject","dialogObject","rx","dialogKey","indexObject","commonPreviewIndexKey","connectionsGroup","removeFromParent","MSLayerGroup","addLayers","moveToLayer_beforeLayer","resizeToFitChildrenWithOption","setIsLocked","setValue_forKey_onLayer_forPluginIdentifier","select_byExpandingSelection","setIndex","i18","commonPreview","m1","className","setDialog","fx","chooseDialog","settingsWindow","m2","m3","m4","ButtonList","m5","m6","m7","m8","addAccessoryView","selectedCell","tag","setFixed","chooseDialog2","m11","m12","n","m14","m15","setFixed_","m13","lengthD","saveDom","setBacks","setBack_","setNoBuild","setNoBuild_","clearPreview","domKey","m16","k","showMessage","m17","hidePreview","connectionsGroup2","isVisible","setIsVisible","commonPreviewJson","filePath","show","BorderPositions","FillTypes","GradientTypes","ShadowTypes","TextAligns","ResizingType","pointToJSON","point","parseFloat","colorStopToJSON","colorStop","color","colorToJSON","position","gradientToJSON","gradient","stopsData","stop","stopIter","stops","objectEnumerator","nextObject","gradientType","from","to","colorStops","round","red","green","blue","alpha","bzone","d","toFixed","getFills","style","fillsData","fill","fillIter","fills","isEnabled","fillType","fillData","exportColor","layerStyle","returnText","backgroundColor","bzone6","z","param","atan","abs","PI","exportSVGJson","pageCount","fixedCount","dialogCount","getConnectionsGroupInPage","getParentGroupIsFixed","parent","parentGroup","relationship","linkLayers","loop","connections","linkLayer","destinationArtboardID","destinationArtboard","isCondition","linkRect","parentArtboard","baba","Message","exportHTML","fxstyle","fxlocal","m19","m20","m21","m22","loadingTips","desktop","htmlPath","previewData","replace","writeFile","fileName","getSliceHeader","file","scale","msSlice","MSSliceLayer","MSExportRequest","exportRequestsFromExportableLayer","format","savePath","saveArtboardOrSlice_toFile","exportPNG","firstPage","saveChild","saveChild2","child","backObj","image","fixedDirection","yy","fixedpng","group","count","flagcount","layersLength","p","duplicate","dialogObj","dialogDirection","background","hasBackgroundColor","savePathName","NSFileManager","defaultManager","createDirectoryAtPath_withIntermediateDirectories_attributes_error","writeToFile_atomically_encoding_error","writeDirectory","flag","m18","linkJson","nowPage","artBoards","artboards","newContext","getLink","refursh","link","lineColorKeyLink","lineThicknessLinkKey","selectionDom","selectionDom1","selectionDom2","LineToArtJL","lineCollections","sanitizeArtboard","segmentsIntr0","c","area_abc","area_abd","area_cda","area_cdb","segmentsIntr","cc","dd","t","dx","dy","findAway","line","endPoisiton","art","pca","pcb","lastEndPosition","returnLine","ax","bx","ay","by","isReturnFlag","drawTwoLine","axPoint","ayPoint","tmpLinePoint","startPointX","startPointY","endPointX","endPointY","segments","splice","findAway2","endPoisitonArrow","zaLength","qda","nx","ny","linePath","iFlag","getLinePath","startPosition","nextFx","pzysx","pzysy","isPZ","thisEndPosition","PZLine","startArtPosition","endObject","drawPPP","domA","domB","tempPointX","tempPointY","plus","drawLine","log","getLineDirection","pointeOne","pointTwo","getLinePosition","isCoincidenis","min","linepoint","isLess","colorLineLink","lineThicknessLink","colorLineLinkR","colorLineLinkG","colorLineLinkB","linePaths","NSBezierPath","bezierPath","lineCount","offset","coincideOffset","comparedLineCollectionCount","moveToPoint","lineToPoint","curveToPoint_controlPoint1_controlPoint2","MSPath","pathWithBezierPath","lineSh","MSShapeGroup","shapeWithBezierPath","hitAreaBorder","addStylePartOfType","setColor","MSImmutableColor","colorWithIntegerRed_green_blue_alpha","newMutableCounterpart","setThickness","setPosition","drawRound","NSInsetRect","bezierPathWithOvalInRect","hitAreaLayer","drawArrow","arrowDirection","arrowOffset","arrowPath","arrow","arrowStyle","startRound","endArrow","drawConnections","connection","draw","connectionLayersDom","MSLayerArray","arrayWithLayers","groupFromLayers","redrawConnections","selectionLayer","connectionLayers","destArtboard","lastObject","manifest","commands","Selection","linkLayersPredicate2","artboardID","ga","Analytics","sendEvent","onRun","webPreview","webPreviewUrl","chooseFilePath","save","NSSavePanel","savePanel","URL","random","pluginSketch","dir","fm","removeItemAtPath_error"],"mappings":"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","file":"webPreview.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/webPreview.js\");\n","var kPluginDomain;\nvar iconQueryUrl = 'http://123.207.94.56:3000';\nvar loginKey = \"com.sketchplugins.wechat.iconLogin\";\n\nexport function _(context) {\n    var i18nKey = \"com.sketchplugins.wechat.i18n\";\n    var lang = NSUserDefaults.standardUserDefaults().objectForKey(i18nKey);\n    if (lang == undefined) {\n        var macOSVersion = NSDictionary.dictionaryWithContentsOfFile(\"/System/Library/CoreServices/SystemVersion.plist\").objectForKey(\"ProductVersion\") + \"\";\n        lang = NSUserDefaults.standardUserDefaults().objectForKey(\"AppleLanguages\").objectAtIndex(0);\n        lang = (macOSVersion >= \"10.12\") ? lang.split(\"-\").slice(0, -1).join(\"-\") : lang;\n        if (lang.indexOf('zh') > -1) {\n            lang = 'zhCN';\n        } else {\n            lang = 'enUS';\n        }\n        NSUserDefaults.standardUserDefaults().setObject_forKey(lang, i18nKey);\n    }\n    if (encodeURIComponent(lang.toString()).length != 4) {\n        lang = 'enUS';\n        NSUserDefaults.standardUserDefaults().setObject_forKey(lang, i18nKey);\n    }\n\n    function get_(json, context) {\n        var manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"i18n\").URLByAppendingPathComponent(json + \".json\").path();\n        var jsonData = NSData.dataWithContentsOfFile(manifestPath);\n        jsonData = NSString.alloc().initWithData_encoding(jsonData,NSUTF8StringEncoding);\n        return JSON.parse(jsonData);\n    }\n    var i18Content = {};\n    i18Content = get_(lang, context);\n\n    return i18Content;\n};\n\nexport function dialog(context) {\n    var iconImage = NSImage.alloc().initByReferencingFile(context.plugin.urlForResourceNamed(\"icon.png\").path());\n    var alert = COSAlertWindow.new();\n    if (iconImage) {\n        alert.setIcon(iconImage);\n    }\n    return alert;\n}\n\nexport function errorDialog(context,content) {\n    var iconImage = NSImage.alloc().initByReferencingFile(context.plugin.urlForResourceNamed(\"icon.png\").path());\n    var alert = COSAlertWindow.new();\n    if (iconImage) {\n        alert.setIcon(iconImage);\n    }\n    alert.addButtonWithTitle(_(context).checkForUpdate.m9);\n\n    alert.setMessageText(_(context).checkForUpdate.m10);\n    alert.setInformativeText(content);\n    return alert.runModal();\n}\n\nexport function initDefaults(pluginDomain, initialValues) {\n    kPluginDomain = pluginDomain;\n\n    var defaults = NSUserDefaults.standardUserDefaults().objectForKey(kPluginDomain);\n    var defaultValues = {};\n    var dVal;\n\n    for (var key in defaults) {\n        defaultValues[key] = defaults[key]\n    }\n\n    for (var key in initialValues) {\n        dVal = defaultValues[key]\n        if (dVal == nil) defaultValues[key] = initialValues[key]\n    }\n    return defaultValues;\n}\n\nexport function uploadContext(context) {\n    var contextNow = context;\n    contextNow.document = NSDocumentController.sharedDocumentController().currentDocument();\n    contextNow.selection = context.document.selectedLayers().layers();\n    return contextNow;\n}\n\nexport function paste(text) {\n    var pasteBoard = NSPasteboard.generalPasteboard();\n    pasteBoard.declareTypes_owner(NSArray.arrayWithObject(NSPasteboardTypeString),nil);\n    pasteBoard.setString_forType(text,NSPasteboardTypeString);\n}\n\nexport function rgb(a) {\n    var sColor = a.toLowerCase();\n    if (sColor.length === 4) {\n        var sColorNew = \"#\";\n        for (var i = 1; i < 4; i += 1) {\n            sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));\n        }\n        sColor = sColorNew;\n    }\n    //处理六位的颜色值\n    var sColorChange = [];\n    for (var i = 1; i < 7; i += 2) {\n        sColorChange.push(parseInt(\"0x\" + sColor.slice(i, i + 2)));\n    }\n    return sColorChange;\n}\n\nexport function saveDefaults(newValues) {\n    \n}\n\nexport function request(args) {\n    var aara = [args];\n    var task = NSTask.alloc().init();\n    task.setLaunchPath(\"/usr/bin/curl\");\n    task.setArguments(aara);\n    var outputPipe = NSPipe.pipe();\n    task.setStandardOutput(outputPipe);\n    task.launch();\n    var responseData = outputPipe.fileHandleForReading().readDataToEndOfFile();\n    return responseData;\n}\n\nexport function networkRequest(args) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath(\"/usr/bin/curl\");\n    task.setArguments(args);\n    var outputPipe = NSPipe.pipe();\n    task.setStandardOutput(outputPipe);\n    task.launch();\n    var responseData = outputPipe.fileHandleForReading().readDataToEndOfFile();\n    return responseData;\n}\n\n// zip(['-q','-r','-m','-o','-j','/Users/liuxinyu/Desktop/123.zip','/Users/liuxinyu/Desktop/123'])\nexport function zip(args) {\n    var task = NSTask.alloc().init();\n    task.setLaunchPath(\"/usr/bin/zip\");\n    task.setArguments(args);\n    var outputPipe = NSPipe.pipe();\n    task.setStandardOutput(outputPipe);\n    task.launch();\n}\n\nexport function encodeData(jsonData) {\n    var result = {};\n    for (var o in jsonData) {\n        result[o] = typeof jsonData != 'object' ? encodeURIComponent(jsonData[o]) : encodeData(jsonData[o]);\n    }\n    return result;\n}\n\nexport function get(args) {\n    var sig = NSUserDefaults.standardUserDefaults().objectForKey(loginKey);\n    var returnData = networkRequest([iconQueryUrl + args[0] + '?sig=' + sig + '&' + args[1]]);\n    var jsonData = NSString.alloc().initWithData_encoding(returnData,NSUTF8StringEncoding);\n    jsonData = JSON.parse(jsonData);\n    if (jsonData.status == 200) {\n        return jsonData;\n    } else {\n        errorDialog(context,jsonData.msg);\n        return jsonData;\n    }\n}\n\nexport function post(args) {\n    var sig = NSUserDefaults.standardUserDefaults().objectForKey(loginKey);\n    var returnData = networkRequest(['-d', 'sig=' + sig + '&' + args[1], iconQueryUrl + args[0]]);\n    var jsonData = NSString.alloc().initWithData_encoding(returnData,NSUTF8StringEncoding);\n    jsonData = JSON.parse(jsonData);\n    if (jsonData.status == 200) {\n        return jsonData;\n    } else {\n        errorDialog(context,jsonData.msg);\n        return jsonData;\n    }\n}\n\nexport function getConfig(json, context) {\n    var manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(json + \".json\").path();\n    return NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n}\n\nexport function openUrlInBrowser(url) {\n    NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(url));\n}\n\nexport function createRadioButtons(options, selectedItem) {\n    var ui = NSRadioButton;\n    var type = NSRadioModeMatrix;\n\n    var rows = Math.ceil(options.length / 2);\n    var columns = ((options.length < 2) ? 1 : 2);\n\n    var selectedRow = Math.floor(selectedItem / 2);\n    var selectedColumn = selectedItem - (selectedRow * 2);\n\n    var buttonCell = NSButtonCell.alloc().init();\n    buttonCell.setButtonType(ui);\n\n\n    var buttonMatrix = NSMatrix.alloc().initWithFrame_mode_prototype_numberOfRows_numberOfColumns(NSMakeRect(20.0, 20.0, 300.0, rows * 25),type,buttonCell,rows,columns);\n    buttonMatrix.setCellSize(NSMakeSize(140, 20));\n\n    for (i = 0; i < options.length; i++) {\n        buttonMatrix.cells().objectAtIndex(i).setTitle(options[i]);\n        buttonMatrix.cells().objectAtIndex(i).setTag(i);\n    }\n\n    if (rows * columns > options.length) {\n        buttonMatrix.cells().objectAtIndex(options.length).setTransparent(true);\n        buttonMatrix.cells().objectAtIndex(options.length).setEnabled(false);\n    }\n    buttonMatrix.selectCellAtRow_column(selectedRow,selectedColumn);\n    return buttonMatrix;\n}\n\nexport function createRadioButtons2(options, selectedItem) {\n    var ui = NSRadioButton;\n    var type = NSRadioModeMatrix;\n\n    var rows = Math.ceil(options.length / 3);\n    var columns = 3;\n\n    var selectedRow = Math.floor(selectedItem / 3);\n    var selectedColumn = selectedItem - (selectedRow * 3);\n\n    var buttonCell = NSButtonCell.alloc().init();\n    buttonCell.setButtonType(ui);\n\n    var buttonMatrix = NSMatrix.alloc().initWithFrame_mode_prototype_numberOfRows_numberOfColumns(NSMakeRect(20.0, 20.0, 300.0, rows * 25),type,buttonCell,rows,columns);\n    buttonMatrix.setCellSize(NSMakeSize(90, 20));\n\n    for (i = 0; i < options.length; i++) {\n        buttonMatrix.cells().objectAtIndex(i).setTitle(options[i]);\n        buttonMatrix.cells().objectAtIndex(i).setTag(i);\n    }\n\n    if (rows * columns > options.length) {\n        buttonMatrix.cells().objectAtIndex(options.length).setTransparent(true);\n        buttonMatrix.cells().objectAtIndex(options.length).setEnabled(false);\n    }\n    buttonMatrix.selectCellAtRow_column(selectedRow,selectedColumn);\n    return buttonMatrix;\n}\n\nexport function createArtboard(context, obj) {\n    var doc = context.document;\n\n    var artboard = new MSArtboardGroup();\n\n    artboard.setName(obj.name);\n\n    var frame = artboard.frame();\n\n    frame.setX(obj.x);\n    frame.setY(obj.y);\n    frame.setWidth(obj.width);\n    frame.setHeight(obj.height);\n    doc.currentPage().addLayer(artboard);\n\n    return artboard;\n}\n\nexport function hexToRgb(hex) {\n    var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (result) {\n        result = {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16),\n        };\n    } else {\n        result = null;\n    }\n    return result;\n}\n\nexport function unique(a) {\n    var res = [];\n\n    for (var i = 0, len = a.length; i < len; i++) {\n        var item = a[i];\n\n        for (var j = 0, jLen = res.length; j < jLen; j++) {\n            if (res[j] === item)\n                break;\n        }\n\n        if (j === jLen)\n            res.push(item);\n    }\n\n    return res;\n}\n\n\nfunction MochaJSDelegate(selectorHandlerDict) {\n    var uniqueClassName = \"MochaJSDelegate_DynamicClass_\" + NSUUID.UUID().UUIDString();\n\n    var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(uniqueClassName, NSObject);\n\n    delegateClassDesc.registerClass();\n\n    //  Handler storage\n\n    var handlers = {};\n\n    //  Define interface\n\n    this.setHandlerForSelector = function (selectorString, func) {\n        var handlerHasBeenSet = (selectorString in handlers);\n        var selector = NSSelectorFromString(selectorString);\n\n        handlers[selectorString] = func;\n\n        if (!handlerHasBeenSet) {\n            /*\n                For some reason, Mocha acts weird about arguments:\n                https://github.com/logancollins/Mocha/issues/28\n\n                We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n            */\n\n            var dynamicHandler = function () {\n                var functionToCall = handlers[selectorString];\n\n                if (!functionToCall) return;\n\n                return functionToCall.apply(delegateClassDesc, arguments);\n            };\n\n            var args = [],\n                regex = /:/g;\n            while (match = regex.exec(selectorString)) args.push(\"arg\" + args.length);\n\n            dynamicFunction = eval(\"(function(\" + args.join(\",\") + \"){ return dynamicHandler.apply(this, arguments); })\");\n\n            delegateClassDesc.addInstanceMethodWithSelector_function_(selector, dynamicFunction);\n        }\n    };\n\n    this.removeHandlerForSelector = function (selectorString) {\n        delete handlers[selectorString];\n    };\n\n    this.getHandlerForSelector = function (selectorString) {\n        return handlers[selectorString];\n    };\n\n    this.getAllHandlers = function () {\n        return handlers;\n    };\n\n    this.getClass = function () {\n        return NSClassFromString(uniqueClassName);\n    };\n\n    this.getClassInstance = function () {\n        return NSClassFromString(uniqueClassName).new();\n    };\n\n    //  Conveience\n\n    if (typeof selectorHandlerDict == \"object\") {\n        for (var selectorString in selectorHandlerDict) {\n            this.setHandlerForSelector(selectorString, selectorHandlerDict[selectorString]);\n        }\n    }\n};\n\n\n//  sketch-measure\n//  common.js\n//  github https://github.com/utom/sketch-measure\n//  Created by utom\n\nexport function SMPanel(options) {\n    coscript.setShouldKeepAround(true);\n    var self = this,\n        result = false;\n    options.url = encodeURI(\"file://\" + options.url);\n    var frame = NSMakeRect(0, 0, options.width, (options.height + 32)),\n        titleBgColor = NSColor.colorWithRed_green_blue_alpha(0.945, 0.945, 0.945, 1),\n        contentBgColor = NSColor.colorWithRed_green_blue_alpha(0.945, 0.945, 0.945, 1);\n\n    if (options.identifier) {\n        var threadDictionary = NSThread.mainThread().threadDictionary();\n        if (threadDictionary[options.identifier]) {\n            return false;\n        }\n    }\n\n    var Panel = NSPanel.alloc().init();\n    Panel.setTitleVisibility(NSWindowTitleHidden);\n    Panel.setTitlebarAppearsTransparent(true);\n    Panel.standardWindowButton(NSWindowCloseButton).setHidden(options.hiddenClose);\n    Panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true);\n    Panel.standardWindowButton(NSWindowZoomButton).setHidden(true);\n    Panel.setFrame_display(frame, false);\n    Panel.setBackgroundColor(contentBgColor);\n\n    var contentView = Panel.contentView();\n    var webView = WebView.alloc().initWithFrame(NSMakeRect(options.showX ? options.showX : 0, options.showY ? options.showY : 0, options.width, options.height));\n    var windowObject = webView.windowScriptObject(),\n        delegate = new MochaJSDelegate({\n            \"webView:didFinishLoadForFrame:\": (function (webView, webFrame) {\n                var SMAction = [\n                        \"function SMAction(hash, data){\",\n                        \"if(data){\",\n                        \"window.SMData = encodeURI(JSON.stringify(data));\",\n                        \"}\",\n                        \"window.location.hash = hash;\",\n                        \"}\"\n                    ].join(\"\"),\n                    DOMReady = [\n                        \"$(\",\n                        \"function(){\",\n                        \"init(\" + JSON.stringify(options.data) + \")\",\n                        \"}\",\n                        \");\"\n                    ].join(\"\");\n\n                windowObject.evaluateWebScript(SMAction);\n                windowObject.evaluateWebScript(DOMReady);\n            }),\n            \"webView:didChangeLocationWithinPageForFrame:\": (function (webView, webFrame) {\n                var request = NSURL.URLWithString(webView.mainFrameURL()).fragment();\n\n                if (request == \"submit\") {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    options.callback(data);\n                    result = true;\n                } else if (request == \"close\") {\n                    if (!options.floatWindow) {\n                        Panel.orderOut(nil);\n                        NSApp.stopModal();\n                    } else {\n                        Panel.close();\n                    }\n                    threadDictionary.removeObjectForKey(options.identifier);\n                } else if (request == 'submitandclose') {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    var closeflag = options.callback(data);\n                    result = true;\n                    if (closeflag) {\n                        if (!options.floatWindow) {\n                            Panel.orderOut(nil);\n                            NSApp.stopModal();\n                        } else {\n                            Panel.close();\n                        }\n                        threadDictionary.removeObjectForKey(options.identifier);\n                    }\n                } else if (request == 'file') {\n                    var panel = NSOpenPanel.openPanel();\n                    panel.setCanChooseDirectories(false);\n                    panel.setCanCreateDirectories(false);\n                    panel.setAllowedFileTypes([\"sketch\", \"json\"]);\n                    panel.setAllowsOtherFileTypes(false);\n                    panel.setExtensionHidden(false);\n                    var clicked = panel.runModal();\n                    if (clicked != NSFileHandlingPanelOKButton) {\n                        windowObject.evaluateWebScript(\"inputFile('\" + '' + \"')\");\n                        return;\n                    }\n                    var firstURL = panel.URLs().objectAtIndex(0);\n                    var unformattedURL = NSString.stringWithFormat(firstURL);\n                    var file_path = unformattedURL.stringByRemovingPercentEncoding();\n                    windowObject.evaluateWebScript(\"inputFile('\" + file_path + \"')\");\n                    windowObject.evaluateWebScript(\"window.location.hash = '';\");\n                } else if (request == 'login') {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    options.loginCallback(data, windowObject);\n                } else if (request == 'pushdata') {\n                    var data = JSON.parse(decodeURI(windowObject.valueForKey(\"SMData\")));\n                    options.pushdataCallback(data, windowObject);\n                }\n                // windowObject.evaluateWebScript(\"window.location.hash = '';\");\n            })\n        });\n\n    contentView.setWantsLayer(true);\n    contentView.layer().setFrame(contentView.frame());\n    contentView.layer().setCornerRadius(6);\n    contentView.layer().setMasksToBounds(true);\n\n    webView.setBackgroundColor(contentBgColor);\n    webView.setFrameLoadDelegate_(delegate.getClassInstance());\n    webView.setMainFrameURL_(options.url);\n\n    contentView.addSubview(webView);\n\n    var closeButton = Panel.standardWindowButton(NSWindowCloseButton);\n    closeButton.setCOSJSTargetFunction(function (sender) {\n        var request = NSURL.URLWithString(webView.mainFrameURL()).fragment();\n\n        if (options.closeCallback) {\n            options.closeCallback();\n        }\n\n        if (options.identifier) {\n            threadDictionary.removeObjectForKey(options.identifier);\n        }\n\n        self.wantsStop = true;\n        if (options.floatWindow) {\n            Panel.close();\n        } else {\n            Panel.orderOut(nil);\n            NSApp.stopModal();\n        }\n\n    });\n    closeButton.setAction(\"callAction:\");\n\n    var titlebarView = contentView.superview().titlebarViewController().view(),\n        titlebarContainerView = titlebarView.superview();\n    closeButton.setFrameOrigin(NSMakePoint(8, 8));\n    titlebarContainerView.setFrame(NSMakeRect(0, options.height, options.width, 32));\n    titlebarView.setFrameSize(NSMakeSize(options.width, 32));\n    titlebarView.setTransparent(true);\n    titlebarView.setBackgroundColor(titleBgColor);\n    titlebarContainerView.superview().setBackgroundColor(titleBgColor);\n\n    if (options.floatWindow) {\n        Panel.becomeKeyWindow();\n        Panel.setLevel(NSFloatingWindowLevel);\n        if (!options.showX || !options.showY) {\n            Panel.center();\n        }\n        Panel.makeKeyAndOrderFront(nil);\n        if (options.identifier) {\n            threadDictionary[options.identifier] = Panel;\n        }\n        return webView;\n    } else {\n        if (options.identifier) {\n            threadDictionary[options.identifier] = Panel;\n        }\n        NSApp.runModalForWindow(Panel);\n    }\n\n    return windowObject;\n}","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\n\nvar previewKey = \"com.sketchplugins.wechat.preview.w\";\nvar previewWrapKey = \"com.sketchplugins.wechat.previewwrap\";\nvar kPluginDomain = \"com.sketchplugins.wechat.link\";\n\nexport function getConnectionsInPage(page) {\n\tvar connectionsLayerPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).isConnectionsContainer == true\", previewWrapKey);\n\treturn page.children().filteredArrayUsingPredicate(connectionsLayerPredicate).firstObject();\n}\nexport function getConnectionsLinkInPage(page) {\n\tvar connectionsLayerPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).isConnectionsContainer == true\", kPluginDomain);\n\treturn page.children().filteredArrayUsingPredicate(connectionsLayerPredicate).firstObject();\n}\n\nexport function buildPreview(context) {\n\tvar newPreviewObject = {\n\t\tindex: {},\n\t\tdialog: {},\n\t\tfixed: {},\n\t\tback: {},\n\t\tnoBuild: {}\n\t};\n\tvar buildLayers = [];\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).fixedMain != nil\", previewKey);\n\tvar fixedObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\n\tfor (var i = 0; i < fixedObject.length; i++) {\n\t\tvar selection = fixedObject[i];\n\t\tvar direction = context.command.valueForKey_onLayer_forPluginIdentifier(\"direction\", selection, previewKey);\n\t\tvar x = selection.absoluteRect().x();\n\t\tvar y = selection.absoluteRect().y();\n\t\t\n\t\tvar svg = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><svg width=\"418\" height=\"219\" viewBox=\"0 0 418 219\" viewBox=\"0 0 20 20\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><defs><rect id=\"rectangle-2-a\" width=\"417.282\" height=\"218.764\" x=\"160\" y=\"252\"/></defs><g fill=\"none\" fill-rule=\"evenodd\" transform=\"translate(-160 -252)\"><use fill=\"#FFFAAC\" fill-opacity=\".354\" xlink:href=\"#rectangle-2-a\"/><rect width=\"416.282\" height=\"217.764\" x=\"160.5\" y=\"252.5\" stroke=\"#F3E31A\"/></g></svg>';\n\t\tsvg = NSString.stringWithString(svg);\n\t\tsvg = svg.dataUsingEncoding(NSUTF8StringEncoding);\n\t\tvar svgImporter = MSSVGImporter.svgImporter();\n\t\tsvgImporter.prepareToImportFromData(svg);\n\t\tvar importedSVGLayer = svgImporter.importAsLayer();\n\t\tvar svgFrame = importedSVGLayer.frame();\n\t\tvar fixedKey = '#_*fixed__' + direction;\n\t\tfixedKey = fixedKey + '#';\n\n\t\timportedSVGLayer.name = fixedKey + selection.objectID();\n\t\tsvgFrame.setX(x);\n\t\tsvgFrame.setX(y);\n\t\tsvgFrame.setWidth(selection.rect().size.width);\n\t\tsvgFrame.setHeight(selection.rect().size.height);\n\t\tnewPreviewObject.fixed[selection.objectID()] = {\n\t\t\tmain: selection.objectID(),\n\t\t\tdirection: decodeURIComponent(encodeURIComponent(direction)),\n\t\t\tvs: importedSVGLayer.objectID()\n\t\t};\n\t\tbuildLayers.push(importedSVGLayer);\n\t}\n\n\n\tlinkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).backMain != nil\", previewKey);\n\tvar backObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\tfor (var i = 0; i < backObject.length; i++) {\n\t\tvar selection = backObject[i];\n\t\tvar x = selection.absoluteRect().x();\n\t\tvar y = selection.absoluteRect().y();\n\t\tvar svg = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><svg width=\"20px\" height=\"20px\" viewBox=\"0 0 20 20\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><defs><rect id=\"rectangle-4-a\" width=\"132.777\" height=\"85.05\" x=\"1\" y=\"117\" rx=\"100\"/></defs><g fill=\"none\" fill-rule=\"evenodd\" transform=\"translate(-1 -117)\"><use fill=\"#FF7979\" fill-opacity=\".3\" xlink:href=\"#rectangle-4-a\"/><rect width=\"131.777\" height=\"84.05\" x=\"1.5\" y=\"117.5\" stroke=\"#FF7C82\" rx=\"100\"/></g></svg>';\n\t\tsvg = NSString.stringWithString(svg);\n\t\tsvg = svg.dataUsingEncoding(NSUTF8StringEncoding);\n\t\tvar svgImporter = MSSVGImporter.svgImporter();\n\t\tsvgImporter.prepareToImportFromData(svg);\n\t\tvar importedSVGLayer = svgImporter.importAsLayer();\n\t\tvar svgFrame = importedSVGLayer.frame();\n\t\tvar backKey = '#_*back__#';\n\t\timportedSVGLayer.name = backKey + selection.objectID();\n\t\tsvgFrame.setX(x);\n\t\tsvgFrame.setX(y);\n\t\tsvgFrame.setWidth(selection.rect().size.width);\n\t\tsvgFrame.setHeight(selection.rect().size.height);\n\t\tnewPreviewObject.back[selection.objectID()] = {\n\t\t\tmain: selection.objectID(),\n\t\t\tvs: importedSVGLayer.objectID()\n\t\t};\n\t\tbuildLayers.push(importedSVGLayer);\n\t}\n\n\tlinkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).noBuildMain != nil\", previewKey);\n\tvar noBuildObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\tfor (var i = 0; i < noBuildObject.length; i++) {\n\t\tvar selection = noBuildObject[i];\n\t\tvar x = selection.absoluteRect().x();\n\t\tvar y = selection.absoluteRect().y();\n\t\tvar svg = '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"68\" height=\"72\" viewBox=\"0 0 68 72\"><defs><rect id=\"rectangle-2-a\" width=\"68\" height=\"72\" x=\"204\" y=\"243\"/><mask id=\"rectangle-2-b\" width=\"68\" height=\"72\" x=\"0\" y=\"0\" fill=\"#fff\"><use xlink:href=\"#rectangle-2-a\"/></mask></defs><use fill=\"none\" fill-rule=\"evenodd\" stroke=\"#F00\" stroke-dasharray=\"5\" stroke-width=\"2\" mask=\"url(#rectangle-2-b)\" transform=\"translate(-204 -243)\" xlink:href=\"#rectangle-2-a\"/></svg>';\n\t\tsvg = NSString.stringWithString(svg);\n\t\tsvg = svg.dataUsingEncoding(NSUTF8StringEncoding);\n\t\tvar svgImporter = MSSVGImporter.svgImporter();\n\t\tsvgImporter.prepareToImportFromData(svg);\n\t\tvar importedSVGLayer = svgImporter.importAsLayer();\n\t\tvar svgFrame = importedSVGLayer.frame();\n\t\tvar backKey = '#_*noBuild__#';\n\t\timportedSVGLayer.name = backKey + selection.objectID();\n\t\tsvgFrame.setX(x);\n\t\tsvgFrame.setX(y);\n\t\tsvgFrame.setWidth(selection.rect().size.width);\n\t\tsvgFrame.setHeight(selection.rect().size.height);\n\t\tnewPreviewObject.noBuild[selection.objectID()] = {\n\t\t\tmain: selection.objectID(),\n\t\t\tvs: importedSVGLayer.objectID()\n\t\t};\n\t\tbuildLayers.push(importedSVGLayer);\n\t}\n\n\tlinkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).dialogMain != nil\", previewKey);\n\tvar dialogObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\n\tfor (var i = 0; i < dialogObject.length; i++) {\n\t\tvar selection = dialogObject[i];\n\t\tvar direction = context.command.valueForKey_onLayer_forPluginIdentifier(\"direction\", selection, previewKey);\n\t\tvar rx = selection.rect().size.width / 414;\n\t\tif (rx < 1) {\n\t\t\trx = 1;\n\t\t}\n\t\tvar width = 39 * rx;\n\t\tvar height = 39 * rx;\n\t\tvar x = selection.absoluteRect().x() + selection.rect().size.width - width;\n\t\tvar y = selection.absoluteRect().y() - height;\n\t\t// 删除页面中所有\n\t\tvar svg = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><svg width=\"39\" height=\"39\" viewBox=\"0 0 39 39\"><g fill=\"none\"><path fill=\"#9BABBD\" d=\"M0.812234279,39 L31.1877657,39 C31.6365252,39 32,38.6344946 32,38.1877657 L32,31.647611 L30.3755314,31.647611 L30.3755314,37.3755314 L1.62243797,37.3755314 L1.62243797,8.62446856 L6.8713381,8.62446856 C6.86891724,7.54148952 6.86891724,7 6.8713381,7 L0.812234279,7 C0.36347484,7 0,7.36550543 0,7.81223428 L0,38.1877657 C2.25440299e-16,38.6344946 0.36347484,39 0.812234279,39 Z\"/><path fill=\"#387FD2\" d=\"M32.7130911,7.00001409 L34.8523116,4.86079105 C35.0492295,4.663873 35.0492295,4.34460659 34.8523116,4.14771671 C34.6553938,3.95079866 34.3361559,3.95079866 34.1392381,4.14771671 L31.9999894,6.28696791 L29.8607407,4.14768854 C29.6638229,3.95077049 29.3445851,3.95077049 29.1476672,4.14768854 C28.9507776,4.34460659 28.9507776,4.663873 29.1476672,4.86076288 L31.2869159,6.99998591 L29.1476672,9.13923712 C28.9507776,9.33615517 28.9507776,9.65542158 29.1476672,9.85231146 C29.3445851,10.0492295 29.6638229,10.0492295 29.8607407,9.85231146 L31.9999894,7.71306026 L34.1392381,9.85231146 C34.3361278,10.0492295 34.6553938,10.0492295 34.8523116,9.85231146 C35.0492295,9.65539341 35.0492295,9.33615517 34.8523116,9.13923712 L32.7130911,7.00001409 Z\"/><path fill=\"#387FD2\" d=\"M7.81223428,32 L38.1877657,32 C38.6365252,32 39,31.6344946 39,31.1877657 L39,0.812234279 C39,0.36347484 38.6365252,0 38.1877657,0 L7.81223428,0 C7.36347484,0 7,0.365505425 7,0.812234279 L7,31.1877657 C7,31.6344946 7.36347484,32 7.81223428,32 Z M8.62243797,1.62446856 L37.3755314,1.62446856 L37.3755314,30.3735009 L8.62243797,30.3735009 L8.62243797,1.62446856 Z\"/></g></svg>';\n\t\tsvg = NSString.stringWithString(svg);\n\t\tsvg = svg.dataUsingEncoding(NSUTF8StringEncoding);\n\t\tvar svgImporter = MSSVGImporter.svgImporter();\n\t\tsvgImporter.prepareToImportFromData(svg);\n\t\tvar importedSVGLayer = svgImporter.importAsLayer();\n\t\tvar svgFrame = importedSVGLayer.frame();\n\t\tvar dialogKey = '#_*dialog__';\n\t\timportedSVGLayer.name = dialogKey + direction + selection.objectID();\n\t\tsvgFrame.setX(x);\n\t\tsvgFrame.setX(y);\n\t\tsvgFrame.setWidth(selection.rect().size.width);\n\t\tsvgFrame.setHeight(selection.rect().size.height);\n\t\tnewPreviewObject.dialog[selection.objectID()] = {\n\t\t\tmain: selection.objectID(),\n\t\t\tdirection: decodeURIComponent(encodeURIComponent(direction)),\n\t\t\tvs: importedSVGLayer.objectID()\n\t\t};\n\t\tbuildLayers.push(importedSVGLayer);\n\t}\n\n\n\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).indexMain != nil\", previewKey);\n\tvar indexObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\tvar commonPreviewIndexKey = '#_*index__#';\n\n\tfor (var i = 0; i < indexObject.length; i++) {\n\t\tvar selection = indexObject[i];\n\t\tvar rx = selection.rect().size.width / 414;\n\t\tif (rx < 1) {\n\t\t\trx = 1;\n\t\t}\n\t\tvar width = 97 * rx;\n\t\tvar height = 97 * rx;\n\t\tvar x = selection.absoluteRect().x() - width - 10;\n\t\tvar y = selection.absoluteRect().y() + 100;\n\n\t\t// 删除页面中所有\n\t\tvar svg = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><svg width=\"97\" height=\"97\" viewBox=\"0 0 97 97\"><defs><linearGradient id=\"group-a\" x1=\"50%\" x2=\"50%\" y1=\"100%\" y2=\"36.603%\"><stop offset=\"0%\" stop-color=\"#5998E0\" stop-opacity=\"0\"/><stop offset=\"30.973%\" stop-color=\"#5998E0\" stop-opacity=\".519\"/><stop offset=\"100%\" stop-color=\"#5998E0\"/></linearGradient></defs><g fill=\"none\" fill-rule=\"evenodd\" transform=\"translate(-2 -31)\"><g fill-rule=\"nonzero\" transform=\"rotate(45 23.396 58.338)\"><path fill=\"#5998E0\" d=\"M66.509544,23.521668 C66.0610101,23.521668 65.698452,23.1582988 65.698452,22.710576 L65.698452,0.811092 C65.698452,0.363369216 66.0610101,0 66.509544,0 C66.9580779,0 67.320636,0.363369216 67.320636,0.811092 L67.320636,22.710576 C67.320636,23.1582988 66.9580779,23.521668 66.509544,23.521668 Z\"/><path fill=\"#5998E0\" d=\"M66.509544,1.622184 L44.61006,1.622184 C44.1615261,1.622184 43.798968,1.25881478 43.798968,0.811092 C43.798968,0.363369216 44.1615261,0 44.61006,0 L66.509544,0 C66.9580779,0 67.320636,0.363369216 67.320636,0.811092 C67.320636,1.25881478 66.9580779,1.622184 66.509544,1.622184 Z\"/><path fill=\"url(#group-a)\" d=\"M0.760529288,65.4132226 L65.9361019,0.237649956 C66.2532389,-0.079487016 66.7658491,-0.079487016 67.082986,0.237649956 C67.400123,0.554786928 67.400123,1.06739707 67.082986,1.38453404 L1.90741338,66.5601067 L0.760529288,65.4132226 Z\"/></g><text fill=\"#5998E0\" font-family=\"PingFangSC-Regular, PingFang SC\" font-size=\"12\"><tspan x=\"14\" y=\"41\">Start</tspan></text></g></svg>';\n\t\tsvg = NSString.stringWithString(svg);\n\t\tsvg = svg.dataUsingEncoding(NSUTF8StringEncoding);\n\t\tvar svgImporter = MSSVGImporter.svgImporter();\n\t\tsvgImporter.prepareToImportFromData(svg);\n\t\tvar importedSVGLayer = svgImporter.importAsLayer();\n\t\tvar svgFrame = importedSVGLayer.frame();\n\t\timportedSVGLayer.name = commonPreviewIndexKey + selection.objectID();\n\t\tsvgFrame.setX(x);\n\t\tsvgFrame.setX(y);\n\t\tsvgFrame.setWidth(selection.rect().size.width);\n\t\tsvgFrame.setHeight(selection.rect().size.height);\n\t\tnewPreviewObject.index[selection.objectID()] = {\n\t\t\tmain: selection.objectID(),\n\t\t\tvs: importedSVGLayer.objectID()\n\t\t};\n\t\tbuildLayers.push(importedSVGLayer);\n\t}\n\n\n\n\tvar connectionsGroup = getConnectionsInPage(context.document.currentPage());\n\tif (connectionsGroup) {\n\t\tconnectionsGroup.removeFromParent();\n\t}\n\tvar connectionsGroup = MSLayerGroup.new();\n\tcontext.document.currentPage().addLayers([connectionsGroup]);\n\tcontext.document.currentPage().addLayers(buildLayers);\n\tfor (var i = 0; i < buildLayers.length; i++) {\n\t\tbuildLayers[i].moveToLayer_beforeLayer(connectionsGroup, connectionsGroup);\n\t}\n\tconnectionsGroup.resizeToFitChildrenWithOption(1);\n\tconnectionsGroup.setName(\"Preview\");\n\tconnectionsGroup.setIsLocked(1);\n\tconnectionsGroup.moveToLayer_beforeLayer(context.document.currentPage(), context.document.currentPage());\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(true, \"isConnectionsContainer\", connectionsGroup, previewWrapKey);\n\tfor (var i = 0; i < context.selection.length; i++) {\n\t\tcontext.selection[i].select_byExpandingSelection(false, false);\n\t};\n\n\treturn newPreviewObject;\n}\n\nexport function setIndex(context) {\n\tvar i18 = _(context).commonPreview;\n\tif (context.selection.length == 0) {\n\t\treturn errorDialog(context,i18.m1);\n\t} else {\n\t\tvar selection = context.selection[0];\n\t\tif (selection.className() != 'MSArtboardGroup') {\n\t\t\treturn errorDialog(context,i18.m1);\n\t\t}\n\t\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).indexMain != nil\", previewKey);\n\t\tvar indexObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\t\tfor (var i = 0; i < indexObject.length; i++) {\n\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"indexMain\", indexObject[i], previewKey);\n\t\t}\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(selection.objectID(), \"indexMain\", selection, previewKey);\n\t\tbuildPreview(context);\n\t}\n}\n\nexport function setDialog(context) {\n\tvar i18 = _(context).commonPreview;\n\tvar fx = 0;\n\n\tfunction chooseDialog() {\n\t\tvar settingsWindow = dialog(context);\n\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\t\tsettingsWindow.addButtonWithTitle(i18.m3);\n\n\t\tsettingsWindow.setMessageText(i18.m4);\n\n\t\tvar ButtonList = [i18.m5, i18.m6, i18.m7, i18.m8, i18.m9];\n\n\t\tfx = createRadioButtons(ButtonList, 0);\n\t\tsettingsWindow.addAccessoryView(fx);\n\t\treturn settingsWindow.runModal();\n\t}\n\tif (context.selection.length == 0) {\n\t\treturn errorDialog(context,i18.m1);\n\t} else {\n\t\tvar selection = context.selection[0];\n\t\tif (selection.className() != 'MSArtboardGroup') {\n\t\t\treturn errorDialog(context,i18.m1);\n\t\t}\n\t\tif (chooseDialog() != '1000') {\n\t\t\treturn;\n\t\t}\n\n\n\t\tfx = fx.selectedCell();\n\t\tvar index = fx.tag();\n\t\tvar direction = '';\n\t\tif (index == 0) {\n\t\t\tdirection = 'b';\n\t\t} else if (index == 1) {\n\t\t\tdirection = 't';\n\t\t} else if (index == 2) {\n\t\t\tdirection = 'l';\n\t\t} else if (index == 3) {\n\t\t\tdirection = 'r';\n\t\t}\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(selection.objectID(), \"dialogMain\", selection, previewKey);\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(direction, \"direction\", selection, previewKey);\n\t\tbuildPreview(context);\n\t}\n}\n\nexport function setFixed(context) {\n\tvar i18 = _(context).commonPreview;\n\tvar fx = 0;\n\n\tfunction chooseDialog2() {\n\t\tvar settingsWindow = dialog(context);\n\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\t\tsettingsWindow.addButtonWithTitle(i18.m3);\n\n\t\tsettingsWindow.setMessageText(i18.m10);\n\n\t\tvar ButtonList = [i18.m11, i18.m12];\n\n\t\tfx = createRadioButtons(ButtonList, 0);\n\t\tsettingsWindow.addAccessoryView(fx);\n\t\treturn settingsWindow.runModal();\n\t}\n\n\tfunction chooseDialog(n) {\n\t\tvar settingsWindow = dialog(context);\n\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\t\tsettingsWindow.addButtonWithTitle(i18.m3);\n\t\tsettingsWindow.setMessageText(i18.m14 + n + i18.m15);\n\t\treturn settingsWindow.runModal();\n\t}\n\n\tvar setFixed_ = function (context, selection) {\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(selection.objectID(), \"fixedMain\", selection, previewKey);\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(direction, \"direction\", selection, previewKey);\n\t}\n\tif (context.selection.length == 0) {\n\t\treturn errorDialog(context,i18.m13);\n\t} else {\n\t\tvar selection = context.selection[0];\n\t\tif (selection.className() == 'MSArtboardGroup') {\n\t\t\treturn errorDialog(context,i18.m13);\n\t\t}\n\t\tif (!chooseDialog2()) {\n\t\t\treturn;\n\t\t}\n\n\t\tfx = fx.selectedCell();\n\t\tvar index = fx.tag();\n\t\tvar direction = 't';\n\t\tif (index == 0) {\n\t\t\tdirection = 't';\n\t\t} else if (index == 1) {\n\t\t\tdirection = 'b';\n\t\t}\n\n\t\tvar lengthD = 0;\n\t\tvar saveDom = [];\n\t\tfor (var i = 0; i < context.document.currentPage().children().length; i++) {\n\t\t\tif (encodeURIComponent(context.document.currentPage().children()[i].name()) == encodeURIComponent(selection.name())) {\n\t\t\t\tlengthD++;\n\t\t\t\tsaveDom.push(context.document.currentPage().children()[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (lengthD != 1 && chooseDialog(lengthD) != '1000') {\n\t\t\tsetFixed_(context, selection);\n\t\t} else {\n\t\t\tfor (var i = 0; i < saveDom.length; i++) {\n\t\t\t\tsetFixed_(context, saveDom[i]);\n\t\t\t}\n\t\t}\n\n\t\tbuildPreview(context);\n\t}\n}\n\nexport function setBacks(context) {\n\tvar i18 = _(context).commonPreview;\n\tvar setBack_ = function (context, selection) {\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(selection.objectID(), \"backMain\", selection, previewKey);\n\t}\n\tvar fx = 0;\n\n\tfunction chooseDialog(n) {\n\t\tvar settingsWindow = dialog(context);\n\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\t\tsettingsWindow.addButtonWithTitle(i18.m3);\n\t\tsettingsWindow.setMessageText(i18.m14 + n + i18.m15);\n\t\treturn settingsWindow.runModal();\n\t}\n\tif (context.selection.length == 0) {\n\t\treturn errorDialog(context,i18.m10);\n\t} else {\n\t\tvar selection = context.selection[0];\n\t\tif (selection.className() == 'MSArtboardGroup') {\n\t\t\treturn errorDialog(context,i18.m10);\n\t\t}\n\t\tvar lengthD = 0;\n\t\tvar saveDom = [];\n\t\tfor (var i = 0; i < context.document.currentPage().children().length; i++) {\n\t\t\tif (encodeURIComponent(context.document.currentPage().children()[i].name()) == encodeURIComponent(selection.name())) {\n\t\t\t\tlengthD++;\n\t\t\t\tsaveDom.push(context.document.currentPage().children()[i]);\n\t\t\t}\n\t\t}\n\t\tif (lengthD != 1 && chooseDialog(lengthD) != '1000') {\n\t\t\tsetBack_(context, selection);\n\t\t} else {\n\t\t\tfor (var i = 0; i < saveDom.length; i++) {\n\t\t\t\tsetBack_(context, saveDom[i]);\n\t\t\t}\n\t\t}\n\t}\n\tbuildPreview(context);\n}\n\nexport function setNoBuild(context) {\n\tvar i18 = _(context).commonPreview;\n\tvar setNoBuild_ = function (context, selection) {\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(selection.objectID(), \"noBuildMain\", selection, previewKey);\n\t}\n\tvar fx = 0;\n\n\tfunction chooseDialog(n) {\n\t\tvar settingsWindow = dialog(context);\n\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\t\tsettingsWindow.addButtonWithTitle(i18.m3);\n\t\tsettingsWindow.setMessageText(i18.m14 + n + i18.m15);\n\t\treturn settingsWindow.runModal();\n\t}\n\tif (context.selection.length == 0) {\n\t\treturn errorDialog(context,i18.m10);\n\t} else {\n\t\tvar selection = context.selection[0];\n\t\tif (selection.className() == 'MSArtboardGroup') {\n\t\t\treturn errorDialog(context,i18.m10);\n\t\t}\n\t\tvar lengthD = 0;\n\t\tvar saveDom = [];\n\t\tfor (var i = 0; i < context.document.currentPage().children().length; i++) {\n\t\t\tif (encodeURIComponent(context.document.currentPage().children()[i].name()) == encodeURIComponent(selection.name())) {\n\t\t\t\tlengthD++;\n\t\t\t\tsaveDom.push(context.document.currentPage().children()[i]);\n\t\t\t}\n\t\t}\n\t\tif (lengthD != 1 && chooseDialog(lengthD) != '1000') {\n\t\t\tsetNoBuild_(context, selection);\n\t\t} else {\n\t\t\tfor (var i = 0; i < saveDom.length; i++) {\n\t\t\t\tsetNoBuild_(context, saveDom[i]);\n\t\t\t}\n\t\t}\n\t}\n\tbuildPreview(context);\n}\n\nexport function clearPreview(context) {\n\tvar i18 = _(context).commonPreview;\n\tvar domKey = ['backMain', 'fixedMain', 'dialogMain', 'indexMain', 'noBuildMain'];\n\tif (context.selection.length == 0) {\n\t\treturn errorDialog(context,i18.m16);\n\t}\n\tfor (var i = 0; i < context.selection.length; i++) {\n\t\tfor (var k = 0; k < domKey.length; k++) {\n\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, domKey[k], context.selection[i], previewKey);\n\t\t}\n\t}\n\tbuildPreview(context);\n\tcontext.document.showMessage(i18.m17);\n}\n\nexport function hidePreview(context) {\n\tvar connectionsGroup = getConnectionsInPage(context.document.currentPage());\n\tvar connectionsGroup2 = getConnectionsLinkInPage(context.document.currentPage());\n\tif (connectionsGroup) {\n\t\tif (connectionsGroup.isVisible()) {\n\t\t\tconnectionsGroup.setIsVisible(false);\n\t\t\tif (connectionsGroup2) {\n\t\t\t\tconnectionsGroup2.setIsVisible(false);\n\t\t\t}\n\t\t} else {\n\t\t\tconnectionsGroup.setIsVisible(true);\n\t\t\tif (connectionsGroup2) {\n\t\t\t\tconnectionsGroup2.setIsVisible(true);\n\t\t\t}\n\t\t}\n\t}\n}","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\nimport {getConnectionsInPage,getConnectionsLinkInPage,buildPreview,setIndex,setDialog,setFixed,setBacks,setNoBuild,clearPreview,hidePreview} from \"./commonPreview\";\n\n\nexport function commonPreviewJson(context, filePath, show) {\n\tvar i18 = _(context).commonPreview;\n\n\tvar BorderPositions = [\"center\", \"inside\", \"outside\"],\n\t\tFillTypes = [\"color\", \"gradient\"],\n\t\tGradientTypes = [\"linear\", \"radial\", \"angular\"],\n\t\tShadowTypes = [\"outer\", \"inner\"],\n\t\tTextAligns = [\"left\", \"right\", \"center\", \"justify\", \"left\"],\n\t\tResizingType = [\"stretch\", \"corner\", \"resize\", \"float\"];\n\n\tfunction pointToJSON(point) {\n\t\treturn {\n\t\t\tx: parseFloat(point.x),\n\t\t\ty: parseFloat(point.y)\n\t\t};\n\t}\n\n\tfunction colorStopToJSON(colorStop) {\n\t\treturn {\n\t\t\tcolor: colorToJSON(colorStop.color()),\n\t\t\tposition: colorStop.position()\n\t\t};\n\t}\n\n\tfunction gradientToJSON(gradient) {\n\t\tvar stopsData = [],\n\t\t\tstop, stopIter = gradient.stops().objectEnumerator();\n\t\twhile (stop = stopIter.nextObject()) {\n\t\t\tstopsData.push(colorStopToJSON(stop));\n\t\t}\n\n\t\treturn {\n\t\t\ttype: GradientTypes[gradient.gradientType()],\n\t\t\tfrom: pointToJSON(gradient.from()),\n\t\t\tto: pointToJSON(gradient.to()),\n\t\t\tcolorStops: stopsData\n\t\t};\n\t}\n\n\tfunction colorToJSON(color) {\n\t\tvar obj = {\n\t\t\tr: Math.round(color.red() * 255),\n\t\t\tg: Math.round(color.green() * 255),\n\t\t\tb: Math.round(color.blue() * 255),\n\t\t\ta: color.alpha()\n\t\t}\n\n\t\tfunction bzone(d) {\n\t\t\tif (d.length == 1) {\n\t\t\t\td = '0' + d;\n\t\t\t}\n\t\t\treturn d;\n\t\t}\n\t\tif (obj.a == 1) {\n\t\t\treturn '#' + bzone(obj.r.toString(16)) + bzone(obj.g.toString(16)) + bzone(obj.b.toString(16));\n\t\t} else {\n\t\t\treturn 'rgba(' + obj.r + ',' + obj.g + ',' + obj.b + ',' + obj.a.toFixed(2) + ')';\n\t\t}\n\t}\n\n\tfunction getFills(style) {\n\t\tvar fillsData = [],\n\t\t\tfill, fillIter = style.fills().objectEnumerator();\n\t\twhile (fill = fillIter.nextObject()) {\n\t\t\tif (fill.isEnabled()) {\n\t\t\t\tvar fillType = FillTypes[fill.fillType()],\n\t\t\t\t\tfillData = {\n\t\t\t\t\t\tfillType: fillType\n\t\t\t\t\t};\n\n\t\t\t\tswitch (fillType) {\n\t\t\t\t\tcase \"color\":\n\t\t\t\t\t\tfillData.color = colorToJSON(fill.color());\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"gradient\":\n\t\t\t\t\t\tfillData.gradient = gradientToJSON(fill.gradient());\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfillsData.push(fillData);\n\t\t\t}\n\t\t}\n\n\t\treturn fillsData;\n\t}\n\n\tfunction exportColor(selection) {\n\t\tvar layerStyle = selection.style();\n\t\tvar returnText = [];\n\t\tvar backgroundColor = getFills(layerStyle);\n\n\t\tif (backgroundColor.length > 0) {\n\t\t\tif (backgroundColor[0].fillType == 'color') {\n\t\t\t\treturnText.push(backgroundColor[0].color);\n\t\t\t} else if (backgroundColor[0].fillType == 'gradient') {\n\t\t\t\tfunction bzone6(z) {\n\t\t\t\t\tif (z.length != 6) {\n\t\t\t\t\t\tz = '0' + z;\n\t\t\t\t\t}\n\t\t\t\t\tif (z.length != 6) {\n\t\t\t\t\t\tbzone6(z);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn z;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar param = [];\n\t\t\t\tvar to = backgroundColor[0].gradient.to;\n\t\t\t\tvar from = backgroundColor[0].gradient.from;\n\t\t\t\tparam.push(parseInt(90 - 180 * Math.atan(Math.abs((to.y - from.y)) / Math.abs((to.x - from.x))) / Math.PI) + 'deg');\n\t\t\t\tvar colorStops = backgroundColor[0].gradient.colorStops;\n\t\t\t\tfor (var i = 0; i < colorStops.length; i++) {\n\t\t\t\t\tparam.push(colorStops[i].color + ' ' + parseInt(colorStops[i].position * 100) + '%');\n\t\t\t\t}\n\t\t\t\treturnText.push('linear-gradient(' + param.join(',') + ')');\n\t\t\t}\n\t\t\treturn returnText.join('');\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\n\tvar exportSVGJson = {};\n\tvar pageCount = 1;\n\tvar fixedCount = 1;\n\tvar dialogCount = 1;\n\tvar kPluginDomain = \"com.sketchplugins.wechat.link\";\n\n\tvar getConnectionsGroupInPage = function (page) {\n\t\tvar connectionsLayerPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).isConnectionsContainer == true\", kPluginDomain);\n\t\treturn page.children().filteredArrayUsingPredicate(connectionsLayerPredicate).firstObject();\n\t}\n\n\tfunction getParentGroupIsFixed(selection,newPreviewObject){\n\t\tvar parent = selection.parentGroup();\n\t\tif(parent.className() == 'MSArtboardGroup'){\n\t\t\treturn '';\n\t\t}\n\t\tif(newPreviewObject.fixed[parent.objectID()]){\n\t\t\treturn encodeURIComponent(parent.objectID());\n\t\t}else{\n\t\t\tgetParentGroupIsFixed(parent,newPreviewObject);\n\t\t}\n\t}\n\n\tfunction relationship(doc,newPreviewObject) {\n\t\tvar kPluginDomain = \"com.sketchplugins.wechat.link\";\n\t\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\t\t\tlinkLayers = doc.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\t\t\tloop = linkLayers.objectEnumerator(),\n\t\t\tconnections = [],\n\t\t\tlinkLayer, destinationArtboardID, destinationArtboard, isCondition, linkRect;\n\n\t\twhile (linkLayer = loop.nextObject()) {\n\t\t\tvar children = {};\n\t\t\tvar parentArtboard = linkLayer.parentArtboard();\n\t\t\tchildren.x = parseInt(encodeURIComponent(linkLayer.absoluteRect().x())) - parseInt(encodeURIComponent(parentArtboard.absoluteRect().x()));\n\t\t\tchildren.y = parseInt(encodeURIComponent(linkLayer.absoluteRect().y())) - parseInt(encodeURIComponent(parentArtboard.absoluteRect().y()));\n\t\t\tchildren.width = encodeURIComponent(linkLayer.absoluteRect().size().width);\n\t\t\tchildren.height = encodeURIComponent(linkLayer.absoluteRect().size().height);\n\t\t\tchildren.baba = getParentGroupIsFixed(linkLayer,newPreviewObject);\n\t\t\tdestinationArtboardID = context.command.valueForKey_onLayer_forPluginIdentifier(\"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\t\tvar Message = destinationArtboardID.split('____');\n\t\t\tdestinationArtboard = doc.currentPage().children().filteredArrayUsingPredicate(NSPredicate.predicateWithFormat(\"(objectID == %@) || (userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).artboardID == %@)\", Message[1], kPluginDomain, Message[1])).firstObject();\n\n\t\t\tif (destinationArtboard && Message[0] == linkLayer.objectID()) {\n\t\t\t\tchildren.to = encodeURIComponent(destinationArtboard.objectID());\n\t\t\t}\n\t\t\tif (exportSVGJson[linkLayer.parentArtboard().objectID()].children[linkLayer.objectID()]) {\n\t\t\t\texportSVGJson[linkLayer.parentArtboard().objectID()].children[linkLayer.objectID()].to = children.to;\n\t\t\t} else {\n\t\t\t\texportSVGJson[linkLayer.parentArtboard().objectID()].children[linkLayer.objectID()] = children;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfunction exportHTML(filePath) {\n\t\tvar fx = 0;\n\t\tvar fxstyle = '';\n\t\tvar fxlocal = '0';\n\n\t\tfunction chooseDialog() {\n\t\t\tvar settingsWindow = dialog(context);\n\t\t\tsettingsWindow.addButtonWithTitle(i18.m2);\n\t\t\tsettingsWindow.addButtonWithTitle(i18.m3);\n\n\t\t\tsettingsWindow.setMessageText(i18.m19);\n\n\t\t\tvar ButtonList = [i18.m20, i18.m21, i18.m22];\n\n\t\t\tfx = createRadioButtons(ButtonList, 0);\n\t\t\tsettingsWindow.addAccessoryView(fx);\n\t\t\treturn settingsWindow.runModal();\n\t\t}\n\t\tif (show || chooseDialog() != '1000') {\n\t\t\tfxstyle = 'default';\n\t\t\tif(show){\n\t\t\t\tfxlocal = '20';\n\t\t\t}\n\t\t} else {\n\t\t\tfx = fx.selectedCell();\n\t\t\tvar index = fx.tag();\n\t\t\tif (index == 0) {\n\t\t\t\tfxstyle = 'default';\n\t\t\t\tfxlocal = '20';\n\t\t\t} else if (index == 1) {\n\t\t\t\tfxstyle = 'black';\n\t\t\t\tfxlocal = '20';\n\t\t\t} else if (index == 2) {\n\t\t\t\tfxstyle = 'black-translucent';\n\t\t\t}\n\t\t}\n    \tvar i18nKey = \"com.sketchplugins.wechat.i18n\";\n\t\tvar loadingTips = '正在加载所有素材文件<br>请稍后...';\n\t\tvar desktop = 'i2';\n\t\tvar lang = NSUserDefaults.standardUserDefaults().objectForKey(i18nKey);\n\t\tif (encodeURIComponent(lang).indexOf('enUS') > -1) {\n\t\t\tloadingTips = 'Loading all the images<br>Please wait...';\n\t\t\tdesktop = 'i1';\n\t\t}\n\n\t\tvar htmlPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"preview.html\").path();\n\t\tvar previewData = NSData.dataWithContentsOfFile(htmlPath);\n\t\tpreviewData = NSString.alloc().initWithData_encoding(previewData,NSUTF8StringEncoding);\n\t\tpreviewData = previewData.replace('{{json}}', JSON.stringify(exportSVGJson)).replace('{{barstyle}}', fxstyle).replace(/{{local}}/ig, fxlocal).replace('{{loading}}',loadingTips).replace('{{desktop}}',desktop);\n\t\twriteFile({\n\t\t\tcontent: previewData,\n\t\t\tpath: filePath,\n\t\t\tfileName: 'index.html'\n\t\t})\n\t}\n\n\tfunction getSliceHeader(artboard, context, name, file, scale) {\n\t\tvar msSlice = new MSSliceLayer();\n\t\tvar frame = msSlice.frame();\n\t\tframe.setX(artboard.absoluteRect().x());\n\t\tframe.setY(artboard.absoluteRect().y());\n\t\tframe.setWidth(1);\n\t\tvar height = 20;\n\t\tif (artboard.absoluteRect().size().width == 750) {\n\t\t\theight = 40;\n\t\t}\n\t\tif (artboard.absoluteRect().size().width == 1242) {\n\t\t\theight = 60;\n\t\t}\n\t\tframe.setHeight(height);\n\t\tcontext.document.currentPage().addLayer(msSlice);\n\t\tvar slice = MSExportRequest.exportRequestsFromExportableLayer(msSlice).firstObject();\n\t\tslice.scale = scale;\n\t\tslice.format = 'png';\n\t\tvar savePath = file + '/' + name + '.png';\n\t\tcontext.document.saveArtboardOrSlice_toFile(slice, savePath);\n\t\tmsSlice.removeFromParent();\n\t}\n\n\tfunction exportPNG(layer, context, file, scale, newPreviewObject) {\n\t\texportSVGJson[layer.objectID()] = {};\n\t\texportSVGJson[layer.objectID()].width = encodeURIComponent(layer.absoluteRect().size().width);\n\t\texportSVGJson[layer.objectID()].height = encodeURIComponent(layer.absoluteRect().size().height);\n\n\t\tif (newPreviewObject.index[layer.objectID()] && newPreviewObject.index[layer.objectID()].main == layer.objectID()) {\n\t\t\texportSVGJson[layer.objectID()].firstPage = true;\n\t\t}\n\t\texportSVGJson[layer.objectID()].children = {};\n\t\tvar saveChild = [];\n\t\tvar saveChild2 = [];\n\t\tfor (var i = 0; i < layer.children().length; i++) {\n\t\t\tvar child = layer.children()[i];\n\t\t\tif (((newPreviewObject.back && newPreviewObject.back[child.objectID()]) || (newPreviewObject.fixed && newPreviewObject.fixed[child.objectID()])) && child.isVisible()) {\n\t\t\t\tvar backObj = {};\n\t\t\t\tvar parentArtboard = layer.children()[i].parentArtboard();\n\t\t\t\tbackObj.x = parseInt(encodeURIComponent(layer.children()[i].absoluteRect().x())) - parseInt(encodeURIComponent(parentArtboard.absoluteRect().x()));\n\t\t\t\tbackObj.y = parseInt(encodeURIComponent(layer.children()[i].absoluteRect().y())) - parseInt(encodeURIComponent(parentArtboard.absoluteRect().y()));\n\t\t\t\tbackObj.width = encodeURIComponent(layer.children()[i].absoluteRect().size().width);\n\t\t\t\tbackObj.height = encodeURIComponent(layer.children()[i].absoluteRect().size().height);\n\t\t\t\tbackObj.baba = getParentGroupIsFixed(layer.children()[i],newPreviewObject);\n\t\t\t\texportSVGJson[layer.objectID()].children[child.objectID()] = backObj;\n\t\t\t\tif (newPreviewObject.back && newPreviewObject.back[child.objectID()] && child.isVisible()) {\n\t\t\t\t\texportSVGJson[layer.objectID()].children[child.objectID()].back = true;\n\t\t\t\t}\n\t\t\t\tif (newPreviewObject.fixed && newPreviewObject.fixed[child.objectID()] && child.isVisible()) {\n\t\t\t\t\tvar name = 'fixed' + (fixedCount++);\n\t\t\t\t\texportSVGJson[layer.objectID()].children[child.objectID()].fixed = true;\n\t\t\t\t\texportSVGJson[layer.objectID()].children[child.objectID()].image = name;\n\t\t\t\t\texportSVGJson[layer.objectID()].children[child.objectID()].fixedDirection = newPreviewObject.fixed[child.objectID()].direction;\n\t\t\t\t\tif (newPreviewObject.fixed[child.objectID()].direction == 'b') {\n\t\t\t\t\t\texportSVGJson[layer.objectID()].children[child.objectID()].yy = exportSVGJson[layer.objectID()].height - exportSVGJson[layer.objectID()].children[child.objectID()].height - exportSVGJson[layer.objectID()].children[child.objectID()].y;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar fixedpng = MSExportRequest.exportRequestsFromExportableLayer(child).firstObject();\n\t\t\t\t\tfixedpng.scale = scale;\n\t\t\t\t\tfixedpng.format = 'png';\n\t\t\t\t\tvar savePath = file + '/' + name + '.png';\n\t\t\t\t\tcontext.document.saveArtboardOrSlice_toFile(fixedpng, savePath);\n\t\t\t\t\tchild.setIsVisible(false);\n\t\t\t\t\tsaveChild.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar fileName;\n\t\t//把除了背景之外的元素拿出来导出图片，然后再放回去\n\t\tvar group = MSLayerGroup.new();\n\t\tlayer.addLayers([group]);\n\n\t\tvar count = 0;\n\t\tvar flagcount = 0;\n\t\tvar layersLength = layer.layers().length;\n\t\tfor (var i = 0; i < layersLength; i++) {\n\t\t\tif (layer.layers()[flagcount].objectID() != group.objectID() && layer.layers()[flagcount].isVisible()) {\n\t\t\t\tvar p = layer.layers()[flagcount].duplicate();\n\t\t\t\tsaveChild2.push(layer.layers()[flagcount]);\n\t\t\t\tlayer.layers()[flagcount].setIsVisible(false);\n\t\t\t\tp.moveToLayer_beforeLayer(group, group);\n\t\t\t\tflagcount++;\n\t\t\t} else {\n\t\t\t\tflagcount++;\n\t\t\t}\n\n\t\t\tif (count + flagcount == layersLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tgroup.resizeToFitChildrenWithOption(1);\n\n\n\t\tvar dialogObj = {};\n\t\tvar parentArtboard = group.parentArtboard();\n\t\tdialogObj.x = parseInt(encodeURIComponent(group.absoluteRect().x())) - parseInt(encodeURIComponent(parentArtboard.absoluteRect().x()));\n\t\tdialogObj.y = parseInt(encodeURIComponent(group.absoluteRect().y())) - parseInt(encodeURIComponent(parentArtboard.absoluteRect().y()));\n\t\tdialogObj.width = encodeURIComponent(group.absoluteRect().size().width);\n\t\tdialogObj.height = encodeURIComponent(group.absoluteRect().size().height);\n\t\tvar name;\n\t\tif (newPreviewObject.dialog && newPreviewObject.dialog[layer.objectID()]) {\n\t\t\texportSVGJson[layer.objectID()].type = 'dialog';\n\t\t\tname = 'dialog' + (dialogCount++);\n\t\t\tvar dialogDirection = newPreviewObject.dialog[layer.objectID()].direction;\n\t\t\tdialogObj.direction = dialogDirection;\n\t\t} else {\n\t\t\texportSVGJson[layer.objectID()].type = 'page';\n\t\t\tname = 'page' + (pageCount++);\n\t\t}\n\t\tdialogObj.name = name;\n\t\texportSVGJson[layer.objectID()].content = dialogObj;\n\n\n\t\tvar slice = MSExportRequest.exportRequestsFromExportableLayer(group).firstObject();\n\t\tslice.scale = scale;\n\t\tslice.format = 'png';\n\t\tvar savePath = file + '/' + name + '.png';\n\t\tcontext.document.saveArtboardOrSlice_toFile(slice, savePath);\n\n\t\tfor (var i = 0; i < saveChild.length; i++) {\n\t\t\tsaveChild[i].setIsVisible(true);\n\t\t}\n\t\tfor (var i = 0; i < saveChild2.length; i++) {\n\t\t\tsaveChild2[i].setIsVisible(true);\n\t\t}\n\n\t\tgroup.removeFromParent();\n\t\tif (!exportSVGJson[layer.objectID()].background) {\n\t\t\tvar background = layer.hasBackgroundColor() ? colorToJSON(layer.backgroundColor()) : '';\n\t\t\texportSVGJson[layer.objectID()].background = background;\n\t\t}\n\n\t\t\n\t}\n\n\tfunction writeFile(options) {\n\t\tvar content = NSString.stringWithString(options.content),\n\t\t\tsavePathName = [];\n\t\tNSFileManager\n\t\t\t.defaultManager()\n\t\t\t.createDirectoryAtPath_withIntermediateDirectories_attributes_error(options.path, true, nil, nil);\n\n\t\tsavePathName.push(\n\t\t\toptions.path,\n\t\t\t\"/\",\n\t\t\toptions.fileName\n\t\t);\n\t\tsavePathName = savePathName.join(\"\");\n\t\tcontent.writeToFile_atomically_encoding_error(savePathName, false, 4, null);\n\t}\n\n\tfunction writeDirectory(filePath) {\n\t\tNSFileManager\n\t\t\t.defaultManager()\n\t\t\t.createDirectoryAtPath_withIntermediateDirectories_attributes_error(filePath, true, nil, nil);\n\t}\n\n\tvar newPreviewObject = buildPreview(context);\n\n\tvar flag = false;\n\tif (newPreviewObject.index) {\n\t\tfor (var i in newPreviewObject.index) {\n\t\t\tflag = true;\n\t\t}\n\t}\n\tif (!flag) {\n\t\terrorDialog(context,i18.m18);\n\t\treturn false;\n\t}\n\n\tif (filePath == false) {\n\t\treturn false;\n\t}\n\twriteDirectory(filePath);\n\tvar scale = 1;\n\tvar linkJson = {};\n\thidePreview(context);\n\n\tvar nowPage = context.document.currentPage();\n\tvar artBoards = nowPage.artboards();\n\n\tvar previewKey = \"com.sketchplugins.wechat.preview.w\";\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).noBuildMain != nil\", previewKey);\n\tvar noBuildObject = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate);\n\n\tfor (var i = 0; i < noBuildObject.length; i++) {\n\t\tnoBuildObject[i].setIsVisible(false);\n\t}\n\n\tfor (var i = 0; i < artBoards.length; i++) {\n\t\tvar size = artBoards[i].absoluteRect().size().width;\n\t\tif (size == 320 || size == 414 || size == 375) {\n\t\t\tscale = 2;\n\t\t\texportSVGJson.width = parseInt(encodeURIComponent(size));\n\t\t}else if(size == 750){\n\t\t\texportSVGJson.width = 375;\n\t\t}else if(size == 640){\n\t\t\texportSVGJson.width = 320;\n\t\t}else{\n\t\t\texportSVGJson.width = 414;\n\t\t}\n\t\texportPNG(artBoards[i], context, filePath, scale, newPreviewObject);\n\t}\n\trelationship(context.document,newPreviewObject);\n\texportHTML(filePath);\n\thidePreview(context);\n\tfor (var i = 0; i < noBuildObject.length; i++) {\n\t\tnoBuildObject[i].setIsVisible(true);\n\t}\n\tvar newContext = uploadContext(context);\n\tfor (var i = 0; i < newContext.selection.length; i++) {\n\t\tnewContext.selection[i].select_byExpandingSelection(false, false);\n\t}\n\treturn true;\n}","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\n\n\nexport function getLink(context, refursh) {\n\tvar i18 = _(context).link;\n\n\tvar kPluginDomain = \"com.sketchplugins.wechat.link\";\n\tvar lineColorKeyLink = \"com.sketchplugins.wechat.linecolor\";\n\tvar lineThicknessLinkKey = \"com.sketchplugins.wechat.lineThicknessLink\";\n\tvar selectionDom = \"com.sketchplugins.wechat.selectionDom\";\n\tvar selectionDom1 = \"com.sketchplugins.wechat.selectionDom1\";\n\tvar selectionDom2 = \"com.sketchplugins.wechat.selectionDom2\";\n\tvar LineToArtJL = 200;\n\tvar lineCollections = []; // 所有线的集合 [{ x: 1; y: 2; direction: ‘l’; position: 3 },...]\n\n\n\tvar sanitizeArtboard = function (artboard, context) {\n\t\tif (context.command.valueForKey_onLayer_forPluginIdentifier(\"artboardID\", artboard, kPluginDomain) == nil) {\n\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(artboard.objectID(), \"artboardID\", artboard, kPluginDomain);\n\t\t}\n\t}\n\n\tvar getConnectionsGroupInPage = function (page) {\n\t\tvar connectionsLayerPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).isConnectionsContainer == true\", kPluginDomain);\n\t\treturn page.children().filteredArrayUsingPredicate(connectionsLayerPredicate).firstObject();\n\t}\n\n\tfunction segmentsIntr0(a, b, c, d) {\n\t\t// 三角形abc 面积的2倍\n\t\tvar area_abc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\n\t\t// 三角形abd 面积的2倍\n\t\tvar area_abd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\n\t\t// 面积符号相同则两点在线段同侧,不相交 (对点在线段上的情况,本例当作不相交处理);\n\t\tif (area_abc * area_abd >= 0) {\n\t\t\treturn false;\n\t\t}\n\t\t// 三角形cda 面积的2倍\n\t\tvar area_cda = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\n\t\t// 三角形cdb 面积的2倍\n\t\t// 注意: 这里有一个小优化.不需要再用公式计算面积,而是通过已知的三个面积加减得出.\n\t\tvar area_cdb = area_cda + area_abc - area_abd;\n\t\tif (area_cda * area_cdb >= 0) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction segmentsIntr(a, b, c, d) {\n\t\ta = {\n\t\t\tx: parseInt(a.x),\n\t\t\ty: parseInt(a.y)\n\t\t};\n\t\tb = {\n\t\t\tx: parseInt(b.x),\n\t\t\ty: parseInt(b.y)\n\t\t};\n\t\tvar cc = {\n\t\t\tx: parseInt(c.x),\n\t\t\ty: parseInt(c.y)\n\t\t};\n\t\tvar dd = {\n\t\t\tx: parseInt(d.x),\n\t\t\ty: parseInt(d.y)\n\t\t};\n\n\t\tvar flag = 0;\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\tif (i == 0) {\n\t\t\t\tc = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t} else if (i == 1) {\n\t\t\t\tc = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t} else if (i == 2) {\n\t\t\t\tc = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: cc.y\n\t\t\t\t};\n\t\t\t} else if (i == 3) {\n\t\t\t\tc = {\n\t\t\t\t\tx: dd.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t\td = {\n\t\t\t\t\tx: cc.x,\n\t\t\t\t\ty: dd.y\n\t\t\t\t};\n\t\t\t}\n\t\t\t// 三角形abc 面积的2倍\n\t\t\tvar area_abc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\n\t\t\t// 三角形abd 面积的2倍\n\t\t\tvar area_abd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\n\t\t\t// 面积符号相同则两点在线段同侧,不相交 (对点在线段上的情况,本例当作不相交处理);\n\t\t\tif (area_abc * area_abd >= 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// 三角形cda 面积的2倍\n\t\t\tvar area_cda = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\n\t\t\t// 三角形cdb 面积的2倍\n\t\t\t// 注意: 这里有一个小优化.不需要再用公式计算面积,而是通过已知的三个面积加减得出.\n\t\t\tvar area_cdb = area_cda + area_abc - area_abd;\n\t\t\tif (area_cda * area_cdb >= 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar t = area_cda / (area_abd - area_abc);\n\t\t\tvar dx = t * (b.x - a.x),\n\t\t\t\tdy = t * (b.y - a.y);\n\t\t\treturn {\n\t\t\t\tx: a.x + dx,\n\t\t\t\ty: a.y + dy,\n\t\t\t\tflag: true\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tflag: false\n\t\t};\n\t}\n\n\tvar findAway = function (line, a, b, doc, endPoisiton) {\n\t\tvar art = doc.artboards();\n\t\tvar pca = a;\n\t\tvar pcb = b;\n\t\tvar lastEndPosition = endPoisiton;\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\t\tvar returnLine = [];\n\t\tvar ax = 0,\n\t\t\tbx = 0,\n\t\t\tay = 0,\n\t\t\tby = 0;\n\t\tvar isReturnFlag = false;\n\t\tif (a.className() != \"MSArtboardGroup\" && a.className() != \"MSSymbolMaster\") {\n\t\t\tif (pca.parentArtboard()) {\n\t\t\t\tpca = pca.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (b.className() != \"MSArtboardGroup\" && b.className() != \"MSSymbolMaster\") {\n\t\t\tif (pcb.parentArtboard()) {\n\t\t\t\tpcb = pcb.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (lastEndPosition == 'l') {\n\t\t\tax = a.x() + a.size().width / 2;\n\t\t\tay = a.y() + a.size().height;\n\t\t\tby = ay + LineToArtJL;\n\t\t} else if (lastEndPosition == 'r') {\n\t\t\tax = a.x() + a.size().width / 2;\n\t\t\tay = a.y();\n\t\t\tby = ay - LineToArtJL;\n\t\t} else if (lastEndPosition == 't') {\n\t\t\tax = a.x() + a.size().width;\n\t\t\tbx = ax + LineToArtJL;\n\t\t\tay = a.y() + a.size().height / 2;\n\t\t} else if (lastEndPosition == 'b') {\n\t\t\tax = a.x();\n\t\t\tbx = ax - LineToArtJL;\n\t\t\tay = a.y() + a.size().height / 2;\n\t\t}\n\n\n\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segmentsIntr0({\n\t\t\t\t\tx: line.ax,\n\t\t\t\t\ty: line.ay\n\t\t\t\t}, {\n\t\t\t\t\tx: line.bx,\n\t\t\t\t\ty: line.by\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t})) {\n\t\t\t\tisReturnFlag = true;\n\t\t\t\tif (endPoisiton == 't') {\n\t\t\t\t\tif (ax <= art[i].absoluteRect().x() + art[i].absoluteRect().size().width) {\n\t\t\t\t\t\tif (bx < art[i].absoluteRect().x() + art[i].absoluteRect().size().width) {\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() + art[i].absoluteRect().size().width + LineToArtJL;\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() + art[i].absoluteRect().size().height / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (endPoisiton == 'b') {\n\t\t\t\t\tif (ax >= art[i].absoluteRect().x()) {\n\t\t\t\t\t\tif (bx > art[i].absoluteRect().x()) {\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() - LineToArtJL;\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() + art[i].absoluteRect().size().height / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (endPoisiton == 'l') {\n\t\t\t\t\tif (ay <= art[i].absoluteRect().y() + art[i].absoluteRect().size().height) {\n\t\t\t\t\t\tif (by < art[i].absoluteRect().y() + art[i].absoluteRect().size().height) {\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() + art[i].absoluteRect().size().height + LineToArtJL;\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() + art[i].absoluteRect().size().width / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (endPoisiton == 'r') {\n\t\t\t\t\tif (ay >= art[i].absoluteRect().y()) {\n\t\t\t\t\t\tif (by > art[i].absoluteRect().y()) {\n\t\t\t\t\t\t\tby = art[i].absoluteRect().y() - LineToArtJL;\n\t\t\t\t\t\t\tbx = art[i].absoluteRect().x() + art[i].absoluteRect().size().width / 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturnLine.push({\n\t\t\tx: ax,\n\t\t\ty: ay\n\t\t});\n\t\tif (lastEndPosition == 'l') {\n\t\t\tif (by < b.y() + b.size().height) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.size().width + b.x(),\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'l';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: b.y() + b.size().height\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'b';\n\t\t\t}\n\t\t} else if (lastEndPosition == 'r') {\n\t\t\tif (by > b.y()) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x(),\n\t\t\t\t\ty: by\n\t\t\t\t});\n\n\t\t\t\tendPoisiton = 'r';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: by\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width / 2,\n\t\t\t\t\ty: b.y()\n\t\t\t\t});\n\t\t\t\tendPoisiton = 't';\n\t\t\t}\n\t\t} else if (lastEndPosition == 't') {\n\t\t\tif (bx < b.x() + b.size().width) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y()\n\t\t\t\t});\n\t\t\t\tendPoisiton = 't';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x() + b.size().width,\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'l';\n\t\t\t}\n\t\t} else if (lastEndPosition == 'b') {\n\t\t\tif (bx > b.x()) {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y() + b.size().height\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'b';\n\t\t\t} else {\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: ay\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\treturnLine.push({\n\t\t\t\t\tx: b.x(),\n\t\t\t\t\ty: b.y() + b.size().height / 2\n\t\t\t\t});\n\t\t\t\tendPoisiton = 'r';\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tline: returnLine,\n\t\t\tflag: isReturnFlag,\n\t\t\tendPoisiton: endPoisiton\n\t\t}\n\n\t}\n\n\tvar drawTwoLine = function (a, b, doc) {\n\t\tvar art = doc.artboards();\n\t\tvar pca = a;\n\t\tvar pcb = b;\n\t\tvar endPoisiton;\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\t\tif (a.className() != \"MSArtboardGroup\" && a.className() != \"MSSymbolMaster\") {\n\t\t\tif (pca.parentArtboard()) {\n\t\t\t\tpca = pca.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (b.className() != \"MSArtboardGroup\" && b.className() != \"MSSymbolMaster\") {\n\t\t\tif (pcb.parentArtboard()) {\n\t\t\t\tpcb = pcb.parentArtboard();\n\t\t\t}\n\t\t}\n\t\t//先左右后上下\n\t\tvar axPoint = a.x() + a.size().width / 2;\n\t\tvar ayPoint = a.y() + a.size().height / 2;\n\t\tvar tmpLinePoint = [];\n\t\tvar isReturnFlag = true;\n\t\tif (b.x() > a.x() + a.size().width / 2) {\n\t\t\tstartPointX = a.x() + a.size().width;\n\t\t\tstartPointY = ayPoint;\n\t\t\tendPointX = b.x() + b.size().width / 2;\n\t\t\tendPointY = ayPoint;\n\t\t} else if (b.x() + b.size().width / 2 < a.x()) {\n\t\t\tstartPointX = a.x();\n\t\t\tstartPointY = ayPoint;\n\t\t\tendPointX = b.x() + b.size().width / 2;\n\t\t\tendPointY = ayPoint;\n\t\t}\n\t\ttmpLinePoint = [{\n\t\t\tx: startPointX,\n\t\t\ty: startPointY\n\t\t}, {\n\t\t\tx: endPointX,\n\t\t\ty: endPointY\n\t\t}];\n\n\t\tif (b.y() + b.size().height / 2 > ayPoint) {\n\t\t\tendPointY = b.y();\n\t\t\tendPoisiton = 't';\n\t\t} else {\n\t\t\tendPointY = b.y() + b.size().height;\n\t\t\tendPoisiton = 'b';\n\t\t}\n\t\ttmpLinePoint.push({\n\t\t\tx: endPointX,\n\t\t\ty: endPointY\n\t\t});\n\t\tfor (var k = 0; k < tmpLinePoint.length - 1; k++) {\n\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\tx: tmpLinePoint[k].x,\n\t\t\t\t\ty: tmpLinePoint[k].y\n\t\t\t\t}, {\n\t\t\t\t\tx: tmpLinePoint[k + 1].x + 5,\n\t\t\t\t\ty: tmpLinePoint[k + 1].y + 5\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t}, {\n\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t});\n\t\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segments.flag == true) {\n\t\t\t\t\tisReturnFlag = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//先上下后左右\n\t\tif (!isReturnFlag) {\n\t\t\ttmpLinePoint.splice(0, tmpLinePoint.length);\n\t\t\tisReturnFlag = true;\n\t\t\tif (b.y() + b.size().height / 2 > ayPoint) {\n\t\t\t\tstartPointY = a.y() + a.size().height;\n\t\t\t} else {\n\t\t\t\tstartPointY = a.y();\n\t\t\t}\n\t\t\tstartPointX = a.x() + a.size().width / 2;\n\t\t\tendPointX = startPointX;\n\t\t\tendPointY = b.y() + b.size().height / 2;\n\t\t\ttmpLinePoint = [{\n\t\t\t\tx: startPointX,\n\t\t\t\ty: startPointY\n\t\t\t}, {\n\t\t\t\tx: endPointX,\n\t\t\t\ty: endPointY\n\t\t\t}];\n\t\t\tif (b.x() > a.x() + a.size().width / 2) {\n\t\t\t\tendPointX = b.x();\n\t\t\t\tendPoisiton = 'r';\n\t\t\t} else {\n\t\t\t\tendPointX = b.x() + b.size().width;\n\t\t\t\tendPoisiton = 'l';\n\t\t\t}\n\t\t\ttmpLinePoint.push({\n\t\t\t\tx: endPointX,\n\t\t\t\ty: endPointY\n\t\t\t});\n\t\t\tfor (var k = 0; k < tmpLinePoint.length - 1; k++) {\n\t\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\t\tx: tmpLinePoint[k].x,\n\t\t\t\t\t\ty: tmpLinePoint[k].y\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: tmpLinePoint[k + 1].x + 5,\n\t\t\t\t\t\ty: tmpLinePoint[k + 1].y + 5\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t\t});\n\t\t\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segments.flag == true) {\n\t\t\t\t\t\tisReturnFlag = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tline: tmpLinePoint,\n\t\t\tflag: isReturnFlag,\n\t\t\tendPoisiton: endPoisiton\n\t\t}\n\t}\n\n\tvar findAway2 = function (a, b, doc) {\n\t\tvar endPoisitonArrow = 'b';\n\t\tvar art = doc.artboards();\n\t\tvar returnLine = [];\n\t\tvar isReturnFlag = false;\n\t\tvar pca = a,\n\t\t\tpcb = b;\n\t\tvar fx;\n\t\tvar zaLength = 0;\n\t\tif (a.className() != \"MSArtboardGroup\" && a.className() != \"MSSymbolMaster\") {\n\t\t\tif (a.parentArtboard()) {\n\t\t\t\tpca = pca.parentArtboard();\n\t\t\t}\n\t\t}\n\t\tif (b.className() != \"MSArtboardGroup\" && b.className() != \"MSSymbolMaster\") {\n\t\t\tif (pcb.parentArtboard()) {\n\t\t\t\tpcb = pcb.parentArtboard();\n\t\t\t}\n\t\t}\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\n\t\t//确认位置关系 并确定起始点\n\t\tvar qda = [];\n\t\tvar ax, bx, ay, by, nx, ny;\n\t\tvar linePath = [];\n\t\tvar iFlag = 0;\n\n\t\t//左右\n\t\tif (b.x() > a.x()) {\n\t\t\tax = a.size().width + a.x();\n\t\t\tay = a.size().height / 2 + a.y();\n\t\t\tbx = b.x() + 5;\n\t\t\tby = b.size().height / 2 + b.y();\n\t\t\tfx = 'r';\n\t\t\treturnLine.push({\n\t\t\t\tx: parseInt(ax),\n\t\t\t\ty: parseInt(ay)\n\t\t\t});\n\t\t\tif (b.y() > a.y()) {\n\t\t\t\t// 目标在右下角 右下右\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 'b');\n\t\t\t} else {\n\t\t\t\t// 目标在右上角 右上右\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 't');\n\t\t\t}\n\t\t} else {\n\t\t\tax = a.x() - 5;\n\t\t\tay = a.size().height / 2 + a.y();\n\t\t\tbx = b.size().width + b.x();\n\t\t\tby = b.size().height / 2 + b.y();\n\t\t\tfx = 'l';\n\t\t\treturnLine.push({\n\t\t\t\tx: parseInt(ax),\n\t\t\t\ty: parseInt(ay)\n\t\t\t});\n\t\t\tif (b.y() > a.y()) {\n\t\t\t\t// 目标在左下角 左下左\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 'b');\n\t\t\t} else {\n\t\t\t\t// 目标在左上角 左上左\n\t\t\t\tgetLinePath({\n\t\t\t\t\tx: ax,\n\t\t\t\t\ty: ay\n\t\t\t\t}, {\n\t\t\t\t\tx: bx,\n\t\t\t\t\ty: by\n\t\t\t\t}, fx, 't');\n\t\t\t}\n\t\t}\n\n\t\tfunction getLinePath(startPosition, endPoisiton, fx, nextFx) {\n\t\t\tiFlag = iFlag + 1;\n\t\t\tif (iFlag == 15) {\n\t\t\t\treturn iFlag++;\n\t\t\t}\n\t\t\t//找到路径中最近的产生碰撞的元素\n\t\t\tvar pzysx = 0;\n\t\t\tvar pzysy = 0;\n\t\t\tvar isPZ = false;\n\t\t\tvar thisEndPosition = {\n\t\t\t\tx: parseInt(startPosition.x),\n\t\t\t\ty: parseInt(startPosition.y)\n\t\t\t};\n\t\t\tvar PZLine = {\n\t\t\t\tx: parseInt(endPoisiton.x),\n\t\t\t\ty: parseInt(endPoisiton.y)\n\t\t\t};\n\n\t\t\tif (fx == 'l' || fx == 'r') {\n\t\t\t\tPZLine.y = startPosition.y;\n\t\t\t\tif (fx == 'l') {\n\t\t\t\t\tPZLine.x = PZLine.x - pcb.absoluteRect().size().width / 2;\n\t\t\t\t} else {\n\t\t\t\t\tPZLine.x = PZLine.x + pcb.absoluteRect().size().width / 2;\n\t\t\t\t}\n\t\t\t} else if (fx == 't' || fx == 'b') {\n\t\t\t\tPZLine.x = startPosition.x;\n\t\t\t\tif (fx == 't') {\n\t\t\t\t\tPZLine.y = PZLine.y - pcb.absoluteRect().size().height / 2;\n\t\t\t\t} else {\n\t\t\t\t\tPZLine.y = PZLine.y + pcb.absoluteRect().size().height / 2;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar startArtPosition = pca.absoluteRect();\n\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\t\tx: startPosition.x,\n\t\t\t\t\t\ty: startPosition.y\n\t\t\t\t\t},\n\t\t\t\t\tPZLine, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t\t}, {\n\t\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tif (pca.objectID() != art[i].objectID() && pcb.objectID() != art[i].objectID() && segments.flag == true) {\n\n\t\t\t\t\t//需要一个绕过的情况\n\n\t\t\t\t\tisReturnFlag = true;\n\t\t\t\t\tif ((pzysx < art[i].absoluteRect().x() + art[i].absoluteRect().size().width || !isPZ) && fx == 'l') {\n\t\t\t\t\t\tpzysx = parseInt(art[i].absoluteRect().x() + art[i].absoluteRect().size().width);\n\t\t\t\t\t\tthisEndPosition.x = parseInt(startArtPosition.x() - (startArtPosition.x() - (art[i].absoluteRect().x() + art[i].absoluteRect().size().width)) / 2);\n\t\t\t\t\t\tif (thisEndPosition.x == startPosition.x && thisEndPosition.y == startPosition.y) {\n\t\t\t\t\t\t\tif (nextFx == 'b') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() - LineToArtJL;\n\t\t\t\t\t\t\t} else if (nextFx == 't') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() + art[i].absoluteRect().size().height + LineToArtJL;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturnLine.push({\n\t\t\t\t\t\t\t\tx: parseInt(thisEndPosition.x),\n\t\t\t\t\t\t\t\ty: parseInt(thisEndPosition.y)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgetLinePath(thisEndPosition, endPoisiton, fx, nextFx);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ((pzysx > art[i].absoluteRect().x() || !isPZ) && fx == 'r') {\n\t\t\t\t\t\tpzysx = art[i].absoluteRect().x();\n\t\t\t\t\t\tthisEndPosition.x = parseInt(startArtPosition.x() + startArtPosition.size().width + (art[i].absoluteRect().x() - startArtPosition.x() - startArtPosition.size().width) / 2);\n\t\t\t\t\t\tif (thisEndPosition.x == startPosition.x && thisEndPosition.y == startPosition.y) {\n\t\t\t\t\t\t\tif (nextFx == 'b') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() - LineToArtJL;\n\t\t\t\t\t\t\t} else if (nextFx == 't') {\n\t\t\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\t\t\tthisEndPosition.y = art[i].absoluteRect().y() + art[i].absoluteRect().size().height + LineToArtJL;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturnLine.push({\n\t\t\t\t\t\t\t\tx: parseInt(thisEndPosition.x),\n\t\t\t\t\t\t\t\ty: parseInt(thisEndPosition.y)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgetLinePath(thisEndPosition, endPoisiton, fx, nextFx);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ((pzysy > art[i].absoluteRect().y() + art[i].absoluteRect().size().height || !isPZ) && fx == 't') {\n\t\t\t\t\t\tpzysy = art[i].absoluteRect().y() + art[i].absoluteRect().size().height;\n\t\t\t\t\t\tthisEndPosition.y = parseInt(startPosition.y - (startPosition.y - (art[i].absoluteRect().y() + art[i].absoluteRect().size().height)) / 2);\n\n\t\t\t\t\t} else if ((pzysy > art[i].absoluteRect().y() || !isPZ) && fx == 'b') {\n\t\t\t\t\t\tpzysy = art[i].absoluteRect().y();\n\t\t\t\t\t\tthisEndPosition.y = parseInt(startPosition.y + (art[i].absoluteRect().y() - startPosition.y) / 2);\n\t\t\t\t\t}\n\t\t\t\t\tisPZ = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar endObject = {};\n\n\t\t\tif (isPZ) {\n\t\t\t\tif (fx == 'l' || fx == 'r') {\n\t\t\t\t\tzaLength++;\n\t\t\t\t} else {\n\t\t\t\t\tzaLength--;\n\t\t\t\t}\n\t\t\t\tif (zaLength > 0) {\n\t\t\t\t\tif (b.x() > a.x()) {\n\t\t\t\t\t\tendPoisiton.x = b.x() + 10;\n\t\t\t\t\t\tendPoisiton.y = b.size().height / 2 + b.y();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendPoisiton.x = b.size().width + b.x() - 10;\n\t\t\t\t\t\tendPoisiton.y = b.size().height / 2 + b.y();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (b.y() < a.y()) {\n\t\t\t\t\t\tendPoisiton.x = b.x() + b.size().width / 2;\n\t\t\t\t\t\tendPoisiton.y = b.y() + b.size().height - 10;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendPoisiton.x = b.x() + b.size().width / 2;\n\t\t\t\t\t\tendPoisiton.y = b.y() + 10;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tendObject = {\n\t\t\t\t\tx: parseInt(thisEndPosition.x),\n\t\t\t\t\ty: parseInt(thisEndPosition.y)\n\t\t\t\t};\n\t\t\t\tpzysx = 0;\n\t\t\t\tpzysy = 0;\n\t\t\t} else {\n\t\t\t\tif (fx == 'l' || fx == 'r') {\n\t\t\t\t\tendObject = {\n\t\t\t\t\t\tx: parseInt(endPoisiton.x),\n\t\t\t\t\t\ty: parseInt(startPosition.y)\n\t\t\t\t\t};\n\t\t\t\t} else if (fx == 't' || fx == 'b') {\n\t\t\t\t\tendObject = {\n\t\t\t\t\t\tx: parseInt(startPosition.x),\n\t\t\t\t\t\ty: parseInt(endPoisiton.y)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tif (returnLine[returnLine.length - 1].x != endObject.x || returnLine[returnLine.length - 1].y != endObject.y) {\n\t\t\t\treturnLine.push(endObject);\n\t\t\t\t//判断是不是撞到目标了\n\t\t\t\tfor (var i = 0; i < art.length; i++) {\n\t\t\t\t\tvar segments = segmentsIntr({\n\t\t\t\t\t\t\tx: startPosition.x,\n\t\t\t\t\t\t\ty: startPosition.y\n\t\t\t\t\t\t},\n\t\t\t\t\t\tendObject, {\n\t\t\t\t\t\t\tx: art[i].absoluteRect().x(),\n\t\t\t\t\t\t\ty: art[i].absoluteRect().y()\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tx: art[i].absoluteRect().x() + art[i].absoluteRect().size().width,\n\t\t\t\t\t\t\ty: art[i].absoluteRect().y() + art[i].absoluteRect().size().height\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tif (pcb.objectID() == art[i].objectID() && segments.flag == true) {\n\t\t\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t\t\t\treturnLine.push({\n\t\t\t\t\t\t\tx: parseInt(segments.x),\n\t\t\t\t\t\t\ty: parseInt(segments.y)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (fx == 'b') {\n\t\t\t\t\t\t\tendPoisitonArrow = 't';\n\t\t\t\t\t\t} else if (fx == 't') {\n\t\t\t\t\t\t\tendPoisitonArrow = 'b';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tendPoisitonArrow = fx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturnLine.splice(returnLine.length - 1, 1);\n\t\t\t}\n\n\t\t\tif (parseInt(endObject.x) != parseInt(endPoisiton.x) || parseInt(endObject.y) != parseInt(endPoisiton.y)) {\n\t\t\t\tgetLinePath(endObject, endPoisiton, nextFx, fx);\n\t\t\t} else {\n\t\t\t\tendPoisitonArrow = fx;\n\t\t\t\tif (fx == 'b') {\n\t\t\t\t\tendPoisitonArrow = 't';\n\t\t\t\t} else if (fx == 't') {\n\t\t\t\t\tendPoisitonArrow = 'b';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (iFlag == 16) {\n\t\t\terrorDialog(context,pca.name() + i18.m1 + pcb.name() + i18.m2);\n\t\t}\n\n\t\treturn {\n\t\t\tline: returnLine,\n\t\t\tflag: isReturnFlag,\n\t\t\tendPoisiton: endPoisitonArrow\n\t\t}\n\t}\n\n\tvar drawPPP = function (a, b, doc) {\n\t\tvar domA = a;\n\t\tvar domB = b;\n\t\ta = a.absoluteRect();\n\t\tb = b.absoluteRect();\n\t\tvar startPointX;\n\t\tvar startPointY;\n\t\tvar endPointX;\n\t\tvar endPointY;\n\t\tvar endPoisiton = 'l';\n\t\tvar tempPointX;\n\t\tvar tempPointY;\n\n\t\t//先确定是否可以走直线\n\t\tvar axPoint = a.x() + a.size().width / 2;\n\t\tvar ayPoint = a.y() + a.size().height / 2;\n\n\t\t//是否是上下关系\n\t\tif (b.x() < axPoint && axPoint < b.x() + b.size().width) {\n\t\t\tstartPointX = axPoint;\n\t\t\tendPointX = axPoint;\n\t\t\tvar plus = true;\n\t\t\t//在上边\n\t\t\tif (a.y() > b.y()) {\n\t\t\t\tstartPointY = a.y();\n\t\t\t\tendPointY = b.y() + b.size().height;\n\t\t\t\tendPoisiton = 'b';\n\t\t\t} else {\n\t\t\t\t//在下边\n\t\t\t\tstartPointY = a.y() + a.size().height;\n\t\t\t\tendPointY = b.y();\n\t\t\t\tendPoisiton = 't';\n\t\t\t\tplus = false;\n\t\t\t}\n\t\t\tvar line;\n\t\t\tvar returnLine = findAway({\n\t\t\t\tax: startPointX,\n\t\t\t\tay: startPointY,\n\t\t\t\tbx: endPointX,\n\t\t\t\tby: endPointY\n\t\t\t}, domA, domB, doc, endPoisiton);\n\t\t\t//三根线算法\n\t\t\tif (returnLine.flag) {\n\t\t\t\tstartPointX = returnLine.line[0].x;\n\t\t\t\tstartPointY = returnLine.line[0].y;\n\t\t\t\tendPointX = returnLine.line[returnLine.line.length - 1].x;\n\t\t\t\tendPointY = returnLine.line[returnLine.line.length - 1].y;\n\t\t\t\tline = drawLine(returnLine.line, endPoisiton, true);\n\t\t\t\tendPoisiton = returnLine.endPoisiton;\n\t\t\t} else {\n\t\t\t\tline = drawLine([{\n\t\t\t\t\tx: startPointX,\n\t\t\t\t\ty: startPointY\n\t\t\t\t}, {\n\t\t\t\t\tx: endPointX,\n\t\t\t\t\ty: endPointY\n\t\t\t\t}], endPoisiton);\n\t\t\t}\n\t\t}\n\t\t//是否是左右关系\n\t\telse if (b.y() < ayPoint && ayPoint < b.y() + b.size().height) {\n\t\t\tstartPointY = ayPoint;\n\t\t\tendPointY = ayPoint;\n\t\t\tvar plus = true;\n\t\t\tif (a.x() > b.x()) {\n\t\t\t\t//在右边\n\t\t\t\tstartPointX = a.x();\n\t\t\t\tendPointX = b.x() + b.size().width;\n\t\t\t\tendPoisiton = 'l';\n\t\t\t} else {\n\t\t\t\t//在左边\n\t\t\t\tstartPointX = a.x() + a.size().width;\n\t\t\t\tendPointX = b.x();\n\t\t\t\tendPoisiton = 'r';\n\t\t\t\tplus = false;\n\t\t\t}\n\t\t\tvar line;\n\t\t\tvar returnLine = findAway({\n\t\t\t\tax: startPointX,\n\t\t\t\tay: startPointY,\n\t\t\t\tbx: endPointX,\n\t\t\t\tby: endPointY\n\t\t\t}, domA, domB, doc, endPoisiton);\n\t\t\t//三根线算法\n\t\t\tif (returnLine.flag) {\n\t\t\t\tline = drawLine(returnLine.line, returnLine.endPoisiton, true);\n\t\t\t} else {\n\t\t\t\tline = drawLine([{\n\t\t\t\t\tx: startPointX,\n\t\t\t\t\ty: startPointY\n\t\t\t\t}, {\n\t\t\t\t\tx: endPointX,\n\t\t\t\t\ty: endPointY\n\t\t\t\t}], endPoisiton);\n\t\t\t}\n\t\t}\n\t\t// 都不是，要用两根线了\n\t\telse if (b.y() + b.size().height / 2 < ayPoint || b.y() + b.size().height / 2 > ayPoint) {\n\t\t\tvar returnLine = drawTwoLine(domA, domB, doc);\n\t\t\tif (returnLine.flag == false) {\n\t\t\t\treturnLine = findAway2(domA, domB, doc);\n\t\t\t}\n\t\t\tlog(returnLine);\n\t\t\tline = drawLine(returnLine.line, returnLine.endPoisiton, true);\n\n\n\t\t}\n\t\treturn line;\n\t}\n\n\t/*\n\t * 获取两个点（有顺序的点）连成线的方向\n\t */\n\tvar getLineDirection = function (pointeOne, pointTwo) {\n\t\tif (pointeOne.x === pointTwo.x) { // 两个点的 x 相同\n\t\t\tif (pointeOne.y > pointTwo.y) { // 上\n\t\t\t\treturn 't';\n\t\t\t} else { // 下\n\t\t\t\treturn 'b';\n\t\t\t}\n\t\t} else { // 两个点的 y 相同\n\t\t\tif (pointeOne.x > pointTwo.x) { // 左\n\t\t\t\treturn 'l';\n\t\t\t} else { // 右\n\t\t\t\treturn 'r';\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * 获取两个点（有顺序的点）连成线的位置\n\t */\n\tvar getLinePosition = function (point) {\n\t\tif (point.direction == 't' || point.direction == 'b') {\n\t\t\treturn point.x;\n\t\t} else {\n\t\t\treturn point.y;\n\t\t}\n\t}\n\n\tvar isCoincidenis = function (a,b) {\n\t\tvar c = {a:Math.min(a.a,a.b),b:Math.min(a.a,a.b)};\n\t\tvar d = {a:Math.min(b.a,b.b),b:Math.min(b.a,b.b)};\n\t\tlog(c);\n\t\tlog(d);\n\t\tif((c.a >= d.a && c.a <= d.b) || (c.b >= d.a && c.b <= d.b)){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tvar drawLine = function (linepoint, endPoisiton, isLess) {\n\t\tvar colorLineLink = NSUserDefaults.standardUserDefaults().objectForKey(lineColorKeyLink) || \"#1AAD19\";\n\t\tvar lineThicknessLink = NSUserDefaults.standardUserDefaults().objectForKey(lineThicknessLinkKey) || \"6\";\n\t\tvar colorLineLinkR = rgb(colorLineLink)[0];\n\t\tvar colorLineLinkG = rgb(colorLineLink)[1];\n\t\tvar colorLineLinkB = rgb(colorLineLink)[2];\n\t\tvar linePaths = [];\n\t\tvar linePath = NSBezierPath.bezierPath();\n\n\t\tvar lineCount = linepoint.length;\n\t\tvar offset = 20;\n\t\tvar coincideOffset = lineThicknessLink * 5;\n\n\t\tfor (var i = 0; i < lineCount - 1; i++) { // 给每个点添加接下来走向的方向和位置属性\n\t\t\tlinepoint[i].direction = getLineDirection(linepoint[i], linepoint[i + 1]);\n\t\t\tlinepoint[i].position = getLinePosition(linepoint[i]);\n\t\t\tlineCollections.push(linepoint[i]);\n\t\t}\n\n\tvar comparedLineCollectionCount = lineCollections.length - (lineCount - 1);\n\n\t// 解决线重合问题\n\tfor (var i = 0; i < lineCount; i++) {\n\t\tfor (var j = 0; j < comparedLineCollectionCount; j++) {\n\t\t\tif ((linepoint[i].direction == 't' || linepoint[i].direction == 'b') &&\n\t\t\t\t(Math.abs(linepoint[i].position - lineCollections[j].position) < 3) && isCoincidenis({a:linepoint[i].x,b:linepoint[i+1].x},{a:lineCollections[j].x,b:lineCollections[j+1].x})) {\n\t\t\t\t// 不是起始线重合，位于起始点左侧 || 起始线重合: 位于重合线下侧，减去 coincideOffset\n\t\t\t\tif ((i != 0 && linepoint[0].x < linepoint[i].x) ||\n\t\t\t\t\t(i == 0 && (linepoint[0].y < lineCollections[j].y))) {\n\t\t\t\t\tlinepoint[i].x -= coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].x -= coincideOffset;\n\t\t\t\t} else {\n\t\t\t\t\tlinepoint[i].x += coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].x += coincideOffset;\n\t\t\t\t}\n\t\t\t} else if ((linepoint[i].direction == 'l' || linepoint[i].direction == 'r') &&\n\t\t\t\t(Math.abs(linepoint[i].position - lineCollections[j].position) < 3) && isCoincidenis({a:linepoint[i].y,b:linepoint[i+1].y},{a:lineCollections[j].y,b:lineCollections[j+1].y})) {\n\t\t\t\t// 不是起始线重合，位于起始点上侧 || 起始线重合: 位于重合线左侧，减去 coincideOffset\n\t\t\t\tif ((i != 0 && linepoint[0].y < linepoint[i].y) ||\n\t\t\t\t\t(i == 0 && linepoint[0].x < lineCollections[j].x)) {\n\t\t\t\t\tlinepoint[i].y -= coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].y -= coincideOffset;\n\t\t\t\t} else {\n\t\t\t\t\tlinepoint[i].y += coincideOffset;\n\t\t\t\t\tlinepoint[i + 1].y += coincideOffset;\n\t\t\t\t}\n\t\t\t} else {}\n\t\t}\n\t}\n\n\tfor (var i = 0; i < lineCount - 1; i++) {\n\t\tif (i === 0) { // 第一个点不做修改\n\t\t\tlinePath.moveToPoint(NSMakePoint(linepoint[i].x, linepoint[i].y));\n\t\t}\n\t\tif (i === lineCount - 2) { // 倒数第二个点绘制直线\n\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y));\n\t\t} else {\n\t\t\t// 先绘制到下一个点的直线，然后绘制到下下个点的曲线\n\t\t\t// 0.13 = 1 - cos(30)\n\t\t\t// 0.5 = 1- sin(30)\n\t\t\tif (linepoint[i].direction === 't') { // 上\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y + offset));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 'l') { // 下一条线的方向 左\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x - offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y + offset * 0.5), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y + offset * 0.13));\n\t\t\t\t} else { // 右\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x + offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y + offset * 0.5), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y + offset * 0.13));\n\t\t\t\t}\n\t\t\t} else if (linepoint[i].direction === 'b') { // 下\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y - offset));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 'l') { // 下一条线的方向 左\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x - offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y - offset * 0.5), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y - offset * 0.13));\n\t\t\t\t} else { // 右\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x + offset, linepoint[i + 1].y), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y - offset * 0.5), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y - offset * 0.13));\n\t\t\t\t}\n\t\t\t} else if (linepoint[i].direction === 'l') { // 左\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x + offset, linepoint[i + 1].y));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 't') { // 下一条线的方向 上\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y - offset), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y - offset * 0.13), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y - offset * 0.5));\n\t\t\t\t} else { // 下\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y + offset), NSMakePoint(linepoint[i + 1].x + offset * 0.5, linepoint[i + 1].y + offset * 0.13), NSMakePoint(linepoint[i + 1].x + offset * 0.13, linepoint[i + 1].y + offset * 0.5));\n\t\t\t\t}\n\t\t\t} else { // 右\n\t\t\t\tlinePath.lineToPoint(NSMakePoint(linepoint[i + 1].x - offset, linepoint[i + 1].y));\n\t\t\t\t// 绘制过渡曲线\n\t\t\t\tif (linepoint[i + 1].direction === 't') { // 下一条线的方向 上\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y - offset), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y - offset * 0.13), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y - offset * 0.5));\n\t\t\t\t} else { // 下\n\t\t\t\t\tlinePath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint(linepoint[i + 1].x, linepoint[i + 1].y + offset), NSMakePoint(linepoint[i + 1].x - offset * 0.5, linepoint[i + 1].y + offset * 0.13), NSMakePoint(linepoint[i + 1].x - offset * 0.13, linepoint[i + 1].y + offset * 0.5));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tlinePath = MSPath.pathWithBezierPath(linePath);\n\tvar lineSh = MSShapeGroup.shapeWithBezierPath(linePath);\n\tvar hitAreaBorder = lineSh.style().addStylePartOfType(1);\n\thitAreaBorder.setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 255).newMutableCounterpart());\n\thitAreaBorder.setThickness(lineThicknessLink);\n\thitAreaBorder.setPosition(0);\n\tlineSh.setName('Line');\n\n\t// 绘制起点圆圈\n\tvar drawRound = function (x, y) {\n\t\tvar linkRect = NSInsetRect(NSMakeRect(x, y, 0, 0), -5, -5);\n\t\tvar path = NSBezierPath.bezierPathWithOvalInRect(linkRect);\n\t\tpath = MSPath.pathWithBezierPath(path);\n\t\tvar hitAreaLayer = MSShapeGroup.shapeWithBezierPath(path);\n\t\thitAreaLayer.style().addStylePartOfType(0).setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 76.5).newMutableCounterpart());\n\t\thitAreaLayer.style().addStylePartOfType(1).setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 255).newMutableCounterpart());\n\t\thitAreaLayer.setName('Point');\n\t\treturn hitAreaLayer;\n\t}\n\n\t// 绘制终点箭头\n\tvar drawArrow = function (x, y, z) {\n\t\t// 绘制箭头\n\t\tvar arrowDirection = z; // 1. 箭头方向\n\t\tvar arrowOffset = 20 * (lineThicknessLink / 6); // 2. 箭头长度\n\t\tvar arrowPath = NSBezierPath.bezierPath();\n\n\t\tarrowPath.moveToPoint(NSMakePoint(x, y));\n\t\tif (arrowDirection == 't') {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y + arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y + arrowOffset));\n\t\t} else if (arrowDirection == 'b') {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y - arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y - arrowOffset));\n\t\t} else if (arrowDirection == 'l') {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y - arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x + arrowOffset, y + arrowOffset));\n\t\t} else {\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y - arrowOffset));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x, y));\n\t\t\tarrowPath.lineToPoint(NSMakePoint(x - arrowOffset, y + arrowOffset));\n\t\t}\n\t\tarrowPath = MSPath.pathWithBezierPath(arrowPath);\n\t\tvar arrow = MSShapeGroup.shapeWithBezierPath(arrowPath);\n\t\tvar arrowStyle = arrow.style().addStylePartOfType(1);\n\t\tarrowStyle.setThickness(lineThicknessLink);\n\t\tarrowStyle.setColor(MSImmutableColor.colorWithIntegerRed_green_blue_alpha(colorLineLinkR, colorLineLinkG, colorLineLinkB, 255).newMutableCounterpart());\n\t\tarrow.setName('Arrow');\n\t\treturn arrow;\n\t}\n\n\tvar startRound = drawRound(linepoint[0].x, linepoint[0].y);\n\n\tvar endArrow = drawArrow(linepoint[lineCount - 1].x, linepoint[lineCount - 1].y, linepoint[lineCount - 2].direction);\n\n\treturn [lineSh, startRound, endArrow];\n}\n\nvar drawConnections = function (connection, doc) {\n\tvar draw = drawPPP(connection.linkRect, connection.artboard, doc);\n\tdoc.addLayers(draw);\n\n\tvar connectionLayersDom = MSLayerArray.arrayWithLayers(draw);\n\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayersDom);\n\tconnectionsGroup.setName(connection.linkRect.objectID());\n\treturn connectionsGroup;\n}\n\nvar redrawConnections = function (context) {\n\tvar doc = context.document;\n\tvar selectionLayer = context.selection;\n\n\t//var selectedLayers = doc.findSelectedLayers();\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\tlinkLayers = doc.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\tloop = linkLayers.objectEnumerator(),\n\tconnections = [],\n\tlinkLayer, destinationArtboardID, destinationArtboard, isCondition, linkRect;\n\n\tvar connectionsGroup = getConnectionsGroupInPage(doc.currentPage());\n\tif (connectionsGroup) {\n\t\tconnectionsGroup.removeFromParent();\n\t}\n\n\twhile (linkLayer = loop.nextObject()) {\n\t\tdestinationArtboardID = context.command.valueForKey_onLayer_forPluginIdentifier(\"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\tvar Message = destinationArtboardID.split('____');\n\t\tdestinationArtboard = doc.currentPage().children().filteredArrayUsingPredicate(NSPredicate.predicateWithFormat(\"(objectID == %@) || (userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).artboardID == %@)\", Message[1], kPluginDomain, Message[1])).firstObject();\n\n\t\tif (destinationArtboard && Message[0] == linkLayer.objectID()) {\n\t\t\tsanitizeArtboard(destinationArtboard, context);\n\t\t\tconnections.push(drawConnections({\n\t\t\t\tlinkRect: linkLayer,\n\t\t\t\tartboard: destinationArtboard\n\t\t\t}, doc.currentPage()));\n\t\t}\n\t}\n\n\tvar connectionLayers = MSLayerArray.arrayWithLayers(connections);\n\tconnectionsGroup = MSLayerGroup.groupFromLayers(connectionLayers);\n\tconnectionsGroup.setName(\"Connections\");\n\tconnectionsGroup.setIsLocked(1);\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(true, \"isConnectionsContainer\", connectionsGroup, kPluginDomain);\n\n\tfor (var i = 0; i < context.selection.length; i++) {\n\t\tcontext.selection[i].select_byExpandingSelection(false, false);\n\t}\n\n\tfor (var i = 0; i < selectionLayer.count(); i++) {\n\t\tselectionLayer[i].select_byExpandingSelection(true, true);\n\t}\n\n\treturn connectionsGroup;\n}\n\nvar selection = context.selection;\nvar destArtboard, linkLayer;\n\n// 检查有没有被手动删掉的\nvar connectionsGroup = getConnectionsGroupInPage(context.document.currentPage());\nif (!connectionsGroup) {\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\tlinkLayers = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\tloop = linkLayers.objectEnumerator(),\n\tlinkLayer, destinationArtboardID;\n\twhile (linkLayer = loop.nextObject()) {\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"destinationArtboardID\", linkLayer, kPluginDomain);\n\t}\n}else{\n\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).destinationArtboardID != nil\", kPluginDomain),\n\tlinkLayers = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate),\n\tloop = linkLayers.objectEnumerator(),\n\tlinkLayer, destinationArtboardID;\n\tvar child = connectionsGroup.layers();\n\twhile (linkLayer = loop.nextObject()) {\n\t\tfor(var i = 0;i < child.length; i++){\n\t\t\tif(encodeURIComponent(child[i].name()) == encodeURIComponent(linkLayer.objectID())){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(i == child.length-1){\n\t\t\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\t\t}\n\t\t}\n\t}\t\t\n}\n\nif (selection.count() != 1 && selection.count() != 2) {\n\tredrawConnections(context);\n\tif (!refursh) {\n\t\treturn errorDialog(context,i18.m3);\n\t}\n}\n\nif (selection.count() == 1) {\n\tvar loop = context.selection.objectEnumerator(),\n\t\tlinkLayer, destinationArtboardID;\n\twhile (linkLayer = loop.nextObject()) {\n\t\tdestinationArtboardID = context.command.valueForKey_onLayer_forPluginIdentifier(\"destinationArtboardID\", linkLayer, kPluginDomain);\n\t\tif (!destinationArtboardID) {\n\t\t\tcontinue;\n\t\t}\n\t\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(nil, \"destinationArtboardID\", linkLayer, kPluginDomain);\n\t}\n\n} else if (selection.count() == 2) {\n\tif (selection.firstObject().className() == \"MSArtboardGroup\" || selection.firstObject().className() == \"MSSymbolMaster\") {\n\t\tif ((selection.firstObject().className() == \"MSArtboardGroup\" || selection.firstObject().className() == \"MSSymbolMaster\") && (selection.lastObject().className() == \"MSArtboardGroup\" || selection.lastObject().className() == \"MSSymbolMaster\")) {\n\t\t\tlinkLayer = selection[1];\n\t\t\tdestArtboard = selection[0];\n\t\t} else {\n\t\t\tdestArtboard = selection[0];\n\t\t\tlinkLayer = selection[1];\n\t\t}\n\t} else if (selection.lastObject().className() == \"MSArtboardGroup\" || selection.lastObject().className() == \"MSSymbolMaster\") {\n\t\tdestArtboard = selection.lastObject();\n\t\tlinkLayer = selection.firstObject();\n\t} else {\n\t\tvar manifestPath = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Sketch\").URLByAppendingPathComponent(\"manifest.json\").path(),\n\t\t\tmanifest = NSJSONSerialization.JSONObjectWithData_options_error(NSData.dataWithContentsOfFile(manifestPath), NSJSONReadingMutableContainers, nil);\n\n\t\tif (JSON.stringify(manifest.commands[0]).indexOf('SelectionChanged.finish') > -1) {\n\t\t\tvar Selection = NSUserDefaults.standardUserDefaults().objectForKey(selectionDom) || '';\n\t\t\tSelection = Selection.split(',');\n\t\t\tvar linkLayersPredicate = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).selection1 == '\" + Selection[0] + \"'\", selectionDom1);\n\t\t\tlinkLayer = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate).firstObject();\n\t\t\tvar linkLayersPredicate2 = NSPredicate.predicateWithFormat(\"userInfo != nil && function(userInfo, 'valueForKeyPath:', %@).selection2 == '\" + Selection[1] + \"'\", selectionDom2);\n\t\t\tdestArtboard = context.document.currentPage().children().filteredArrayUsingPredicate(linkLayersPredicate2).firstObject();\n\t\t} else {\n\t\t\treturn context.document.showMessage(i18.m4);\n\t\t}\n\t}\n\tvar artboardID = destArtboard.objectID();\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(artboardID, \"artboardID\", destArtboard, kPluginDomain);\n\tcontext.command.setValue_forKey_onLayer_forPluginIdentifier(linkLayer.objectID() + '____' + artboardID, \"destinationArtboardID\", linkLayer, kPluginDomain);\n}\n\nredrawConnections(context);\nvar ga = new Analytics(context);\nif (ga) ga.sendEvent('link', 'link');\n}\n\nvar onRun = function (context) {\n\tgetLink(context);\n}","import {_,dialog,errorDialog,initDefaults,saveDefaults,uploadContext,paste,rgb,request,networkRequest,zip,encodeData,get,post,getConfig,openUrlInBrowser,createRadioButtons,createRadioButtons2,createArtboard,hexToRgb,unique,SMPanel} from \"./common\";\nimport {getLink} from \"./link\";\nimport {commonPreviewJson} from \"./commonPreviewJson\";\n\nfunction webPreview(context) {\n\tvar i18 = _(context).webPreview;\n\tvar webPreviewUrl = 'https://sketch.weapi.io';\n\tcontext.document.showMessage(i18.m5);\n\n\tfunction chooseFilePath() {\n\t\tvar save = NSSavePanel.savePanel();\n\t\tsave.setAllowsOtherFileTypes(true);\n\t\tsave.setExtensionHidden(false);\n\t\treturn save.URL().path() + '/' + (Math.random());\n\t}\n\tvar filePath = chooseFilePath();\n\tvar flag = commonPreviewJson(context, filePath);\n\tif (!flag) {\n\t\treturn;\n\t}\n\tzip(['-q', '-r', '-m', '-o', '-j', filePath + '.zip', filePath]);\n\tvar settingsWindow = dialog(context);\n\tsettingsWindow.addButtonWithTitle(i18.m1);\n\tsettingsWindow.addButtonWithTitle(i18.m2);\n\n\tsettingsWindow.setMessageText(i18.m3);\n\tsettingsWindow.setInformativeText(i18.m4);\n\n\tif (settingsWindow.runModal() == \"1000\") {\n\t\tvar returnData = networkRequest(['-F', 'image=@' + filePath + '.zip', iconQueryUrl + '/users/uploadHtml']);\n\t\tvar jsonData = NSString.alloc().initWithData_encoding(returnData, NSUTF8StringEncoding);\n\t\tjsonData = JSON.parse(jsonData);\n\n\t\tvar pluginSketch = context.plugin.url().URLByAppendingPathComponent(\"Contents\").URLByAppendingPathComponent(\"Resources\").URLByAppendingPathComponent(\"library\").path();\n\t\tSMPanel({\n\t\t\turl: pluginSketch + \"/panel/webPreview.html\",\n\t\t\twidth: 280,\n\t\t\theight: 300,\n\t\t\tdata: {\n\t\t\t\tlink: webPreviewUrl + '/' + jsonData.dir + '/index.html'\n\t\t\t},\n\t\t\thiddenClose: false,\n\t\t\tfloatWindow: false,\n\t\t\tidentifier: \"preview\",\n\t\t\tcallback: function (data) {\n\t\t\t\topenUrlInBrowser(data.link);\n\t\t\t},\n\t\t\tcloseCallback: function () {\n\t\t\t\tpost(['/users/deleteHtml', 'dirname=' + jsonData.dir]);\n\t\t\t}\n\t\t});\n\t\tvar fm = NSFileManager.defaultManager();\n\t\tfm.removeItemAtPath_error(filePath, nil);\n\t\tfm.removeItemAtPath_error(filePath + '.zip', nil);\n\t\tvar ga = new Analytics(context);\n\t\tif (ga) ga.sendEvent('webPreview', 'preview');\n\t}\n\n}\n\nvar onRun = function (context) {\n\twebPreview(context);\n}"],"sourceRoot":""}